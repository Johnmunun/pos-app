import{b as H,r as f,j as e,n as o,a as S,u as M,H as O}from"./app-DtqU_Gmt.js";import{a8 as U,aa as G,u as W,ac as X,q as J,r as K,ad as Q,A as R,m as T,T as I,c as Y,F as Z,P as ee}from"./AppLayout-C4K4I5xd.js";import{C as A,c as L,a as z,b as V}from"./card-Daek165Z.js";import{B as q}from"./Button-4k-pObky.js";import{I as F}from"./Input-BpgKxISb.js";import{B as $}from"./badge-BBdevRdg.js";import{D as re}from"./Drawer-Dy6JDRVK.js";import{L as C}from"./Label-QVyen-Zj.js";import{T as ae}from"./textarea-DdvYib4T.js";import{s as se,o as te}from"./syncService-BZB67gvh.js";import{X as ie}from"./x-Cw-ZD_Fb.js";import{T as B}from"./user-cog-BQwjoD4w.js";import{R as ne}from"./refresh-cw-CcjnuCLI.js";import"./createLucideIcon-BH-qXF_i.js";import"./shield-x-Cz4kXV9c.js";import"./Dropdown--z3bvfF1.js";import"./transition-DbHxI3Hw.js";import"./arrow-left-BGTcItEv.js";import"./loader-circle-DtoZnQ6b.js";import"./FlashMessages-D-g4FpAa.js";import"./utils-CDN07tui.js";function de({isOpen:v,onClose:m,category:r=null,categories:d=[],canCreate:g=!1,canUpdate:p=!1,routePrefix:j="pharmacy"}){const x=!!r,{data:c,setData:h,post:b,put:a,processing:l,errors:s,reset:u}=H({name:r?.name||"",description:r?.description||"",parent_id:r?.parent_id||"",sort_order:r?.sort_order||0,is_active:r?.is_active!==void 0?r.is_active:!0}),[y,w]=f.useState(!navigator.onLine),[_,k]=f.useState("idle");f.useEffect(()=>{r?h({name:r.name||"",description:r.description||"",parent_id:r.parent_id||"",sort_order:r.sort_order||0,is_active:r.is_active!==void 0?r.is_active:!0}):u()},[r]),f.useEffect(()=>{const t=()=>{w(!1),se.syncPendingCategories().then(()=>{k("synced")}).catch(()=>{k("error")})},n=()=>{w(!0),k("offline")};return window.addEventListener("online",t),window.addEventListener("offline",n),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",n)}},[]);const E=async t=>{if(t.preventDefault(),x&&!p){o.error("Vous n'avez pas la permission de modifier une catégorie");return}if(!x&&!g){o.error("Vous n'avez pas la permission de créer une catégorie");return}if(y||!navigator.onLine){try{const n={...c,id:r?.id||`pending_${Date.now()}`,shop_id:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};await te.savePendingCategory(n),o.success("Catégorie enregistrée localement. Synchronisation automatique à la reconnexion."),m(),u(),setTimeout(()=>{window.location.reload()},1e3)}catch(n){console.error("Error saving category offline:",n),o.error("Erreur lors de l'enregistrement local")}return}try{x?await a(route(`${j}.categories.update`,r.id),{preserveScroll:!0,onSuccess:()=>{m(),u()},onError:n=>{n.message&&o.error(n.message)}}):await b(route(`${j}.categories.store`),{preserveScroll:!0,onSuccess:()=>{m(),u()},onError:n=>{n.message&&o.error(n.message)}})}catch(n){console.error("Error submitting category:",n),o.error("Erreur lors de la soumission")}},D=d.filter(t=>!r||t.id!==r.id);return e.jsx(re,{isOpen:v,onClose:m,title:x?"Modifier la catégorie":"Ajouter une catégorie",children:e.jsxs("form",{onSubmit:E,className:"flex flex-col h-full",children:[e.jsx("div",{className:"mb-4 flex items-center gap-2 text-sm",children:y?e.jsxs("div",{className:"flex items-center text-amber-600 dark:text-amber-400",children:[e.jsx(U,{className:"h-4 w-4 mr-1"}),e.jsx("span",{children:"Mode hors ligne"})]}):_==="syncing"?e.jsxs("div",{className:"flex items-center text-blue-600 dark:text-blue-400",children:[e.jsx(G,{className:"h-4 w-4 mr-1 animate-spin"}),e.jsx("span",{children:"Synchronisation..."})]}):null}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4",children:[e.jsxs("div",{children:[e.jsxs(C,{htmlFor:"name",className:"text-gray-700 dark:text-gray-300",children:["Nom ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(F,{id:"name",type:"text",value:c.name,onChange:t=>h("name",t.target.value),className:"mt-1",required:!0,disabled:l}),s.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:s.name})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"description",className:"text-gray-700 dark:text-gray-300",children:"Description"}),e.jsx(ae,{id:"description",value:c.description,onChange:t=>h("description",t.target.value),className:"mt-1",rows:3,disabled:l}),s.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:s.description})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"parent_id",className:"text-gray-700 dark:text-gray-300",children:"Catégorie parente"}),e.jsxs("select",{id:"parent_id",value:c.parent_id,onChange:t=>h("parent_id",t.target.value||""),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-amber-500 focus:ring-amber-500 dark:bg-gray-700 dark:text-white sm:text-sm",disabled:l,children:[e.jsx("option",{value:"",children:"Aucune (catégorie principale)"}),D.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),s.parent_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:s.parent_id})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"sort_order",className:"text-gray-700 dark:text-gray-300",children:"Ordre d'affichage"}),e.jsx(F,{id:"sort_order",type:"number",value:c.sort_order,onChange:t=>h("sort_order",parseInt(t.target.value)||0),className:"mt-1",min:"0",disabled:l}),s.sort_order&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:s.sort_order})]}),e.jsxs("div",{children:[e.jsxs(C,{className:"flex items-center space-x-2 text-gray-700 dark:text-gray-300",children:[e.jsx("input",{type:"checkbox",checked:c.is_active,onChange:t=>h("is_active",t.target.checked),className:"rounded border-gray-300 text-amber-600 focus:ring-amber-500 dark:border-gray-600 dark:bg-gray-700",disabled:l}),e.jsx("span",{children:"Catégorie active"})]}),s.is_active&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:s.is_active})]})]}),e.jsxs("div",{className:"mt-6 flex flex-col sm:flex-row gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs(q,{type:"button",variant:"outline",onClick:m,className:"w-full sm:w-auto",disabled:l,children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Annuler"]}),e.jsxs(q,{type:"submit",className:"w-full sm:w-auto bg-amber-500 dark:bg-amber-600 text-white hover:bg-amber-600 dark:hover:bg-amber-700",disabled:l,children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),l?"Enregistrement...":x?"Enregistrer":"Créer"]})]})]})})}function le({pagination:v,filters:m={}}){if(!v||v.last_page<=1)return null;const{current_page:r,last_page:d,per_page:g,total:p,from:j,to:x}=v,c=a=>{S.get(route("pharmacy.categories.index"),{...m,page:a},{preserveState:!0,preserveScroll:!0})},h=a=>{S.get(route("pharmacy.categories.index"),{...m,per_page:a,page:1},{preserveState:!0,preserveScroll:!0})},b=()=>{const a=[];if(d<=7)for(let s=1;s<=d;s++)a.push(s);else if(r<=3){for(let s=1;s<=5;s++)a.push(s);a.push("..."),a.push(d)}else if(r>=d-2){a.push(1),a.push("...");for(let s=d-4;s<=d;s++)a.push(s)}else{a.push(1),a.push("...");for(let s=r-1;s<=r+1;s++)a.push(s);a.push("..."),a.push(d)}return a};return e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 px-4 py-3 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Affichage de ",e.jsx("span",{className:"font-medium",children:j})," à ",e.jsx("span",{className:"font-medium",children:x})," sur"," ",e.jsx("span",{className:"font-medium",children:p})," résultat(s)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:g,onChange:a=>h(a.target.value),className:"rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-amber-500 focus:ring-amber-500 dark:bg-gray-700 dark:text-white text-sm px-2 py-1",children:[e.jsx("option",{value:10,children:"10 / page"}),e.jsx("option",{value:15,children:"15 / page"}),e.jsx("option",{value:25,children:"25 / page"}),e.jsx("option",{value:50,children:"50 / page"}),e.jsx("option",{value:100,children:"100 / page"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>c(1),disabled:r===1,className:"p-2 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Première page",children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>c(r-1),disabled:r===1,className:"p-2 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Page précédente",children:e.jsx(J,{className:"h-4 w-4"})}),e.jsx("div",{className:"flex items-center gap-1",children:b().map((a,l)=>a==="..."?e.jsx("span",{className:"px-2 text-gray-500 dark:text-gray-400",children:"..."},`ellipsis-${l}`):e.jsx("button",{onClick:()=>c(a),className:`px-3 py-1 rounded-md text-sm font-medium transition-colors ${r===a?"bg-amber-500 text-white dark:bg-amber-600":"border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600"}`,children:a},a))}),e.jsx("button",{onClick:()=>c(r+1),disabled:r===d,className:"p-2 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Page suivante",children:e.jsx(K,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>c(d),disabled:r===d,className:"p-2 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Dernière page",children:e.jsx(Q,{className:"h-4 w-4"})})]})]})]})}function Pe({auth:v,categories:m,pagination:r,filters:d,permissions:g,routePrefix:p="pharmacy"}){const{url:j}=M(),[x,c]=f.useState(d?.search||""),[h,b]=f.useState(!1),[a,l]=f.useState(null),s=g?.view||!1,u=g?.create||!1,y=g?.update||!1,w=g?.delete||!1;if(!s)return e.jsxs(R,{children:[e.jsx(O,{title:"Accès refusé"}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:e.jsx(A,{className:"bg-white dark:bg-gray-800",children:e.jsxs(L,{className:"p-6 text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:"Accès refusé"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Vous n'avez pas la permission de voir les catégories."})]})})})})]});const _=i=>{i.preventDefault(),S.get(route(`${p}.categories.index`),{search:x})},k=()=>{if(!u){o.error("Vous n'avez pas la permission de créer une catégorie");return}l(null),b(!0)},E=i=>{if(!y){o.error("Vous n'avez pas la permission de modifier une catégorie");return}l(i),b(!0)},D=i=>{if(!w){o.error("Vous n'avez pas la permission de supprimer une catégorie");return}o.custom(N=>e.jsx("div",{className:`${N.visible?"animate-enter":"animate-leave"} max-w-md w-full bg-white dark:bg-gray-800 shadow-lg rounded-lg pointer-events-auto flex ring-1 ring-black ring-opacity-5`,children:e.jsxs("div",{className:"flex-1 w-0 p-4",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(B,{className:"h-6 w-6 text-red-600"})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Supprimer la catégorie"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:['Êtes-vous sûr de vouloir supprimer "',i.name,'" ? Cette action est irréversible.']})]})]}),e.jsxs("div",{className:"mt-4 flex space-x-3",children:[e.jsx("button",{onClick:async()=>{o.dismiss(N.id);try{S.delete(route(`${p}.categories.destroy`,i.id),{preserveScroll:!0,onSuccess:()=>{},onError:P=>{P.message&&o.error(P.message)}})}catch{o.error("Erreur lors de la suppression")}},className:"flex-1 bg-red-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-red-700 transition",children:"Supprimer"}),e.jsx("button",{onClick:()=>o.dismiss(N.id),className:"flex-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-md text-sm font-medium hover:bg-gray-200 dark:hover:bg-gray-600 transition",children:"Annuler"})]})]})}),{duration:1/0})},t=()=>{S.reload()},n=()=>{const i=new URLSearchParams;x&&i.append("search",x);const N=route(`${p}.categories.export.pdf`)+(i.toString()?"?"+i.toString():"");window.open(N,"_blank")};return e.jsxs(R,{header:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"font-semibold text-xl text-gray-800 dark:text-white leading-tight",children:"Gestion des Catégories"}),e.jsxs("div",{className:"flex gap-2",children:[s&&e.jsxs("button",{onClick:n,className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 px-4 py-2 h-10",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Exporter PDF"}),e.jsx("span",{className:"sm:hidden",children:"PDF"})]}),e.jsxs("button",{onClick:t,className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 px-4 py-2 h-10",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Actualiser"})]}),u&&e.jsxs("button",{onClick:k,className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-amber-500 text-white hover:bg-amber-600 dark:bg-amber-600 dark:text-white dark:hover:bg-amber-700 px-4 py-2 h-10 shadow-sm hover:shadow-md",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Ajouter une catégorie"}),e.jsx("span",{className:"sm:hidden",children:"Ajouter"})]})]})]}),children:[e.jsx(O,{title:"Gestion des Catégories"}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[e.jsxs(A,{className:"mb-6 bg-white dark:bg-gray-800",children:[e.jsx(z,{children:e.jsxs(V,{className:"flex items-center text-gray-900 dark:text-white",children:[e.jsx(T,{className:"h-5 w-5 mr-2"}),"Rechercher"]})}),e.jsx(L,{children:e.jsxs("form",{onSubmit:_,className:"flex flex-col sm:flex-row gap-4",children:[e.jsx(F,{placeholder:"Rechercher par nom ou description...",value:x,onChange:i=>c(i.target.value),className:"flex-1"}),e.jsxs("button",{type:"submit",className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-amber-500 text-white hover:bg-amber-600 dark:bg-amber-600 dark:text-white dark:hover:bg-amber-700 px-4 py-2 h-10 shadow-sm hover:shadow-md w-full sm:w-auto",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:"Rechercher"})]})]})})]}),e.jsxs(A,{className:"bg-white dark:bg-gray-800",children:[e.jsx(z,{children:e.jsxs(V,{className:"text-gray-900 dark:text-white",children:["Catégories ",r?`(${r.total})`:`(${m.length})`]})}),e.jsx(L,{className:"p-0",children:m.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(I,{className:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-white",children:"Aucune catégorie"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:x?"Aucune catégorie ne correspond à votre recherche.":"Commencez par créer une catégorie."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Nom"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Produits"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Statut"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:m.map(i=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(I,{className:"h-5 w-5 text-indigo-600 dark:text-indigo-400 mr-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:i.name}),i.parent&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Sous-catégorie de: ",i.parent.name]})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 max-w-xs truncate",children:i.description||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx($,{variant:"outline",children:i.products_count||0})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:i.is_active?e.jsx($,{variant:"success",children:"Active"}):e.jsx($,{variant:"destructive",children:"Inactive"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[y&&e.jsx("button",{onClick:()=>E(i),className:"text-indigo-600 dark:text-indigo-400 hover:text-indigo-900 dark:hover:text-indigo-300",title:"Modifier",children:e.jsx(Y,{className:"h-5 w-5"})}),w&&e.jsx("button",{onClick:()=>D(i),className:"text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300",title:"Supprimer",children:e.jsx(B,{className:"h-5 w-5"})})]})})]},i.id))})]})}),r&&e.jsx(le,{pagination:r,filters:d})]})})]})]})}),e.jsx(de,{isOpen:h,onClose:()=>{b(!1),l(null)},category:a,categories:m,canCreate:u,canUpdate:y,routePrefix:p})]})}export{Pe as default};
