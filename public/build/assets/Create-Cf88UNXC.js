import{u as A,r as n,j as e,H as I,L as v,c as U,a as z}from"./app-B8F_Smya.js";import{A as R,b as T,P as B}from"./AppLayout-Cyrikcek.js";import{C as g,a as f,b as y,c as N}from"./card-DwWU2KFG.js";import{B as d}from"./Button-BSACjJaD.js";import{I as m}from"./Input-DyZz_-qK.js";import{u as H}from"./use-toast-B6mi0Ih1.js";import{T as Q}from"./user-cog-Cgo5DVwg.js";import"./createLucideIcon-NKf32Z79.js";import"./shield-x-CXAQmM6w.js";import"./x-Ce9nIuKt.js";import"./Dropdown-CXpnj_1U.js";import"./transition-L_iZ831R.js";import"./arrow-left-uFeYT1yE.js";import"./loader-circle-5vrT9r4x.js";import"./refresh-cw-BeeT9s1l.js";import"./FlashMessages-CHIUDfR7.js";function ne({auth:G,products:x=[],suppliers:_=[]}){const{toast:l}=H(),{shop:o}=A().props,C=o?.currency||"CDF",[u,k]=n.useState(""),[h,w]=n.useState(""),[p,S]=n.useState(C),[a,c]=n.useState([{product_id:"",product_name:"",ordered_quantity:1,unit_cost:0}]),[L,j]=n.useState(!1),q=()=>{c([...a,{product_id:"",product_name:"",ordered_quantity:1,unit_cost:0}])},D=(t,r)=>{const s=[...a];s[t]={...s[t],product_id:r.id,product_name:r.name,unit_cost:r.cost_amount??0},c(s)},b=(t,r,s)=>{const i=[...a];i[t]={...i[t],[r]:s},c(i)},E=t=>{c(a.filter((r,s)=>s!==t))},F=async t=>{if(t.preventDefault(),!u){l({title:"Sélectionnez un fournisseur",variant:"destructive"});return}const r=a.filter(s=>s.product_id&&s.ordered_quantity>0&&Number(s.unit_cost)>=0);if(r.length===0){l({title:"Ajoutez au moins une ligne avec produit et quantité",variant:"destructive"});return}j(!0);try{await U.post(route("pharmacy.purchases.store"),{supplier_id:u,currency:p,expected_at:h||null,lines:r.map(s=>({product_id:s.product_id,ordered_quantity:Number(s.ordered_quantity),unit_cost:Number(s.unit_cost)}))}),l({title:"Bon de commande créé"}),z.visit(route("pharmacy.purchases.index"))}catch(s){l({title:"Erreur",description:s.response?.data?.message||"Erreur",variant:"destructive"})}finally{j(!1)}};return e.jsxs(R,{header:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold text-xl text-gray-800 dark:text-white leading-tight",children:"Nouveau bon de commande"}),e.jsx(d,{variant:"outline",asChild:!0,children:e.jsx(v,{href:route("pharmacy.purchases.index"),children:"Retour"})})]}),children:[e.jsx(I,{title:"Nouveau bon de commande"}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"max-w-4xl mx-auto sm:px-6 lg:px-8",children:e.jsxs("form",{onSubmit:F,children:[e.jsxs(g,{className:"mb-6",children:[e.jsx(f,{children:e.jsx(y,{children:"Fournisseur & dates"})}),e.jsxs(N,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Fournisseur *"}),e.jsxs("select",{className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:u,onChange:t=>k(t.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Choisir..."}),_.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Date livraison prévue"}),e.jsx(m,{type:"date",value:h,onChange:t=>w(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Devise"}),e.jsx("select",{className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:p,onChange:t=>S(t.target.value),children:o?.currencies&&o.currencies.length>0?o.currencies.map(t=>e.jsxs("option",{value:t.code,children:[t.code," - ",t.name]},t.code)):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"CDF",children:"CDF - Franc Congolais"}),e.jsx("option",{value:"USD",children:"USD - Dollar US"}),e.jsx("option",{value:"EUR",children:"EUR - Euro"})]})})]})]})]})]}),e.jsxs(g,{className:"mb-6",children:[e.jsx(f,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(y,{className:"flex items-center",children:[e.jsx(T,{className:"h-5 w-5 mr-2"}),"Lignes"]}),e.jsxs(d,{type:"button",variant:"outline",size:"sm",onClick:q,children:[e.jsx(B,{className:"h-4 w-4 mr-1"})," Ligne"]})]})}),e.jsx(N,{children:e.jsx("div",{className:"space-y-4",children:a.map((t,r)=>e.jsxs("div",{className:"flex flex-wrap items-end gap-4 p-4 border dark:border-gray-700 rounded",children:[e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Produit"}),e.jsxs("select",{className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:t.product_id,onChange:s=>{const i=x.find(P=>P.id===s.target.value);i&&D(r,i)},children:[e.jsx("option",{value:"",children:"Choisir..."}),x.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.code,")"]},s.id))]})]}),e.jsxs("div",{className:"w-24",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Qté"}),e.jsx(m,{type:"number",min:1,value:t.ordered_quantity,onChange:s=>b(r,"ordered_quantity",parseInt(s.target.value,10)||1)})]}),e.jsxs("div",{className:"w-28",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Prix d'achat"}),e.jsx(m,{type:"number",step:"0.01",min:0,value:t.unit_cost,onChange:s=>b(r,"unit_cost",parseFloat(s.target.value)||0)})]}),e.jsx(d,{type:"button",variant:"ghost",size:"sm",onClick:()=>E(r),disabled:a.length<=1,children:e.jsx(Q,{className:"h-4 w-4 text-red-500"})})]},r))})})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(d,{type:"button",variant:"outline",asChild:!0,children:e.jsx(v,{href:route("pharmacy.purchases.index"),children:"Annuler"})}),e.jsx(d,{type:"submit",disabled:L,children:"Enregistrer le bon de commande"})]})]})})})]})}export{ne as default};
