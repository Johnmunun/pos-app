import{b as q,r as p,j as e,n as o,a as N,u as H,H as R}from"./app-3PKVeuQh.js";import{W as M,Q as U,o as G,X as W,j as X,k as Q,Y,A as T,h as F,T as I,c as Z,Z as J,P as K}from"./AppLayout-DSrKCpOy.js";import{C as D,c as A,a as z,b as V}from"./card-FPNRX1p2.js";import{B as $}from"./Button-RC9FN5z3.js";import{I as O}from"./Input-5gvkn2nv.js";import{B as L}from"./badge-Ca6uIRAr.js";import{D as ee}from"./Drawer-DXvnJU94.js";import{L as k}from"./Label-DCTvEg5s.js";import{T as re}from"./textarea-g7yOinAB.js";import{s as ae,o as se}from"./syncService-CxsNbC8G.js";import{X as te}from"./x-YL0zAneP.js";import{T as B}from"./user-cog-nVqfHm0b.js";import{R as ie}from"./refresh-cw-L3GUbwVE.js";import"./createLucideIcon-CyiEew_u.js";import"./shield-x-gOy17OJ-.js";import"./Dropdown-B_QkibTR.js";import"./transition-CufTvwOt.js";import"./arrow-left-CvJq81LS.js";import"./loader-circle-D2tkCN5O.js";import"./FlashMessages-bPB7K-Ql.js";function ne({isOpen:b,onClose:m,category:a=null,categories:l=[],canCreate:g=!1,canUpdate:C=!1}){const x=!!a,{data:h,setData:c,post:u,put:y,processing:r,errors:n,reset:s}=q({name:a?.name||"",description:a?.description||"",parent_id:a?.parent_id||"",sort_order:a?.sort_order||0,is_active:a?.is_active!==void 0?a.is_active:!0}),[f,v]=p.useState(!navigator.onLine),[S,j]=p.useState("idle");p.useEffect(()=>{a?c({name:a.name||"",description:a.description||"",parent_id:a.parent_id||"",sort_order:a.sort_order||0,is_active:a.is_active!==void 0?a.is_active:!0}):s()},[a]),p.useEffect(()=>{const t=()=>{v(!1),ae.syncPendingCategories().then(()=>{j("synced")}).catch(()=>{j("error")})},d=()=>{v(!0),j("offline")};return window.addEventListener("online",t),window.addEventListener("offline",d),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",d)}},[]);const _=async t=>{if(t.preventDefault(),x&&!C){o.error("Vous n'avez pas la permission de modifier une catégorie");return}if(!x&&!g){o.error("Vous n'avez pas la permission de créer une catégorie");return}if(f||!navigator.onLine){try{const d={...h,id:a?.id||`pending_${Date.now()}`,shop_id:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};await se.savePendingCategory(d),o.success("Catégorie enregistrée localement. Synchronisation automatique à la reconnexion."),m(),s(),setTimeout(()=>{window.location.reload()},1e3)}catch(d){console.error("Error saving category offline:",d),o.error("Erreur lors de l'enregistrement local")}return}try{x?await y(route("pharmacy.categories.update",a.id),{preserveScroll:!0,onSuccess:()=>{m(),s()},onError:d=>{d.message&&o.error(d.message)}}):await u(route("pharmacy.categories.store"),{preserveScroll:!0,onSuccess:()=>{m(),s()},onError:d=>{d.message&&o.error(d.message)}})}catch(d){console.error("Error submitting category:",d),o.error("Erreur lors de la soumission")}},E=l.filter(t=>!a||t.id!==a.id);return e.jsx(ee,{isOpen:b,onClose:m,title:x?"Modifier la catégorie":"Ajouter une catégorie",children:e.jsxs("form",{onSubmit:_,className:"flex flex-col h-full",children:[e.jsx("div",{className:"mb-4 flex items-center gap-2 text-sm",children:f?e.jsxs("div",{className:"flex items-center text-amber-600 dark:text-amber-400",children:[e.jsx(M,{className:"h-4 w-4 mr-1"}),e.jsx("span",{children:"Mode hors ligne"})]}):S==="syncing"?e.jsxs("div",{className:"flex items-center text-blue-600 dark:text-blue-400",children:[e.jsx(U,{className:"h-4 w-4 mr-1 animate-spin"}),e.jsx("span",{children:"Synchronisation..."})]}):null}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4",children:[e.jsxs("div",{children:[e.jsxs(k,{htmlFor:"name",className:"text-gray-700 dark:text-gray-300",children:["Nom ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(O,{id:"name",type:"text",value:h.name,onChange:t=>c("name",t.target.value),className:"mt-1",required:!0,disabled:r}),n.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:n.name})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"description",className:"text-gray-700 dark:text-gray-300",children:"Description"}),e.jsx(re,{id:"description",value:h.description,onChange:t=>c("description",t.target.value),className:"mt-1",rows:3,disabled:r}),n.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:n.description})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"parent_id",className:"text-gray-700 dark:text-gray-300",children:"Catégorie parente"}),e.jsxs("select",{id:"parent_id",value:h.parent_id,onChange:t=>c("parent_id",t.target.value||""),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-amber-500 focus:ring-amber-500 dark:bg-gray-700 dark:text-white sm:text-sm",disabled:r,children:[e.jsx("option",{value:"",children:"Aucune (catégorie principale)"}),E.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),n.parent_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:n.parent_id})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"sort_order",className:"text-gray-700 dark:text-gray-300",children:"Ordre d'affichage"}),e.jsx(O,{id:"sort_order",type:"number",value:h.sort_order,onChange:t=>c("sort_order",parseInt(t.target.value)||0),className:"mt-1",min:"0",disabled:r}),n.sort_order&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:n.sort_order})]}),e.jsxs("div",{children:[e.jsxs(k,{className:"flex items-center space-x-2 text-gray-700 dark:text-gray-300",children:[e.jsx("input",{type:"checkbox",checked:h.is_active,onChange:t=>c("is_active",t.target.checked),className:"rounded border-gray-300 text-amber-600 focus:ring-amber-500 dark:border-gray-600 dark:bg-gray-700",disabled:r}),e.jsx("span",{children:"Catégorie active"})]}),n.is_active&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:n.is_active})]})]}),e.jsxs("div",{className:"mt-6 flex flex-col sm:flex-row gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs($,{type:"button",variant:"outline",onClick:m,className:"w-full sm:w-auto",disabled:r,children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Annuler"]}),e.jsxs($,{type:"submit",className:"w-full sm:w-auto bg-amber-500 dark:bg-amber-600 text-white hover:bg-amber-600 dark:hover:bg-amber-700",disabled:r,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),r?"Enregistrement...":x?"Enregistrer":"Créer"]})]})]})})}function de({pagination:b,filters:m={}}){if(!b||b.last_page<=1)return null;const{current_page:a,last_page:l,per_page:g,total:C,from:x,to:h}=b,c=r=>{N.get(route("pharmacy.categories.index"),{...m,page:r},{preserveState:!0,preserveScroll:!0})},u=r=>{N.get(route("pharmacy.categories.index"),{...m,per_page:r,page:1},{preserveState:!0,preserveScroll:!0})},y=()=>{const r=[];if(l<=7)for(let s=1;s<=l;s++)r.push(s);else if(a<=3){for(let s=1;s<=5;s++)r.push(s);r.push("..."),r.push(l)}else if(a>=l-2){r.push(1),r.push("...");for(let s=l-4;s<=l;s++)r.push(s)}else{r.push(1),r.push("...");for(let s=a-1;s<=a+1;s++)r.push(s);r.push("..."),r.push(l)}return r};return e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 px-4 py-3 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Affichage de ",e.jsx("span",{className:"font-medium",children:x})," à ",e.jsx("span",{className:"font-medium",children:h})," sur"," ",e.jsx("span",{className:"font-medium",children:C})," résultat(s)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:g,onChange:r=>u(r.target.value),className:"rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-amber-500 focus:ring-amber-500 dark:bg-gray-700 dark:text-white text-sm px-2 py-1",children:[e.jsx("option",{value:10,children:"10 / page"}),e.jsx("option",{value:15,children:"15 / page"}),e.jsx("option",{value:25,children:"25 / page"}),e.jsx("option",{value:50,children:"50 / page"}),e.jsx("option",{value:100,children:"100 / page"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>c(1),disabled:a===1,className:"p-2 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Première page",children:e.jsx(W,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>c(a-1),disabled:a===1,className:"p-2 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Page précédente",children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx("div",{className:"flex items-center gap-1",children:y().map((r,n)=>r==="..."?e.jsx("span",{className:"px-2 text-gray-500 dark:text-gray-400",children:"..."},`ellipsis-${n}`):e.jsx("button",{onClick:()=>c(r),className:`px-3 py-1 rounded-md text-sm font-medium transition-colors ${a===r?"bg-amber-500 text-white dark:bg-amber-600":"border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600"}`,children:r},r))}),e.jsx("button",{onClick:()=>c(a+1),disabled:a===l,className:"p-2 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Page suivante",children:e.jsx(Q,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>c(l),disabled:a===l,className:"p-2 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Dernière page",children:e.jsx(Y,{className:"h-4 w-4"})})]})]})]})}function Ee({auth:b,categories:m,pagination:a,filters:l,permissions:g}){const{url:C}=H(),[x,h]=p.useState(l?.search||""),[c,u]=p.useState(!1),[y,r]=p.useState(null),n=g?.view||!1,s=g?.create||!1,f=g?.update||!1,v=g?.delete||!1;if(!n)return e.jsxs(T,{children:[e.jsx(R,{title:"Accès refusé"}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:e.jsx(D,{className:"bg-white dark:bg-gray-800",children:e.jsxs(A,{className:"p-6 text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:"Accès refusé"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Vous n'avez pas la permission de voir les catégories."})]})})})})]});const S=i=>{i.preventDefault(),N.get(route("pharmacy.categories.index"),{search:x})},j=()=>{if(!s){o.error("Vous n'avez pas la permission de créer une catégorie");return}r(null),u(!0)},_=i=>{if(!f){o.error("Vous n'avez pas la permission de modifier une catégorie");return}r(i),u(!0)},E=i=>{if(!v){o.error("Vous n'avez pas la permission de supprimer une catégorie");return}o.custom(w=>e.jsx("div",{className:`${w.visible?"animate-enter":"animate-leave"} max-w-md w-full bg-white dark:bg-gray-800 shadow-lg rounded-lg pointer-events-auto flex ring-1 ring-black ring-opacity-5`,children:e.jsxs("div",{className:"flex-1 w-0 p-4",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(B,{className:"h-6 w-6 text-red-600"})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Supprimer la catégorie"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:['Êtes-vous sûr de vouloir supprimer "',i.name,'" ? Cette action est irréversible.']})]})]}),e.jsxs("div",{className:"mt-4 flex space-x-3",children:[e.jsx("button",{onClick:async()=>{o.dismiss(w.id);try{N.delete(route("pharmacy.categories.destroy",i.id),{preserveScroll:!0,onSuccess:()=>{},onError:P=>{P.message&&o.error(P.message)}})}catch{o.error("Erreur lors de la suppression")}},className:"flex-1 bg-red-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-red-700 transition",children:"Supprimer"}),e.jsx("button",{onClick:()=>o.dismiss(w.id),className:"flex-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-md text-sm font-medium hover:bg-gray-200 dark:hover:bg-gray-600 transition",children:"Annuler"})]})]})}),{duration:1/0})},t=()=>{N.reload()},d=()=>{const i=new URLSearchParams;x&&i.append("search",x);const w=route("pharmacy.categories.export.pdf")+(i.toString()?"?"+i.toString():"");window.open(w,"_blank")};return e.jsxs(T,{header:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"font-semibold text-xl text-gray-800 dark:text-white leading-tight",children:"Gestion des Catégories"}),e.jsxs("div",{className:"flex gap-2",children:[n&&e.jsxs("button",{onClick:d,className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 px-4 py-2 h-10",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Exporter PDF"}),e.jsx("span",{className:"sm:hidden",children:"PDF"})]}),e.jsxs("button",{onClick:t,className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 px-4 py-2 h-10",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Actualiser"})]}),s&&e.jsxs("button",{onClick:j,className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-amber-500 text-white hover:bg-amber-600 dark:bg-amber-600 dark:text-white dark:hover:bg-amber-700 px-4 py-2 h-10 shadow-sm hover:shadow-md",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Ajouter une catégorie"}),e.jsx("span",{className:"sm:hidden",children:"Ajouter"})]})]})]}),children:[e.jsx(R,{title:"Gestion des Catégories"}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[e.jsxs(D,{className:"mb-6 bg-white dark:bg-gray-800",children:[e.jsx(z,{children:e.jsxs(V,{className:"flex items-center text-gray-900 dark:text-white",children:[e.jsx(F,{className:"h-5 w-5 mr-2"}),"Rechercher"]})}),e.jsx(A,{children:e.jsxs("form",{onSubmit:S,className:"flex flex-col sm:flex-row gap-4",children:[e.jsx(O,{placeholder:"Rechercher par nom ou description...",value:x,onChange:i=>h(i.target.value),className:"flex-1"}),e.jsxs("button",{type:"submit",className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-amber-500 text-white hover:bg-amber-600 dark:bg-amber-600 dark:text-white dark:hover:bg-amber-700 px-4 py-2 h-10 shadow-sm hover:shadow-md w-full sm:w-auto",children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:"Rechercher"})]})]})})]}),e.jsxs(D,{className:"bg-white dark:bg-gray-800",children:[e.jsx(z,{children:e.jsxs(V,{className:"text-gray-900 dark:text-white",children:["Catégories ",a?`(${a.total})`:`(${m.length})`]})}),e.jsx(A,{className:"p-0",children:m.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(I,{className:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-white",children:"Aucune catégorie"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:x?"Aucune catégorie ne correspond à votre recherche.":"Commencez par créer une catégorie."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Nom"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Produits"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Statut"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:m.map(i=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(I,{className:"h-5 w-5 text-indigo-600 dark:text-indigo-400 mr-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:i.name}),i.parent&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Sous-catégorie de: ",i.parent.name]})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 max-w-xs truncate",children:i.description||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(L,{variant:"outline",children:i.products_count||0})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:i.is_active?e.jsx(L,{variant:"success",children:"Active"}):e.jsx(L,{variant:"destructive",children:"Inactive"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[f&&e.jsx("button",{onClick:()=>_(i),className:"text-indigo-600 dark:text-indigo-400 hover:text-indigo-900 dark:hover:text-indigo-300",title:"Modifier",children:e.jsx(Z,{className:"h-5 w-5"})}),v&&e.jsx("button",{onClick:()=>E(i),className:"text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300",title:"Supprimer",children:e.jsx(B,{className:"h-5 w-5"})})]})})]},i.id))})]})}),a&&e.jsx(de,{pagination:a,filters:l})]})})]})]})}),e.jsx(ne,{isOpen:c,onClose:()=>{u(!1),r(null)},category:y,categories:m,canCreate:s,canUpdate:f})]})}export{Ee as default};
