import{u as Z,b as ke,r as m,j as e,c as q,n as x,H as _e,a as Q}from"./app-DZtTOeIE.js";import{b as G,H as fe,a5 as Ce,$ as ye,a6 as Se,T as Pe,D as te,w as Ee,a as De,o as Ie,_ as Fe,h as Y,a4 as Re,n as Te,f as Ae,a7 as ze,j as Me,k as Le,a8 as qe,a9 as Ue,A as Oe,P as ae,E as Ve,K as ie,c as ne,C as $e,m as le,q as ce,e as Ge}from"./AppLayout-Bwi93PbD.js";import{C as de,a as oe,b as me,c as xe}from"./card-vlabImcc.js";import{B as v}from"./Button-BTh3B2Uw.js";import{I as b}from"./Input--MgEb_Nf.js";import{B as L}from"./badge-BDQ0rHun.js";import{M as he}from"./Modal-CKblTyKt.js";import{D as He}from"./Drawer-DwT_q8h7.js";import{L as g}from"./Label-CgyD4LXG.js";import{T as Be}from"./textarea-JCPRrjpX.js";import{o as We}from"./syncService-1c5vOEXF.js";import{X as J,C as Je}from"./x-CXs6YGQp.js";import{L as X}from"./loader-circle-DAnXRmQH.js";import{R as ue}from"./refresh-cw-BgZ2dbVR.js";import{C as Xe,T as Qe}from"./user-cog-HidSeQFU.js";import"./createLucideIcon-CC-qNPM4.js";import"./shield-x-BMsLrHBM.js";import"./Dropdown-BcljNwe3.js";import"./transition-DLc2G3IG.js";import"./arrow-left-B06KhL06.js";import"./FlashMessages-DVzYx1sH.js";const Ke="pos-saas-images-v1",ge=50*1024*1024;class Ye{constructor(){this.cache=null,this.initPromise=null}async init(){return this.initPromise?this.initPromise:"caches"in window?(this.initPromise=caches.open(Ke).then(i=>(this.cache=i,i)),this.initPromise):Promise.resolve(null)}async isCached(i){if(this.cache||await this.init(),!this.cache)return!1;try{return!!await this.cache.match(i)}catch(s){return console.warn("Error checking image cache:",s),!1}}async getImage(i){if(this.cache||await this.init(),!this.cache)return i;try{const s=await this.cache.match(i);if(s)return URL.createObjectURL(await s.blob());if(navigator.onLine){const h=await fetch(i);if(h.ok){const f=h.headers.get("content-length");if(f&&parseInt(f)>ge)return i;const k=h.clone();return await this.cache.put(i,k),URL.createObjectURL(await h.blob())}}return i}catch(s){return console.warn("Error fetching image:",s),i}}async cacheImage(i){if(this.cache||await this.init(),!this.cache||!navigator.onLine)return!1;try{if(await this.isCached(i))return!0;const s=await fetch(i);if(s.ok){const h=s.headers.get("content-length");return h&&parseInt(h)>ge?!1:(await this.cache.put(i,s.clone()),!0)}}catch(s){console.warn("Error caching image:",s)}return!1}async removeImage(i){if(this.cache||await this.init(),!this.cache)return!1;try{return await this.cache.delete(i)}catch(s){return console.warn("Error removing image from cache:",s),!1}}async cleanCache(){if(this.cache||await this.init(),!!this.cache)try{const i=await this.cache.keys();if(i.length>100){const s=i.slice(0,i.length-100);await Promise.all(s.map(h=>this.cache.delete(h)))}}catch(i){console.warn("Error cleaning cache:",i)}}async getCacheSize(){if(this.cache||await this.init(),!this.cache)return 0;try{const i=await this.cache.keys();let s=0;for(const h of i){const f=await this.cache.match(h);if(f){const k=await f.blob();s+=k.size}}return s}catch(i){return console.warn("Error calculating cache size:",i),0}}}const pe=new Ye;function Ze({isOpen:I,onClose:i,product:s=null,categories:h=[]}){const f=!!s,{shop:k}=Z().props,H=k?.currency||"CDF",{data:n,setData:o,post:F,put:B,processing:P,errors:l,reset:R}=ke({name:s?.name||"",product_code:s?.product_code||"",description:s?.description||"",category_id:s?.category_id||"",price:s?.price_amount||"",currency:s?.price_currency||H,cost:s?.cost||"",minimum_stock:s?.minimum_stock||"",unit:s?.unit||"",medicine_type:s?.medicine_type||"",dosage:s?.dosage||"",prescription_required:s?.prescription_required||!1,manufacturer:s?.manufacturer||"",wholesale_price:s?.wholesale_price_amount??"",wholesale_min_quantity:s?.wholesale_min_quantity??"",supplier_id:s?.supplier_id||"",image:null,image_url:s?.image_url||"",remove_image:!1}),[T,U]=m.useState(!!s?.medicine_type),[y,N]=m.useState(s?.image_url||null),[A,O]=m.useState(!1),[z,u]=m.useState([]),[c,S]=m.useState(!1);m.useEffect(()=>{I&&(async()=>{S(!0);try{const p=await q.get(route("pharmacy.suppliers.active"));p.data.success&&u(p.data.suppliers||[])}catch(p){console.error("Error loading suppliers:",p)}finally{S(!1)}})()},[I]),m.useEffect(()=>{s?(o({name:s.name||"",product_code:s.product_code||"",description:s.description||"",category_id:s.category_id||"",price:s.price_amount||"",currency:s.price_currency||H,cost:s.cost||"",minimum_stock:s.minimum_stock||"",unit:s.unit||"",medicine_type:s.medicine_type||"",dosage:s.dosage||"",prescription_required:s.prescription_required||!1,manufacturer:s.manufacturer||"",wholesale_price:s.wholesale_price_amount??"",wholesale_min_quantity:s.wholesale_min_quantity??"",supplier_id:s.supplier_id||"",image:null,image_url:s.image_url||"",remove_image:!1}),U(!!s.medicine_type),s.image_url?pe.getImage(s.image_url).then(t=>{N(t)}).catch(()=>{N(s.image_url)}):N(null)):(R(),U(!1),N(null))},[s]);const E=t=>{const p=t.target.files[0];if(p){const r=["image/jpeg","image/jpg","image/png","image/webp"];if(p.size>2097152){x.error("L'image ne doit pas dépasser 2 Mo");return}if(!r.includes(p.type)){x.error("Format d'image non supporté. Utilisez JPG, PNG ou WebP");return}o("image",p),o("remove_image",!1);const d=new FileReader;d.onloadend=()=>{N(d.result)},d.readAsDataURL(p)}},D=()=>{o("image",null),o("image_url",""),o("remove_image",!0),N(null)},V=async()=>{if(!n.name){x.error("Veuillez d'abord saisir le nom du produit.");return}if(!navigator.onLine){x.error("La génération automatique du code nécessite une connexion internet.");return}try{O(!0);const t=await q.get(route("pharmacy.products.generate-code"),{params:{name:n.name}});t.data?.code?(o("product_code",t.data.code),x.success("Code produit généré automatiquement.")):x.error("Impossible de générer un code produit. Réessayez.")}catch(t){console.error(t),x.error(t.response?.data?.message||"Erreur lors de la génération du code produit.")}finally{O(!1)}},W=async t=>{t.preventDefault();const p=navigator.onLine,M={name:n.name,product_code:n.product_code,description:n.description,category_id:n.category_id,price:n.price,currency:n.currency,cost:n.cost,minimum_stock:n.minimum_stock,unit:n.unit,medicine_type:n.medicine_type,dosage:n.dosage,prescription_required:n.prescription_required,manufacturer:n.manufacturer,wholesale_price:n.wholesale_price||null,wholesale_min_quantity:n.wholesale_min_quantity||null,supplier_id:n.supplier_id};if(p){const r=new FormData;Object.keys(M).forEach(d=>{const w=M[d];w!=null&&(typeof w=="boolean"?r.append(d,w?"1":"0"):r.append(d,w))}),n.image&&r.append("image",n.image),n.remove_image&&r.append("remove_image","1");try{f?(r.append("_method","PUT"),await q.post(route("pharmacy.products.update",s.id),r,{headers:{"Content-Type":"multipart/form-data"}}),x.success("Produit mis à jour avec succès")):(await q.post(route("pharmacy.products.store"),r,{headers:{"Content-Type":"multipart/form-data"}}),x.success("Produit créé avec succès")),n.image&&y&&await pe.cacheImage(y),i(),R(),N(null),window.location.reload()}catch(d){x.error(d.response?.data?.message||"Erreur lors de l'enregistrement"),console.error(d)}}else try{const r=f?s.id:null,d=await We.savePendingProduct({...M,id:r},n.image);x.success("Produit enregistré localement. Synchronisation automatique à la reconnexion.",{icon:e.jsx(Fe,{className:"h-5 w-5"}),duration:5e3}),i(),R(),N(null),window.location.reload()}catch(r){x.error("Erreur lors de l'enregistrement local"),console.error(r)}},$=()=>{R(),i()};return e.jsx(He,{isOpen:I,onClose:$,title:f?"Modifier le produit":"Nouveau produit",size:"xl",children:e.jsxs("form",{onSubmit:W,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(G,{className:"h-5 w-5 mr-2"}),"Informations de base"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"name",children:"Nom du produit *"}),e.jsx(b,{id:"name",value:n.name,onChange:t=>o("name",t.target.value),placeholder:"Nom du produit",className:"w-full"}),l.name&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"product_code",children:"Code produit *"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(fe,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400 dark:text-gray-500"}),e.jsx(b,{id:"product_code",value:n.product_code,onChange:t=>o("product_code",t.target.value),placeholder:"PROD-001",className:"pl-10 w-full"})]}),e.jsxs(v,{type:"button",variant:"outline",size:"sm",onClick:V,disabled:A,className:"whitespace-nowrap",children:[e.jsx(Ce,{className:"h-4 w-4 mr-1"}),A?"Génération...":"Auto"]})]}),l.product_code&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.product_code})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"description",children:"Description"}),e.jsx(Be,{id:"description",value:n.description,onChange:t=>o("description",t.target.value),placeholder:"Description du produit...",rows:3,className:"w-full"}),l.description&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.description})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"image",children:"Image du produit"}),e.jsxs("div",{className:"space-y-3",children:[y&&e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:y,alt:"Preview",className:"h-32 w-32 object-cover rounded-lg border-2 border-gray-300 dark:border-gray-600"}),e.jsx("button",{type:"button",onClick:D,className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors","aria-label":"Supprimer l'image",children:e.jsx(J,{className:"h-4 w-4"})})]}),!y&&e.jsxs("label",{htmlFor:"image",className:"flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 dark:border-gray-600 border-dashed rounded-lg cursor-pointer bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx(ye,{className:"w-8 h-8 mb-2 text-gray-400 dark:text-gray-500"}),e.jsxs("p",{className:"mb-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-semibold",children:"Cliquez pour uploader"})," ou glissez-déposez"]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"JPG, PNG ou WebP (MAX. 2 Mo)"})]}),e.jsx("input",{id:"image",type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",className:"hidden",onChange:E})]}),y&&e.jsxs("label",{htmlFor:"image",className:"inline-flex items-center justify-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 cursor-pointer transition-colors",children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Remplacer l'image",e.jsx("input",{id:"image",type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",className:"hidden",onChange:E})]})]}),l.image&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.image})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"category_id",children:"Catégorie *"}),e.jsxs("div",{className:"relative",children:[e.jsx(Pe,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400 dark:text-gray-500"}),e.jsxs("select",{id:"category_id",value:n.category_id,onChange:t=>o("category_id",t.target.value),className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white pl-10 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Sélectionner une catégorie"}),h.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),l.category_id&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.category_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"unit",children:"Unité *"}),e.jsx(b,{id:"unit",value:n.unit,onChange:t=>o("unit",t.target.value),placeholder:"ex: bouteille, boîte, comprimé",className:"w-full"}),l.unit&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.unit})]})]})]}),e.jsxs("div",{className:"space-y-4 border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(te,{className:"h-5 w-5 mr-2"}),"Informations de prix"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"price",children:"Prix de vente *"}),e.jsx(b,{id:"price",type:"number",step:"0.01",value:n.price,onChange:t=>o("price",t.target.value),placeholder:"0.00",className:"w-full"}),l.price&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.price})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"cost",children:"Prix de revient"}),e.jsx(b,{id:"cost",type:"number",step:"0.01",value:n.cost,onChange:t=>o("cost",t.target.value),placeholder:"0.00",className:"w-full"}),l.cost&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.cost})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"currency",children:"Devise *"}),e.jsx("select",{id:"currency",value:n.currency,onChange:t=>o("currency",t.target.value),className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:k?.currencies&&k.currencies.length>0?k.currencies.map(t=>e.jsxs("option",{value:t.code,children:[t.code," - ",t.name]},t.code)):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"CDF",children:"CDF - Franc Congolais"}),e.jsx("option",{value:"USD",children:"USD - Dollar US"}),e.jsx("option",{value:"EUR",children:"EUR - Euro"})]})}),l.currency&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.currency})]})]})]}),e.jsxs("div",{className:"space-y-4 border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(te,{className:"h-5 w-5 mr-2"}),"Vente en gros"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"wholesale_price",children:"Prix gros (optionnel)"}),e.jsx(b,{id:"wholesale_price",type:"number",min:"0",step:"0.01",value:n.wholesale_price,onChange:t=>o("wholesale_price",t.target.value),placeholder:"Prix unitaire en gros",className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"wholesale_min_quantity",children:"Qté min. pour prix gros"}),e.jsx(b,{id:"wholesale_min_quantity",type:"number",min:"0",value:n.wholesale_min_quantity,onChange:t=>o("wholesale_min_quantity",t.target.value),placeholder:"Ex: 10",className:"w-full"})]})]})]}),e.jsxs("div",{className:"space-y-4 border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(Ee,{className:"h-5 w-5 mr-2"}),"Paramètres de stock"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"minimum_stock",children:"Stock minimum *"}),e.jsx(b,{id:"minimum_stock",type:"number",value:n.minimum_stock,onChange:t=>o("minimum_stock",t.target.value),placeholder:"10",className:"w-full"}),l.minimum_stock&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.minimum_stock})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"manufacturer",children:"Fabricant"}),e.jsx(b,{id:"manufacturer",value:n.manufacturer,onChange:t=>o("manufacturer",t.target.value),placeholder:"Nom du fabricant",className:"w-full"}),l.manufacturer&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.manufacturer})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"supplier_id",children:"Fournisseur"}),e.jsxs("select",{id:"supplier_id",value:n.supplier_id,onChange:t=>o("supplier_id",t.target.value),disabled:c,className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:c?"Chargement...":"Sélectionner un fournisseur"}),z.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),l.supplier_id&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.supplier_id})]})]}),e.jsxs("div",{className:"space-y-4 border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(De,{className:"h-5 w-5 mr-2"}),"Informations médicament"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:T,onChange:t=>U(t.target.checked),className:"rounded border-gray-300 dark:border-gray-600 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600 dark:text-gray-400",children:"C'est un médicament"})]})]}),T&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"medicine_type",children:"Type de médicament"}),e.jsxs("select",{id:"medicine_type",value:n.medicine_type,onChange:t=>o("medicine_type",t.target.value),className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Sélectionner un type"}),e.jsx("option",{value:"MEDICINE",children:"Médicament"}),e.jsx("option",{value:"PARAPHARMACY",children:"Parapharmacie"}),e.jsx("option",{value:"DEVICE",children:"Dispositif médical"}),e.jsx("option",{value:"VACCINE",children:"Vaccin"}),e.jsx("option",{value:"NUTRITION",children:"Nutrition"})]}),l.medicine_type&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.medicine_type})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"dosage",children:"Dosage"}),e.jsx(b,{id:"dosage",value:n.dosage,onChange:t=>o("dosage",t.target.value),placeholder:"ex: 500mg, 10ml",className:"w-full"}),l.dosage&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.dosage})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"prescription_required",checked:n.prescription_required,onChange:t=>o("prescription_required",t.target.checked),className:"rounded border-gray-300 dark:border-gray-600 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"}),e.jsx(g,{htmlFor:"prescription_required",className:"ml-2",children:"Prescription requise"})]}),l.prescription_required&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.prescription_required})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-3 sm:gap-4 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("button",{type:"button",onClick:$,disabled:P,className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 px-4 py-2 h-10 w-full sm:w-auto",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Annuler"]}),e.jsxs("button",{type:"submit",disabled:P,className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-amber-500 text-white hover:bg-amber-600 dark:bg-amber-600 dark:text-white dark:hover:bg-amber-700 px-4 py-2 h-10 shadow-sm hover:shadow-md w-full sm:w-auto",children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:P?f?"Mise à jour...":"Création...":f?"Enregistrer":"Créer"}),e.jsx("span",{className:"sm:hidden",children:P?"...":f?"Enregistrer":"Créer"})]})]})]})})}const K=20;function es({isOpen:I,onClose:i,product:s=null,initialFilters:h={}}){const{auth:f,shop:k}=Z().props,H=f?.permissions||[];k?.currency;const n=r=>f?.user?.type==="ROOT"?!0:H.includes(r),o=n("stock.movement.view"),F=n("stock.movement.print"),[B,P]=m.useState(!1),[l,R]=m.useState([]),[T,U]=m.useState({total_movements:0,total_in:0,total_out:0,total_adjustment:0}),[y,N]=m.useState(1),[A,O]=m.useState(!1),[z,u]=m.useState(null),[c,S]=m.useState({product_id:s?.id||h.product_id||"",product_name:s?.name||h.product_name||"",product_code:h.product_code||"",type:h.type||"",from:h.from||"",to:h.to||""}),E=m.useCallback(async()=>{if(!o){x.error("Vous n'avez pas la permission de voir les mouvements");return}P(!0);try{const r=new URLSearchParams;c.product_id&&r.append("product_id",c.product_id),c.product_name&&r.append("product_name",c.product_name),c.product_code&&r.append("product_code",c.product_code),c.type&&r.append("type",c.type),c.from&&r.append("from",c.from),c.to&&r.append("to",c.to);const d=await q.get(`/api/pharmacy/product-movements?${r.toString()}`);R(d.data.movements||[]),U(d.data.stats||{}),N(1)}catch(r){console.error("Error loading movements:",r),x.error("Erreur lors du chargement des mouvements")}finally{P(!1)}},[c,o]);m.useEffect(()=>{I&&o&&E()},[I,o]),m.useEffect(()=>{s&&S(r=>({...r,product_id:s.id,product_name:s.name}))},[s]);const D=Math.ceil(l.length/K),V=l.slice((y-1)*K,y*K),W=async()=>{if(!F){x.error("Vous n'avez pas la permission d'imprimer");return}O(!0);try{const r=new URLSearchParams;c.product_id&&r.append("product_id",c.product_id),c.product_name&&r.append("product_name",c.product_name),c.product_code&&r.append("product_code",c.product_code),c.type&&r.append("type",c.type),c.from&&r.append("from",c.from),c.to&&r.append("to",c.to);const d=await q.get(`/api/pharmacy/product-movements/export/pdf?${r.toString()}`,{responseType:"blob"}),w=window.URL.createObjectURL(new Blob([d.data])),_=document.createElement("a");_.href=w,_.setAttribute("download",`mouvements_stock_${new Date().toISOString().slice(0,10)}.pdf`),document.body.appendChild(_),_.click(),_.remove(),window.URL.revokeObjectURL(w),x.success("Export PDF généré avec succès")}catch(r){console.error("Error exporting:",r),x.error("Erreur lors de l'export PDF")}finally{O(!1)}},$=async r=>{if(!F){x.error("Vous n'avez pas la permission d'imprimer");return}u(r);try{const d=await q.get(`/api/pharmacy/product-movements/${r}/pdf`,{responseType:"blob"}),w=window.URL.createObjectURL(new Blob([d.data])),_=document.createElement("a");_.href=w,_.setAttribute("download",`mouvement_${r.slice(0,8)}.pdf`),document.body.appendChild(_),_.click(),_.remove(),window.URL.revokeObjectURL(w),x.success("Fiche de mouvement générée")}catch(d){console.error("Error exporting single:",d),x.error("Erreur lors de l'export")}finally{u(null)}},t=()=>{S({product_id:s?.id||"",product_name:s?.name||"",product_code:"",type:"",from:"",to:""})},p=r=>{switch(r){case"IN":return e.jsxs(L,{className:"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300",children:[e.jsx(Ue,{className:"h-3 w-3 mr-1"}),"Entrée"]});case"OUT":return e.jsxs(L,{className:"bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300",children:[e.jsx(qe,{className:"h-3 w-3 mr-1"}),"Sortie"]});case"ADJUSTMENT":return e.jsxs(L,{className:"bg-orange-100 text-orange-800 dark:bg-orange-900/50 dark:text-orange-300",children:[e.jsx(Xe,{className:"h-3 w-3 mr-1"}),"Ajustement"]});case"RETURN":return e.jsxs(L,{className:"bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300",children:[e.jsx(ue,{className:"h-3 w-3 mr-1"}),"Retour"]});default:return e.jsx(L,{children:r})}},M=(r,d)=>{switch(r){case"IN":case"RETURN":return e.jsxs("span",{className:"text-green-600 dark:text-green-400 font-semibold",children:["+",d]});case"OUT":return e.jsxs("span",{className:"text-red-600 dark:text-red-400 font-semibold",children:["-",d]});default:return e.jsx("span",{className:"text-orange-600 dark:text-orange-400 font-semibold",children:d})}};return I?e.jsxs("div",{className:"fixed inset-0 z-50 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 transition-opacity",onClick:i}),e.jsxs("div",{className:"absolute inset-4 md:inset-8 lg:inset-12 bg-white dark:bg-slate-900 rounded-xl shadow-2xl flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center",children:e.jsx(G,{className:"h-5 w-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Historique des Mouvements"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:s?`Produit: ${s.name}`:"Tous les produits"})]})]}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-gray-200 dark:hover:bg-slate-700 rounded-lg transition-colors",children:e.jsx(J,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})})]}),e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-slate-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Total mouvements"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:T.total_movements})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400",children:"Entrées"}),e.jsxs("p",{className:"text-xl font-bold text-green-700 dark:text-green-300",children:["+",T.total_in]})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:"Sorties"}),e.jsxs("p",{className:"text-xl font-bold text-red-700 dark:text-red-300",children:["-",T.total_out]})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-orange-600 dark:text-orange-400",children:"Ajustements"}),e.jsx("p",{className:"text-xl font-bold text-orange-700 dark:text-orange-300",children:T.total_adjustment})]})]})}),e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800/50",children:e.jsxs("div",{className:"flex flex-wrap items-end gap-4",children:[!s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1 min-w-[180px]",children:[e.jsx(g,{className:"text-xs mb-1 block",children:"Nom produit"}),e.jsx(b,{type:"text",placeholder:"Rechercher...",value:c.product_name,onChange:r=>S(d=>({...d,product_name:r.target.value})),className:"h-9"})]}),e.jsxs("div",{className:"w-[140px]",children:[e.jsx(g,{className:"text-xs mb-1 block",children:"Code produit"}),e.jsx(b,{type:"text",placeholder:"Code...",value:c.product_code,onChange:r=>S(d=>({...d,product_code:r.target.value})),className:"h-9"})]})]}),e.jsxs("div",{className:"w-[130px]",children:[e.jsx(g,{className:"text-xs mb-1 block",children:"Type"}),e.jsxs("select",{value:c.type,onChange:r=>S(d=>({...d,type:r.target.value})),className:"w-full h-9 rounded-md border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-gray-900 dark:text-white text-sm px-2",children:[e.jsx("option",{value:"",children:"Tous"}),e.jsx("option",{value:"IN",children:"Entrée"}),e.jsx("option",{value:"OUT",children:"Sortie"}),e.jsx("option",{value:"ADJUSTMENT",children:"Ajustement"})]})]}),e.jsxs("div",{className:"w-[140px]",children:[e.jsx(g,{className:"text-xs mb-1 block",children:"Date début"}),e.jsx(b,{type:"date",value:c.from,onChange:r=>S(d=>({...d,from:r.target.value})),className:"h-9"})]}),e.jsxs("div",{className:"w-[140px]",children:[e.jsx(g,{className:"text-xs mb-1 block",children:"Date fin"}),e.jsx(b,{type:"date",value:c.to,onChange:r=>S(d=>({...d,to:r.target.value})),className:"h-9"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{onClick:E,disabled:B,size:"sm",className:"h-9",children:[B?e.jsx(X,{className:"h-4 w-4 animate-spin"}):e.jsx(Y,{className:"h-4 w-4"}),e.jsx("span",{className:"ml-1",children:"Filtrer"})]}),e.jsx(v,{onClick:t,variant:"outline",size:"sm",className:"h-9",children:e.jsx(ue,{className:"h-4 w-4"})})]}),F&&e.jsxs(v,{onClick:W,disabled:A||l.length===0,variant:"outline",size:"sm",className:"h-9 ml-auto",children:[A?e.jsx(X,{className:"h-4 w-4 animate-spin"}):e.jsx(Re,{className:"h-4 w-4"}),e.jsx("span",{className:"ml-1",children:"Export PDF"})]})]})}),e.jsx("div",{className:"flex-1 overflow-auto",children:B?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(X,{className:"h-8 w-8 animate-spin text-amber-500"})}):l.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500 dark:text-gray-400",children:[e.jsx(G,{className:"h-16 w-16 mb-4 opacity-30"}),e.jsx("p",{className:"text-lg font-medium",children:"Aucun mouvement trouvé"}),e.jsx("p",{className:"text-sm",children:"Modifiez vos filtres pour voir les résultats"})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-slate-800 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Date"}),!s&&e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Produit"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Référence"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Quantité"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Utilisateur"}),F&&e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-slate-700",children:V.map(r=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:r.created_at_formatted})]})}),!s&&e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:r.product_name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:r.product_code})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:r.reference||"—"})]})}),e.jsx("td",{className:"px-4 py-3 text-center",children:p(r.type)}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("span",{className:"text-lg",children:M(r.type,r.quantity)})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:r.created_by_name})]})}),F&&e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>$(r.id),disabled:z===r.id,title:"Imprimer fiche",children:z===r.id?e.jsx(X,{className:"h-4 w-4 animate-spin"}):e.jsx(ze,{className:"h-4 w-4"})})})]},r.id))})]})}),D>1&&e.jsxs("div",{className:"px-6 py-3 border-t border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800 flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Page ",y," sur ",D," (",l.length," mouvements)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{variant:"outline",size:"sm",onClick:()=>N(r=>Math.max(1,r-1)),disabled:y===1,children:e.jsx(Me,{className:"h-4 w-4"})}),e.jsx(v,{variant:"outline",size:"sm",onClick:()=>N(r=>Math.min(D,r+1)),disabled:y===D,children:e.jsx(Le,{className:"h-4 w-4"})})]})]})]})]}):null}function Ns({auth:I,products:i,categories:s,filters:h,canImport:f=!1}){const{auth:k}=Z().props,H=k?.permissions||[],o=(a=>k?.user?.type==="ROOT"?!0:H.includes(a))("stock.movement.view"),[F,B]=m.useState(h?.search||""),[P,l]=m.useState(h?.category_id||""),[R,T]=m.useState(h?.status||""),[U,y]=m.useState(!1),[N,A]=m.useState(null),[O,z]=m.useState(!1),[u,c]=m.useState(null),[S,E]=m.useState(!1),[D,V]=m.useState(null),[W,$]=m.useState(!1),[t,p]=m.useState(null),[M,r]=m.useState(!1),[d,w]=m.useState(null),_=a=>{a.preventDefault(),Q.get(route("pharmacy.products"),{search:F,category_id:P,status:R||void 0})},je=()=>{E(!0),V(null),p(null)},be=async a=>{if(a.preventDefault(),!D){x.error("Veuillez sélectionner un fichier.");return}$(!0),p(null);try{const j=new FormData;j.append("file",D);const C=await q.post(route("pharmacy.products.import"),j,{headers:{"Content-Type":"multipart/form-data"}});p(C.data),C.data.success>0&&(x.success(`${C.data.success} produit(s) importé(s) avec succès.`),Q.reload()),C.data.failed>0&&C.data.errors?.length&&x.error(`${C.data.failed} ligne(s) en erreur.`)}catch(j){const C=j.response?.data?.message||"Erreur lors de l'import.";x.error(C),p({success:0,failed:0,total:0,errors:[C]})}finally{$(!1)}},ee=()=>{A(null),y(!0)},se=a=>{A(a),y(!0)},ve=a=>{c(a),z(!0)},re=(a=null)=>{w(a),r(!0)},Ne=a=>{x.custom(j=>e.jsx("div",{className:`${j.visible?"animate-enter":"animate-leave"} max-w-md w-full bg-white dark:bg-gray-800 shadow-lg rounded-lg pointer-events-auto flex ring-1 ring-black ring-opacity-5`,children:e.jsxs("div",{className:"flex-1 w-0 p-4",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Ge,{className:"h-6 w-6 text-red-600 dark:text-red-400"})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Confirmer la suppression"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:['Êtes-vous sûr de vouloir supprimer "',a.name,'" ? Cette action est irréversible.']})]})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{onClick:()=>{x.dismiss(j.id),Q.delete(route("pharmacy.products.destroy",a.id),{preserveScroll:!0,onSuccess:()=>{x.success("Produit supprimé avec succès")},onError:C=>{x.error(C.message||"Erreur lors de la suppression du produit")}})},className:"flex-1 bg-red-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-red-700 transition",children:"Supprimer"}),e.jsx("button",{onClick:()=>x.dismiss(j.id),className:"flex-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-md text-sm font-medium hover:bg-gray-200 dark:hover:bg-gray-600 transition",children:"Annuler"})]})]})}),{duration:1/0})},we=a=>{const j=a.current_stock??a.stock??0,C=a.minimum_stock??0;return j<=0?e.jsx(L,{variant:"destructive",children:"Out of Stock"}):j<=C?e.jsx(L,{variant:"warning",children:"Low Stock"}):e.jsx(L,{variant:"success",children:"In Stock"})};return e.jsxs(Oe,{header:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"font-semibold text-xl text-gray-800 dark:text-white leading-tight",children:"Gestion des Produits"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"hidden sm:flex items-center gap-2",children:[e.jsxs("a",{href:i.length?route("pharmacy.products.export.pdf"):"#",target:"_blank",rel:"noreferrer","aria-disabled":i.length===0,className:`inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 px-3 h-10 shadow-sm hover:shadow-md ${i.length===0?"opacity-50 cursor-not-allowed pointer-events-none bg-rose-400 text-white/80":"bg-rose-500 text-white hover:bg-rose-600 dark:bg-rose-600 dark:hover:bg-rose-700"}`,children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Exporter PDF"]}),e.jsxs("a",{href:i.length?route("pharmacy.products.export.excel"):"#","aria-disabled":i.length===0,className:`inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 px-3 h-10 shadow-sm hover:shadow-md ${i.length===0?"opacity-50 cursor-not-allowed pointer-events-none bg-emerald-400 text-white/80":"bg-emerald-500 text-white hover:bg-emerald-600 dark:bg-emerald-600 dark:hover:bg-emerald-700"}`,children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Exporter Excel"]})]}),e.jsxs("div",{className:"flex sm:hidden items-center gap-2",children:[e.jsxs("a",{href:i.length?route("pharmacy.products.export.pdf"):"#",target:"_blank",rel:"noreferrer","aria-disabled":i.length===0,className:`inline-flex items-center justify-center rounded-md text-xs font-medium px-2 h-8 shadow-sm ${i.length===0?"opacity-50 cursor-not-allowed pointer-events-none bg-rose-400 text-white/80":"bg-rose-500 text-white hover:bg-rose-600"}`,children:[e.jsx(le,{className:"h-3 w-3 mr-1"}),"PDF"]}),e.jsxs("a",{href:i.length?route("pharmacy.products.export.excel"):"#","aria-disabled":i.length===0,className:`inline-flex items-center justify-center rounded-md text-xs font-medium px-2 h-8 shadow-sm ${i.length===0?"opacity-50 cursor-not-allowed pointer-events-none bg-emerald-400 text-white/80":"bg-emerald-500 text-white hover:bg-emerald-600"}`,children:[e.jsx(ce,{className:"h-3 w-3 mr-1"}),"Excel"]})]}),o&&e.jsxs("button",{type:"button",onClick:()=>re(null),className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-500 focus-visible:ring-offset-2 px-3 h-10 shadow-sm hover:shadow-md bg-amber-100 text-amber-700 hover:bg-amber-200 dark:bg-amber-900/50 dark:text-amber-300 dark:hover:bg-amber-900/70 border border-amber-300 dark:border-amber-700",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Historique"})]}),f&&e.jsxs("button",{type:"button",onClick:je,className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 px-3 h-10 shadow-sm hover:shadow-md bg-blue-500 text-white hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Importer"})]}),e.jsxs("button",{onClick:ee,className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-amber-500 text-white hover:bg-amber-600 dark:bg-amber-600 dark:text-white dark:hover:bg-amber-700 px-4 py-2 h-10 shadow-sm hover:shadow-md",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Ajouter un produit"}),e.jsx("span",{className:"sm:hidden",children:"Ajouter"})]})]})]}),children:[e.jsx(_e,{title:"Gestion des Produits"}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[e.jsxs(de,{className:"mb-6 bg-white dark:bg-gray-800",children:[e.jsx(oe,{children:e.jsxs(me,{className:"flex items-center text-gray-900 dark:text-white",children:[e.jsx(Y,{className:"h-5 w-5 mr-2"}),"Search Products"]})}),e.jsx(xe,{children:e.jsx("form",{onSubmit:_,className:"flex flex-col gap-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(b,{placeholder:"Rechercher par nom ou code...",value:F,onChange:a=>B(a.target.value)})}),e.jsx("div",{className:"flex-1",children:e.jsxs("select",{className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500",value:P,onChange:a=>l(a.target.value),children:[e.jsx("option",{value:"",children:"Toutes les catégories"}),s.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})}),e.jsx("div",{className:"flex-1",children:e.jsxs("select",{className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500",value:R,onChange:a=>T(a.target.value),children:[e.jsx("option",{value:"",children:"Tous les statuts"}),e.jsx("option",{value:"active",children:"Actif"}),e.jsx("option",{value:"inactive",children:"Inactif"})]})}),e.jsxs(v,{type:"submit",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Rechercher"]})]})})})]}),e.jsxs(de,{className:"bg-white dark:bg-gray-800",children:[e.jsx(oe,{children:e.jsxs(me,{className:"flex items-center text-gray-900 dark:text-white",children:[e.jsx(G,{className:"h-5 w-5 mr-2"}),"Products List (",i.length,")"]})}),e.jsx(xe,{children:i.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(G,{className:"h-12 w-12 mx-auto text-gray-400 dark:text-gray-500 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No products found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Get started by creating your first product."}),e.jsxs("button",{onClick:ee,className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-amber-500 text-white hover:bg-amber-600 dark:bg-amber-600 dark:text-white dark:hover:bg-amber-700 px-4 py-2 h-10 shadow-sm hover:shadow-md",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Ajouter un produit"]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Product"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Code"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Category"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Price"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Stock"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:i.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex-shrink-0 relative h-10 w-10 rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-700",children:[a.image_url&&e.jsx("img",{src:a.image_url,alt:a.name,className:"absolute inset-0 h-10 w-10 object-cover z-[1]",onError:j=>{j.target.onerror=null,j.target.style.display="none"}}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-0",children:e.jsx(G,{className:"h-6 w-6 text-gray-400 dark:text-gray-500"})})]}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:a.name}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.description?.substring(0,50),"..."]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:a.product_code}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:a.category?.name||"N/A"}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:[a.price_currency," ",a.price_amount?.toFixed(2)]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:[e.jsx("span",{className:"font-medium",children:a.current_stock}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[" / ",a.minimum_stock]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:we(a)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(v,{variant:"outline",size:"sm",onClick:()=>ve(a),title:"Voir le détail",children:e.jsx(Ve,{className:"h-4 w-4"})}),o&&e.jsx(v,{variant:"outline",size:"sm",onClick:()=>re(a),title:"Historique des mouvements",className:"text-amber-600 hover:text-amber-700 hover:border-amber-300",children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx(v,{variant:"outline",size:"sm",onClick:()=>se(a),title:"Modifier",children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsx(v,{variant:"destructive",size:"sm",onClick:()=>Ne(a),children:e.jsx(Qe,{className:"h-4 w-4"})})]})})]},a.id))})]})})})]})]})}),e.jsx(he,{show:O,onClose:()=>{z(!1),c(null)},maxWidth:"xl",children:u&&e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Détail du produit"}),e.jsx("button",{type:"button",onClick:()=>z(!1),className:"rounded-md text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(J,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex gap-6",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"relative h-32 w-32 rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-700",children:[u.image_url?e.jsx("img",{src:u.image_url,alt:u.name,className:"absolute inset-0 h-full w-full object-cover",onError:a=>{a.target.onerror=null,a.target.style.display="none"}}):null,e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(G,{className:"h-16 w-16 text-gray-400 dark:text-gray-500"})})]})}),e.jsxs("div",{className:"flex-1 space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Nom"}),e.jsx("p",{className:"text-gray-900 dark:text-white font-medium",children:u.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Code"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:u.product_code})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Catégorie"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:u.category?.name||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Prix"}),e.jsxs("p",{className:"text-gray-900 dark:text-white",children:[u.price_currency," ",u.price_amount?.toFixed(2),u.cost!=null&&e.jsxs("span",{className:"text-gray-500 dark:text-gray-400 ml-2",children:["(Revient: ",u.price_currency," ",u.cost?.toFixed(2),")"]})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Stock"}),e.jsxs("p",{className:"text-gray-900 dark:text-white",children:[u.current_stock??u.stock??0," / ",u.minimum_stock??0," min"]})]}),u.description&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Description"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:u.description})]}),e.jsx("div",{className:"pt-4",children:e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>{z(!1),se(u)},children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Modifier"]})})]})]})]})}),e.jsx(he,{show:S,onClose:()=>{E(!1),V(null),p(null)},maxWidth:"lg",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Importer des produits"}),e.jsx("button",{type:"button",onClick:()=>E(!1),className:"rounded-md text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(J,{className:"h-5 w-5"})})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:["Fichiers acceptés : .xlsx ou .csv. Colonnes obligatoires : ",e.jsx("strong",{children:"nom"}),", ",e.jsx("strong",{children:"code"}),", ",e.jsx("strong",{children:"categorie_id"})," (ou nom de catégorie), ",e.jsx("strong",{children:"prix"}),", ",e.jsx("strong",{children:"unite"}),"."]}),e.jsxs("form",{onSubmit:be,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Fichier"}),e.jsx("input",{type:"file",accept:".xlsx,.csv,.txt",onChange:a=>V(a.target.files?.[0]||null),className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 dark:file:bg-blue-900/20 dark:file:text-blue-400"})]}),t&&e.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"flex items-center text-green-600 dark:text-green-400",children:[e.jsx(Je,{className:"h-5 w-5 mr-1"}),t.success," importé(s)"]}),t.failed>0&&e.jsxs("span",{className:"flex items-center text-red-600 dark:text-red-400",children:[e.jsx($e,{className:"h-5 w-5 mr-1"}),t.failed," échoué(s)"]})]}),t.errors?.length>0&&e.jsx("div",{className:"mt-2 max-h-32 overflow-y-auto text-xs text-red-600 dark:text-red-400",children:t.errors.map((a,j)=>e.jsx("div",{children:a},j))})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(v,{type:"button",variant:"outline",onClick:()=>E(!1),children:"Fermer"}),e.jsx(v,{type:"submit",disabled:!D||W,children:W?"Import en cours...":"Importer"})]})]})]})}),e.jsx(Ze,{isOpen:U,onClose:()=>{y(!1),A(null)},product:N,categories:s}),o&&e.jsx(es,{isOpen:M,onClose:()=>{r(!1),w(null)},product:d})]})}export{Ns as default};
