import{u as Q,r as l,j as e,H as W,L as Y,a as c,n as d,c as Z}from"./app-DtqU_Gmt.js";import{A as ee,P as ae,m as se,l as te,B as C,f as S,p as re,M as ie,E as le,c as ne,C as _,q as ce,r as de}from"./AppLayout-C4K4I5xd.js";import{B as i}from"./Button-4k-pObky.js";import{I as xe}from"./Input-BpgKxISb.js";import{B as x}from"./badge-BBdevRdg.js";import{C as oe}from"./CustomerDrawer-CTKI03Aj.js";import{E as me}from"./ExportButtons-BX5RtZeP.js";import{U as E,b as ge,C as $}from"./x-Cw-ZD_Fb.js";import"./createLucideIcon-BH-qXF_i.js";import"./shield-x-Cz4kXV9c.js";import"./user-cog-BQwjoD4w.js";import"./Dropdown--z3bvfF1.js";import"./transition-DbHxI3Hw.js";import"./arrow-left-BGTcItEv.js";import"./loader-circle-DtoZnQ6b.js";import"./refresh-cw-CcjnuCLI.js";import"./FlashMessages-D-g4FpAa.js";import"./utils-CDN07tui.js";import"./Drawer-Dy6JDRVK.js";import"./Label-QVyen-Zj.js";import"./textarea-DdvYib4T.js";function Te({customers:s,filters:o={},routePrefix:t="pharmacy"}){const{auth:h,shop:B}=Q().props,F=B?.currency||"CDF",z=h?.permissions||[],n=a=>h?.user?.type==="ROOT"?!0:z.includes(a),y=n(`${t}.customer.create`),u=n(`${t}.customer.edit`),A=n(`${t}.customer.view`),j=n(`${t}.customer.activate`),v=n(`${t}.customer.deactivate`),[N,O]=l.useState(o.search||""),[f,T]=l.useState(o.status||""),[b,U]=l.useState(o.customer_type||""),[D,m]=l.useState(!1),[I,g]=l.useState(null),[R,k]=l.useState({}),w=()=>{c.get(route(`${t}.customers.index`),{search:N,status:f,customer_type:b},{preserveState:!0,preserveScroll:!0})},L=a=>{a.key==="Enter"&&w()},V=()=>{g(null),m(!0)},q=a=>{g(a),m(!0)},H=()=>{m(!1),g(null)},K=()=>{c.reload({only:["customers"]})},M=async a=>{const p=a.status==="inactive",J=p?"activate":"deactivate";if(p&&!j){d.error("Vous n'avez pas la permission d'activer ce client.");return}if(!p&&!v){d.error("Vous n'avez pas la permission de désactiver ce client.");return}k(r=>({...r,[a.id]:!0}));try{const r=await Z.post(route(`${t}.customers.${J}`,a.id));r.data.success?(d.success(r.data.message),c.reload({only:["customers"]})):d.error(r.data.message)}catch(r){d.error(r.response?.data?.message||"Une erreur est survenue")}finally{k(r=>({...r,[a.id]:!1}))}},P=a=>a==="active"?e.jsxs(x,{className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",children:[e.jsx($,{className:"h-3 w-3 mr-1"}),"Actif"]}):e.jsxs(x,{className:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",children:[e.jsx(_,{className:"h-3 w-3 mr-1"}),"Inactif"]}),G=a=>a==="company"?e.jsxs(x,{variant:"outline",className:"border-blue-500 text-blue-500",children:[e.jsx(C,{className:"h-3 w-3 mr-1"}),"Entreprise"]}):e.jsxs(x,{variant:"outline",className:"border-gray-500 text-gray-500",children:[e.jsx(S,{className:"h-3 w-3 mr-1"}),"Particulier"]}),X=a=>a==null?"-":new Intl.NumberFormat("fr-FR",{style:"currency",currency:F}).format(a);return e.jsxs(ee,{children:[e.jsx(W,{title:"Clients"}),e.jsxs("div",{className:"container mx-auto py-6 px-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(E,{className:"h-6 w-6"}),"Gestion des Clients"]}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:[s?.total||0," client(s) au total"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{pdfUrl:route(`${t}.exports.customers.pdf`),excelUrl:route(`${t}.exports.customers.excel`),disabled:!s?.data?.length}),y&&e.jsxs(i,{onClick:V,children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Nouveau client"]})]})]}),e.jsx("div",{className:"mb-6 bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(xe,{placeholder:"Rechercher un client...",value:N,onChange:a=>O(a.target.value),onKeyPress:L,className:"pl-10 bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100"})]}),e.jsxs("select",{value:f,onChange:a=>T(a.target.value),className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-3 py-2 text-sm text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:"",children:"Tous les statuts"}),e.jsx("option",{value:"active",children:"Actifs"}),e.jsx("option",{value:"inactive",children:"Inactifs"})]}),e.jsxs("select",{value:b,onChange:a=>U(a.target.value),className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-3 py-2 text-sm text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:"",children:"Tous les types"}),e.jsx("option",{value:"individual",children:"Particuliers"}),e.jsx("option",{value:"company",children:"Entreprises"})]}),e.jsxs(i,{onClick:w,variant:"secondary",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Filtrer"]})]})})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Client"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Contact"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Crédit"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Statut"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:s?.data?.length>0?s.data.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 dark:bg-primary/20 flex items-center justify-center",children:a.customer_type==="company"?e.jsx(C,{className:"h-5 w-5 text-primary"}):e.jsx(S,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:a.name}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.total_sales||0," vente(s)"]})]})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"space-y-1",children:[a.phone&&e.jsxs("p",{className:"text-sm flex items-center gap-1 text-gray-700 dark:text-gray-300",children:[e.jsx(re,{className:"h-3 w-3 text-gray-400 dark:text-gray-500"}),a.phone]}),a.email&&e.jsxs("p",{className:"text-sm flex items-center gap-1 text-gray-700 dark:text-gray-300",children:[e.jsx(ie,{className:"h-3 w-3 text-gray-400 dark:text-gray-500"}),a.email]}),!a.phone&&!a.email&&e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:"-"})]})}),e.jsx("td",{className:"px-4 py-4",children:G(a.customer_type)}),e.jsx("td",{className:"px-4 py-4",children:a.credit_limit?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ge,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:X(a.credit_limit)})]}):e.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:"-"})}),e.jsx("td",{className:"px-4 py-4",children:P(a.status)}),e.jsx("td",{className:"px-4 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[A&&e.jsx(i,{variant:"ghost",size:"sm",className:"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",asChild:!0,children:e.jsx(Y,{href:route(`${t}.customers.show`,a.id),children:e.jsx(le,{className:"h-4 w-4"})})}),u&&e.jsx(i,{variant:"ghost",size:"sm",className:"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",onClick:()=>q(a),children:e.jsx(ne,{className:"h-4 w-4"})}),(j||v)&&e.jsx(i,{variant:a.status==="active"?"destructive":"default",size:"sm",onClick:()=>M(a),disabled:R[a.id],children:a.status==="active"?e.jsx(_,{className:"h-4 w-4"}):e.jsx($,{className:"h-4 w-4"})})]})})]},a.id)):e.jsx("tr",{children:e.jsxs("td",{colSpan:6,className:"px-4 py-8 text-center",children:[e.jsx(E,{className:"h-12 w-12 mx-auto mb-4 text-gray-300 dark:text-gray-600"}),e.jsx("p",{className:"text-lg font-medium text-gray-600 dark:text-gray-300",children:"Aucun client trouvé"}),e.jsx("p",{className:"text-sm mt-1 text-gray-500 dark:text-gray-400",children:"Créez votre premier client pour commencer"})]})})})]})}),s?.last_page>1&&e.jsxs("div",{className:"px-4 py-3 border-t border-gray-200 dark:border-gray-700 flex items-center justify-between bg-gray-50 dark:bg-gray-700/30",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Page ",s.current_page," sur ",s.last_page]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>c.get(s.prev_page_url),disabled:!s.prev_page_url,className:"border-gray-300 dark:border-gray-600",children:e.jsx(ce,{className:"h-4 w-4"})}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>c.get(s.next_page_url),disabled:!s.next_page_url,className:"border-gray-300 dark:border-gray-600",children:e.jsx(de,{className:"h-4 w-4"})})]})]})]})]}),e.jsx(oe,{isOpen:D,onClose:H,customer:I,onSuccess:K,canCreate:y,canUpdate:u,routePrefix:t})]})}export{Te as default};
