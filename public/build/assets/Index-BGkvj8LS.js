import{b as de,r as d,j as e,H as le,L as O,c as I,z as F,a as q}from"./app-DtqU_Gmt.js";import{A as ie,b as Q,e as U,y as A,Z as M,l as ce,m as ne,P as G,Q as oe,_ as xe}from"./AppLayout-C4K4I5xd.js";import{C as i,a as c,b as n,c as o}from"./card-Daek165Z.js";import{B as l}from"./Button-4k-pObky.js";import{I as f}from"./Input-BpgKxISb.js";import{L as m}from"./Label-QVyen-Zj.js";import{B as W}from"./badge-BBdevRdg.js";import{M as me}from"./Modal-B7Ra3icU.js";import{E as he}from"./ExportButtons-BX5RtZeP.js";import"./createLucideIcon-BH-qXF_i.js";import"./shield-x-Cz4kXV9c.js";import"./x-Cw-ZD_Fb.js";import"./user-cog-BQwjoD4w.js";import"./Dropdown--z3bvfF1.js";import"./transition-DbHxI3Hw.js";import"./arrow-left-BGTcItEv.js";import"./loader-circle-DtoZnQ6b.js";import"./refresh-cw-CcjnuCLI.js";import"./FlashMessages-D-g4FpAa.js";import"./utils-CDN07tui.js";function Re({products:p,lowStock:b,expiringSoon:j,categories:X=[],filters:h={},pagination:a,routePrefix:x="pharmacy"}){const{data:r,setData:g,post:ge,processing:ue,errors:P}=de({product_id:"",type:"adjust",quantity:"",batch_number:"",expiry_date:"",supplier_id:"",purchase_order_id:""}),[K,v]=d.useState(!1),[k,w]=d.useState(null),[T,V]=d.useState(h.search||""),[z,Z]=d.useState(h.category_id||""),[L,J]=d.useState(h.stock_status||""),[R,Y]=d.useState(h.per_page||a?.per_page||15),[ee,_]=d.useState(!1),[E,S]=d.useState(null),[H,C]=d.useState([]),[u,$]=d.useState(!1),te=async()=>{if(k){$(!0);try{await I.post(route(`${x}.products.stock.update`,k.id),{type:r.type,quantity:r.quantity,batch_number:r.batch_number||null,expiry_date:r.expiry_date||null,supplier_id:r.supplier_id||null,purchase_order_id:r.purchase_order_id||null},{headers:{Accept:"application/json","Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}}),F.success("Stock mis à jour avec succès"),v(!1),w(null),g({product_id:"",type:"adjust",quantity:"",batch_number:"",expiry_date:"",supplier_id:"",purchase_order_id:""}),q.reload()}catch(t){let s="Échec de la mise à jour du stock";const y=t.response?.data;if(y){if(typeof y.message=="string")s=y.message;else if(y.errors&&typeof y.errors=="object"){const B=Object.values(y.errors).flat()[0];B&&(s=B)}}F.error(String(s))}finally{$(!1)}}},N=(t,s="adjust")=>{w(t),g({...r,product_id:t.id,type:s}),v(!0)},ae=t=>t.current_stock<=0?{status:"out",color:"destructive",label:"Rupture"}:t.current_stock<=t.minimum_stock?{status:"low",color:"warning",label:"Stock faible"}:{status:"good",color:"success",label:"OK"},re=t=>{t.preventDefault(),q.get(route(`${x}.stock.index`),{search:T||void 0,category_id:z||void 0,stock_status:L||void 0,per_page:R||void 0},{preserveState:!0,preserveScroll:!0})},D=t=>{q.get(route(`${x}.stock.index`),{search:h.search,category_id:h.category_id,stock_status:h.stock_status,per_page:a?.per_page,page:t},{preserveState:!0,preserveScroll:!0})},se=async t=>{try{const s=await I.get(route(`${x}.stock.movements`,t.id));C(s.data.movements||[]),S(t),_(!0)}catch{F.error("Impossible de charger l'historique")}};return e.jsxs(ie,{header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 dark:text-gray-100 leading-tight",children:"Gestion du Stock"}),children:[e.jsx(le,{title:"Gestion du Stock"}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs(i,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Total Produits"}),e.jsx(Q,{className:"h-4 w-4 text-blue-500"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a?.total??p.length}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"produits en stock"})]})]}),e.jsxs(i,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Stock Faible"}),e.jsx(U,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:b.length}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"produits à réapprovisionner"})]})]}),x==="pharmacy"&&e.jsxs(i,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Expirations Proches"}),e.jsx(A,{className:"h-4 w-4 text-red-500"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:j.length}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3",children:"lots expirent bientôt"}),e.jsxs(O,{href:route("pharmacy.expirations.index"),className:"flex items-center justify-center gap-2 w-full px-3 py-2 text-sm font-medium rounded-md bg-red-500 hover:bg-red-600 text-white transition-colors",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx("span",{children:"Voir tout"})]})]})]}),e.jsxs(i,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Actions rapides"}),e.jsx(M,{className:"h-4 w-4 text-purple-500"})]}),e.jsx(o,{children:e.jsxs(O,{href:route(`${x}.stock.movements.index`),className:"flex items-center justify-center gap-2 w-full px-3 py-2 text-sm font-medium rounded-md bg-purple-500 hover:bg-purple-600 text-white transition-colors",children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx("span",{children:"Historique mouvements"})]})})]})]}),e.jsxs(i,{className:"mb-6 bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(c,{className:"flex flex-row items-center justify-between",children:[e.jsxs(n,{className:"flex items-center text-gray-900 dark:text-white",children:[e.jsx(ce,{className:"h-5 w-5 mr-2 text-amber-500"}),"Filtres"]}),e.jsx(he,{pdfUrl:route(`${x}.exports.stock.pdf`),excelUrl:route(`${x}.exports.stock.excel`),disabled:!p.length})]}),e.jsx(o,{children:e.jsxs("form",{onSubmit:re,className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(m,{htmlFor:"search",className:"text-gray-700 dark:text-gray-300",children:"Recherche"}),e.jsx(f,{id:"search",placeholder:"Nom ou code produit",value:T,onChange:t=>V(t.target.value),className:"bg-white dark:bg-slate-800 border-gray-300 dark:border-slate-600 text-gray-900 dark:text-gray-100"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(m,{htmlFor:"category",className:"text-gray-700 dark:text-gray-300",children:"Catégorie"}),e.jsxs("select",{id:"category",value:z,onChange:t=>Z(t.target.value),className:"w-full h-10 rounded-md border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-gray-900 dark:text-gray-100 px-3 focus:outline-none focus:ring-2 focus:ring-amber-500",children:[e.jsx("option",{value:"",children:"Toutes"}),X.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(m,{htmlFor:"stock_status",className:"text-gray-700 dark:text-gray-300",children:"Statut stock"}),e.jsxs("select",{id:"stock_status",value:L,onChange:t=>J(t.target.value),className:"w-full h-10 rounded-md border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-gray-900 dark:text-gray-100 px-3 focus:outline-none focus:ring-2 focus:ring-amber-500",children:[e.jsx("option",{value:"",children:"Tous"}),e.jsx("option",{value:"low",children:"Stock faible"}),e.jsx("option",{value:"out",children:"Rupture"})]})]}),e.jsxs("div",{className:"w-full md:w-32",children:[e.jsx(m,{htmlFor:"per_page",className:"text-gray-700 dark:text-gray-300",children:"Par page"}),e.jsxs("select",{id:"per_page",value:R,onChange:t=>Y(t.target.value),className:"w-full h-10 rounded-md border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-gray-900 dark:text-gray-100 px-3 focus:outline-none focus:ring-2 focus:ring-amber-500",children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:15,children:"15"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(l,{type:"submit",className:"bg-amber-500 hover:bg-amber-600 text-white",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Filtrer"]})})]})})]}),b.length>0&&e.jsxs(i,{className:"mb-6 bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800",children:[e.jsx(c,{children:e.jsxs(n,{className:"flex items-center text-orange-800 dark:text-orange-300",children:[e.jsx(U,{className:"h-5 w-5 mr-2"}),"Alerte Stock Faible (",b.length," produits)"]})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-3",children:b.slice(0,5).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white dark:bg-slate-800 rounded-lg border border-orange-100 dark:border-orange-900",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Actuel: ",t.current_stock," | Minimum: ",t.minimum_stock]})]}),e.jsxs(l,{size:"sm",onClick:()=>N(t,"add"),className:"bg-orange-500 hover:bg-orange-600 text-white",children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),"Ajouter"]})]},t.id))})})]}),j.length>0&&e.jsxs(i,{className:"mb-6 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800",children:[e.jsx(c,{children:e.jsxs(n,{className:"flex items-center text-red-800 dark:text-red-300",children:[e.jsx(A,{className:"h-5 w-5 mr-2"}),"Expirations Proches (",j.length," lots)"]})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-3",children:j.slice(0,5).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white dark:bg-slate-800 rounded-lg border border-red-100 dark:border-red-900",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:t.product_name}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Lot: ",t.batch_number," | Expire: ",t.expiry_date]})]}),e.jsxs(W,{variant:"destructive",children:[t.days_until_expiry," jours"]})]},t.id))})})]}),K&&k&&e.jsxs(i,{className:"mb-6 bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsx(c,{children:e.jsxs(n,{className:"text-gray-900 dark:text-white",children:["Mettre à jour le stock de ",k.name]})}),e.jsx(o,{children:e.jsxs("form",{onSubmit:t=>t.preventDefault(),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"type",className:"text-gray-700 dark:text-gray-300",children:"Type d'opération"}),e.jsxs("select",{id:"type",value:r.type,onChange:t=>g("type",t.target.value),className:"w-full h-10 rounded-md border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-gray-900 dark:text-gray-100 px-3 focus:outline-none focus:ring-2 focus:ring-amber-500",children:[e.jsx("option",{value:"add",children:"Ajouter"}),e.jsx("option",{value:"remove",children:"Retirer"}),e.jsx("option",{value:"adjust",children:"Ajuster"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"quantity",className:"text-gray-700 dark:text-gray-300",children:"Quantité *"}),e.jsx(f,{id:"quantity",type:"number",value:r.quantity,onChange:t=>g("quantity",t.target.value),placeholder:"Entrez la quantité",className:"bg-white dark:bg-slate-800 border-gray-300 dark:border-slate-600 text-gray-900 dark:text-gray-100"}),P.quantity&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:P.quantity})]})]}),(r.type==="add"||r.type==="adjust")&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"batch_number",className:"text-gray-700 dark:text-gray-300",children:"Numéro de lot"}),e.jsx(f,{id:"batch_number",value:r.batch_number,onChange:t=>g("batch_number",t.target.value),placeholder:"LOT-001",className:"bg-white dark:bg-slate-800 border-gray-300 dark:border-slate-600 text-gray-900 dark:text-gray-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"expiry_date",className:"text-gray-700 dark:text-gray-300",children:"Date d'expiration"}),e.jsx(f,{id:"expiry_date",type:"date",value:r.expiry_date,onChange:t=>g("expiry_date",t.target.value),className:"bg-white dark:bg-slate-800 border-gray-300 dark:border-slate-600 text-gray-900 dark:text-gray-100"})]})]})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>{v(!1),w(null)},disabled:u,className:"border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-200",children:"Annuler"}),e.jsx(l,{type:"button",disabled:u,onClick:te,className:"bg-amber-500 hover:bg-amber-600 text-white",children:u?"Mise à jour...":"Mettre à jour"})]})]})})]}),e.jsxs(i,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsx(c,{children:e.jsxs(n,{className:"flex items-center text-gray-900 dark:text-white",children:[e.jsx(Q,{className:"h-5 w-5 mr-2 text-blue-500"}),"Produits (",a?.total??p.length,")"]})}),e.jsx(o,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-slate-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-slate-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Produit"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Stock actuel"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Statut"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-slate-900 divide-y divide-gray-200 dark:divide-slate-700",children:p.map(t=>{const s=ae(t);return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-slate-800",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.name}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.product_code})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm text-gray-900 dark:text-white",children:[e.jsx("span",{className:"font-medium",children:t.current_stock}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[" / ",t.minimum_stock]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(W,{variant:s.color,children:s.label})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>N(t,"add"),disabled:u,className:"border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-slate-700",title:"Ajouter",children:e.jsx(G,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>N(t,"remove"),disabled:u,className:"border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-slate-700",title:"Retirer",children:e.jsx(oe,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>N(t,"adjust"),disabled:u,className:"border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-slate-700",title:"Ajuster",children:e.jsx(xe,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>se(t),className:"border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-slate-700",title:"Historique",children:e.jsx(M,{className:"h-4 w-4"})})]})})]},t.id)})})]})})})]}),a&&a.last_page>1&&e.jsxs("div",{className:"mt-4 flex items-center justify-between text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{children:["Affichage de ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:a.from})," à"," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:a.to})," sur"," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:a.total})," produit(s)"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(l,{variant:"outline",size:"sm",disabled:a.current_page<=1,onClick:()=>D(a.current_page-1),className:"border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-200",children:"Précédent"}),e.jsx(l,{variant:"outline",size:"sm",disabled:a.current_page>=a.last_page,onClick:()=>D(a.current_page+1),className:"border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-200",children:"Suivant"})]})]})]})}),E&&e.jsx(me,{show:ee,onClose:()=>{_(!1),S(null),C([])},maxWidth:"xl",children:e.jsxs("div",{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Historique des mouvements – ",E.name]}),e.jsx("button",{type:"button",onClick:()=>{_(!1),S(null),C([])},className:"rounded-md text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 text-2xl",children:"×"})]}),H.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Aucun mouvement enregistré."}):e.jsx("div",{className:"overflow-x-auto max-h-80",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-slate-700 text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-slate-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-4 py-2 text-right font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Quantité"}),e.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Référence"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-slate-900 divide-y divide-gray-200 dark:divide-slate-700",children:H.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-gray-700 dark:text-gray-300",children:t.created_at}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-gray-700 dark:text-gray-300",children:t.type}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-right text-gray-700 dark:text-gray-300",children:t.quantity}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-gray-700 dark:text-gray-300",children:t.reference||"—"})]},t.id))})]})})]})})]})}export{Re as default};
