import{u as J,r as i,j as e,H as Q,L as W,a as c,n,c as Y}from"./app-3PKVeuQh.js";import{A as Z,P as ee,h as ae,F as re,B as w,f as C,i as te,M as se,E as ie,c as le,C as S,j as ce,k as ne}from"./AppLayout-DSrKCpOy.js";import{B as s}from"./Button-RC9FN5z3.js";import{I as de}from"./Input-5gvkn2nv.js";import{B as d}from"./badge-Ca6uIRAr.js";import{C as xe}from"./CustomerDrawer-vLgi7Yh-.js";import{E as oe}from"./ExportButtons-Bm2TEI_V.js";import{U as _,b as me,C as P}from"./x-YL0zAneP.js";import"./createLucideIcon-CyiEew_u.js";import"./shield-x-gOy17OJ-.js";import"./user-cog-nVqfHm0b.js";import"./Dropdown-B_QkibTR.js";import"./transition-CufTvwOt.js";import"./arrow-left-CvJq81LS.js";import"./loader-circle-D2tkCN5O.js";import"./refresh-cw-L3GUbwVE.js";import"./FlashMessages-bPB7K-Ql.js";import"./Drawer-DXvnJU94.js";import"./Label-DCTvEg5s.js";import"./textarea-g7yOinAB.js";function Ae({customers:r,filters:x={}}){const{auth:p,shop:E}=J().props,B=E?.currency||"USD",F=p?.permissions||[],l=a=>p?.user?.type==="ROOT"?!0:F.includes(a),h=l("pharmacy.customer.create"),y=l("pharmacy.customer.edit"),z=l("pharmacy.customer.view"),u=l("pharmacy.customer.activate"),j=l("pharmacy.customer.deactivate"),[f,A]=i.useState(x.search||""),[v,U]=i.useState(x.status||""),[N,O]=i.useState(x.customer_type||""),[T,o]=i.useState(!1),[D,m]=i.useState(null),[I,b]=i.useState({}),k=()=>{c.get(route("pharmacy.customers.index"),{search:f,status:v,customer_type:N},{preserveState:!0,preserveScroll:!0})},R=a=>{a.key==="Enter"&&k()},L=()=>{m(null),o(!0)},V=a=>{m(a),o(!0)},H=()=>{o(!1),m(null)},K=()=>{c.reload({only:["customers"]})},M=async a=>{const g=a.status==="inactive",$=g?"activate":"deactivate";if(g&&!u){n.error("Vous n'avez pas la permission d'activer ce client.");return}if(!g&&!j){n.error("Vous n'avez pas la permission de désactiver ce client.");return}b(t=>({...t,[a.id]:!0}));try{const t=await Y.post(route(`pharmacy.customers.${$}`,a.id));t.data.success?(n.success(t.data.message),c.reload({only:["customers"]})):n.error(t.data.message)}catch(t){n.error(t.response?.data?.message||"Une erreur est survenue")}finally{b(t=>({...t,[a.id]:!1}))}},q=a=>a==="active"?e.jsxs(d,{className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",children:[e.jsx(P,{className:"h-3 w-3 mr-1"}),"Actif"]}):e.jsxs(d,{className:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",children:[e.jsx(S,{className:"h-3 w-3 mr-1"}),"Inactif"]}),G=a=>a==="company"?e.jsxs(d,{variant:"outline",className:"border-blue-500 text-blue-500",children:[e.jsx(w,{className:"h-3 w-3 mr-1"}),"Entreprise"]}):e.jsxs(d,{variant:"outline",className:"border-gray-500 text-gray-500",children:[e.jsx(C,{className:"h-3 w-3 mr-1"}),"Particulier"]}),X=a=>a==null?"-":new Intl.NumberFormat("fr-FR",{style:"currency",currency:B}).format(a);return e.jsxs(Z,{children:[e.jsx(Q,{title:"Clients"}),e.jsxs("div",{className:"container mx-auto py-6 px-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(_,{className:"h-6 w-6"}),"Gestion des Clients"]}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:[r?.total||0," client(s) au total"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{pdfUrl:route("pharmacy.exports.customers.pdf"),excelUrl:route("pharmacy.exports.customers.excel"),disabled:!r?.data?.length}),h&&e.jsxs(s,{onClick:L,children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Nouveau client"]})]})]}),e.jsx("div",{className:"mb-6 bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(de,{placeholder:"Rechercher un client...",value:f,onChange:a=>A(a.target.value),onKeyPress:R,className:"pl-10 bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100"})]}),e.jsxs("select",{value:v,onChange:a=>U(a.target.value),className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-3 py-2 text-sm text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:"",children:"Tous les statuts"}),e.jsx("option",{value:"active",children:"Actifs"}),e.jsx("option",{value:"inactive",children:"Inactifs"})]}),e.jsxs("select",{value:N,onChange:a=>O(a.target.value),className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-3 py-2 text-sm text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:"",children:"Tous les types"}),e.jsx("option",{value:"individual",children:"Particuliers"}),e.jsx("option",{value:"company",children:"Entreprises"})]}),e.jsxs(s,{onClick:k,variant:"secondary",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Filtrer"]})]})})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Client"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Contact"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Crédit"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Statut"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:r?.data?.length>0?r.data.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 dark:bg-primary/20 flex items-center justify-center",children:a.customer_type==="company"?e.jsx(w,{className:"h-5 w-5 text-primary"}):e.jsx(C,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:a.name}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.total_sales||0," vente(s)"]})]})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"space-y-1",children:[a.phone&&e.jsxs("p",{className:"text-sm flex items-center gap-1 text-gray-700 dark:text-gray-300",children:[e.jsx(te,{className:"h-3 w-3 text-gray-400 dark:text-gray-500"}),a.phone]}),a.email&&e.jsxs("p",{className:"text-sm flex items-center gap-1 text-gray-700 dark:text-gray-300",children:[e.jsx(se,{className:"h-3 w-3 text-gray-400 dark:text-gray-500"}),a.email]}),!a.phone&&!a.email&&e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:"-"})]})}),e.jsx("td",{className:"px-4 py-4",children:G(a.customer_type)}),e.jsx("td",{className:"px-4 py-4",children:a.credit_limit?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(me,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:X(a.credit_limit)})]}):e.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:"-"})}),e.jsx("td",{className:"px-4 py-4",children:q(a.status)}),e.jsx("td",{className:"px-4 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[z&&e.jsx(s,{variant:"ghost",size:"sm",className:"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",asChild:!0,children:e.jsx(W,{href:route("pharmacy.customers.show",a.id),children:e.jsx(ie,{className:"h-4 w-4"})})}),y&&e.jsx(s,{variant:"ghost",size:"sm",className:"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",onClick:()=>V(a),children:e.jsx(le,{className:"h-4 w-4"})}),(u||j)&&e.jsx(s,{variant:a.status==="active"?"destructive":"default",size:"sm",onClick:()=>M(a),disabled:I[a.id],children:a.status==="active"?e.jsx(S,{className:"h-4 w-4"}):e.jsx(P,{className:"h-4 w-4"})})]})})]},a.id)):e.jsx("tr",{children:e.jsxs("td",{colSpan:6,className:"px-4 py-8 text-center",children:[e.jsx(_,{className:"h-12 w-12 mx-auto mb-4 text-gray-300 dark:text-gray-600"}),e.jsx("p",{className:"text-lg font-medium text-gray-600 dark:text-gray-300",children:"Aucun client trouvé"}),e.jsx("p",{className:"text-sm mt-1 text-gray-500 dark:text-gray-400",children:"Créez votre premier client pour commencer"})]})})})]})}),r?.last_page>1&&e.jsxs("div",{className:"px-4 py-3 border-t border-gray-200 dark:border-gray-700 flex items-center justify-between bg-gray-50 dark:bg-gray-700/30",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Page ",r.current_page," sur ",r.last_page]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(s,{variant:"outline",size:"sm",onClick:()=>c.get(r.prev_page_url),disabled:!r.prev_page_url,className:"border-gray-300 dark:border-gray-600",children:e.jsx(ce,{className:"h-4 w-4"})}),e.jsx(s,{variant:"outline",size:"sm",onClick:()=>c.get(r.next_page_url),disabled:!r.next_page_url,className:"border-gray-300 dark:border-gray-600",children:e.jsx(ne,{className:"h-4 w-4"})})]})]})]})]}),e.jsx(xe,{isOpen:T,onClose:H,customer:D,onSuccess:K,canCreate:h,canUpdate:y})]})}export{Ae as default};
