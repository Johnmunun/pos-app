import{r,j as e,H as $,L as H,c as C,z as o,a as S}from"./app-BGTsh8B3.js";import{A as M,v as F,P as z,L as W,w as G}from"./AppLayout-B9W2Qjn-.js";import{B as t}from"./Button-Cm51LcKk.js";import{I as c}from"./Input-LVtkliO7.js";import{B as A}from"./badge-vyxm7s9H.js";import{A as J}from"./arrow-left-BMPE_XAu.js";import"./createLucideIcon-B4miffV9.js";import"./shield-x-DRqpxde8.js";import"./x-Bqi0sytM.js";import"./user-cog-CgPvrrVM.js";import"./Dropdown-DbeWMHj2.js";import"./transition-JR3jNvu7.js";import"./loader-circle-CIdMfzjo.js";import"./refresh-cw-CA0aJ90x.js";import"./FlashMessages-o0prhkl9.js";function w({open:p,onClose:n,title:f,children:i}){return p?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:n,children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto",onClick:j=>j.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-slate-700 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:f}),e.jsx("button",{type:"button",onClick:n,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200",children:"×"})]}),e.jsx("div",{className:"p-4",children:i})]})}):null}function ne({cashRegisters:p=[],routePrefix:n="pharmacy"}){const[f,i]=r.useState(!1),[j,h]=r.useState(!1),[E,g]=r.useState(!1),[d,m]=r.useState(null),[y,v]=r.useState(null),[l,u]=r.useState({name:"",code:"",description:"",initial_balance:"0"}),[_,O]=r.useState({opening_balance:"0"}),[b,N]=r.useState({closing_balance:"",notes:""}),[k,x]=r.useState(!1),L=async s=>{s.preventDefault(),x(!0);try{await C.post(route(`${n}.cash-registers.store`),{name:l.name,code:l.code,description:l.description||null,initial_balance:l.initial_balance||0}),o.success("Caisse créée"),i(!1),u({name:"",code:"",description:"",initial_balance:"0"}),S.reload({only:["cashRegisters"]})}catch(a){o.error(a.response?.data?.message||"Erreur")}finally{x(!1)}},R=s=>{m(s),O({opening_balance:s.initial_balance?.toString()??"0"}),h(!0)},q=async s=>{if(s.preventDefault(),!!d){x(!0);try{await C.post(route(`${n}.cash-registers.open`,d.id),{opening_balance:parseFloat(_.opening_balance)||0}),o.success("Session ouverte"),h(!1),m(null),S.reload({only:["cashRegisters"]})}catch(a){o.error(a.response?.data?.message||"Erreur")}finally{x(!1)}}},B=s=>{const a=s.open_session;a&&(m(s),v(a),N({closing_balance:"",notes:""}),g(!0))},D=async s=>{if(s.preventDefault(),!y)return;const a=parseFloat(b.closing_balance);if(isNaN(a)||a<0){o.error("Saisissez un solde de fermeture valide.");return}x(!0);try{await C.post(route(`${n}.cash-registers.sessions.close`,y.id),{closing_balance:a,notes:b.notes||null}),o.success("Session fermée"),g(!1),m(null),v(null),S.reload({only:["cashRegisters"]})}catch(I){o.error(I.response?.data?.message||"Erreur")}finally{x(!1)}};return e.jsxs(M,{children:[e.jsx($,{title:"Caisses"}),e.jsxs("div",{className:"container mx-auto py-6 px-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(H,{href:route(`${n}.sales.index`),className:"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:e.jsx(J,{className:"h-5 w-5"})}),e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2 text-gray-900 dark:text-gray-100",children:[e.jsx(F,{className:"h-6 w-6"}),"Caisses"]})]}),e.jsxs(t,{onClick:()=>i(!0),className:"inline-flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),"Nouvelle caisse"]})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Ouvrez une session pour enregistrer les ventes sur une caisse. Fermez la session en fin de poste avec le solde réel."}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:p.map(s=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-gray-200 dark:border-slate-700 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:s.code})]}),s.open_session?e.jsx(A,{className:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",children:"Ouverte"}):e.jsx(A,{variant:"secondary",children:"Fermée"})]}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3 line-clamp-2",children:s.description}),s.open_session?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:["Ouverte le ",s.open_session.opened_at," · Solde d'ouverture: ",Number(s.open_session.opening_balance).toLocaleString()]}),e.jsxs(t,{variant:"outline",size:"sm",className:"w-full border-amber-500 text-amber-600 hover:bg-amber-50 dark:hover:bg-amber-900/20",onClick:()=>B(s),children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Fermer la session"]})]}):e.jsxs(t,{size:"sm",className:"w-full bg-green-600 hover:bg-green-700",onClick:()=>R(s),children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Ouvrir une session"]})]},s.id))}),p.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx(F,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Aucune caisse. Créez une caisse pour gérer les sessions."}),e.jsxs(t,{className:"mt-4",onClick:()=>i(!0),children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Nouvelle caisse"]})]})]}),e.jsx(w,{open:f,onClose:()=>i(!1),title:"Nouvelle caisse",children:e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Nom"}),e.jsx(c,{value:l.name,onChange:s=>u(a=>({...a,name:s.target.value})),placeholder:"Ex: Caisse 1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Code"}),e.jsx(c,{value:l.code,onChange:s=>u(a=>({...a,code:s.target.value})),placeholder:"Ex: CAISSE-01",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description (optionnel)"}),e.jsx(c,{value:l.description,onChange:s=>u(a=>({...a,description:s.target.value})),placeholder:"Optionnel"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Fonds de caisse initial (optionnel)"}),e.jsx(c,{type:"number",step:"0.01",min:"0",value:l.initial_balance,onChange:s=>u(a=>({...a,initial_balance:s.target.value}))})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(t,{type:"button",variant:"outline",onClick:()=>i(!1),className:"flex-1",children:"Annuler"}),e.jsx(t,{type:"submit",disabled:k,className:"flex-1",children:"Créer"})]})]})}),e.jsx(w,{open:j,onClose:()=>{h(!1),m(null)},title:"Ouvrir une session",children:d&&e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Caisse: ",e.jsx("strong",{children:d.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Solde d'ouverture"}),e.jsx(c,{type:"number",step:"0.01",min:"0",value:_.opening_balance,onChange:s=>O(a=>({...a,opening_balance:s.target.value}))})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(t,{type:"button",variant:"outline",onClick:()=>h(!1),className:"flex-1",children:"Annuler"}),e.jsx(t,{type:"submit",disabled:k,className:"flex-1",children:"Ouvrir"})]})]})}),e.jsx(w,{open:E,onClose:()=>{g(!1),m(null),v(null)},title:"Fermer la session",children:d&&y&&e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Caisse: ",e.jsx("strong",{children:d.name}),". Saisissez le solde réel en caisse."]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Solde de fermeture (réel) *"}),e.jsx(c,{type:"number",step:"0.01",min:"0",value:b.closing_balance,onChange:s=>N(a=>({...a,closing_balance:s.target.value})),placeholder:"0.00",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Notes (optionnel)"}),e.jsx(c,{value:b.notes,onChange:s=>N(a=>({...a,notes:s.target.value})),placeholder:"Ex: Écart expliqué..."})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(t,{type:"button",variant:"outline",onClick:()=>g(!1),className:"flex-1",children:"Annuler"}),e.jsx(t,{type:"submit",disabled:k,className:"flex-1",children:"Fermer la session"})]})]})})]})}export{ne as default};
