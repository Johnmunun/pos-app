import{r as l,u as I,j as e,a as u,n as o,c as h}from"./app-3PKVeuQh.js";import{A as ee,L as te,C as re}from"./AppLayout-DSrKCpOy.js";import{F as ae}from"./FlashMessages-bPB7K-Ql.js";import{R as se}from"./refresh-cw-L3GUbwVE.js";import{U as le,S as de,a as O,T as ne,C as P}from"./user-cog-nVqfHm0b.js";import{C as ie}from"./loader-circle-D2tkCN5O.js";import{C as oe}from"./x-YL0zAneP.js";import"./createLucideIcon-CyiEew_u.js";import"./shield-x-gOy17OJ-.js";import"./Dropdown-B_QkibTR.js";import"./transition-CufTvwOt.js";import"./arrow-left-CvJq81LS.js";function we({users:i,roles:z}){const[ce,xe]=l.useState(null),[s,d]=l.useState({}),[y,A]=l.useState(null),[f,R]=l.useState(null),[k,$]=l.useState(null),[j,E]=l.useState(null),[v,N]=l.useState(""),[T,w]=l.useState(""),[m,C]=l.useState(""),[p,S]=l.useState(""),[M,c]=l.useState(""),{auth:L}=I().props,x=L?.permissions??[],g=L?.user?.type==="ROOT";g||x.includes("admin.users.update");const B=g||x.includes("users.assign_role"),D=g||x.includes("users.reset_password"),F=g||x.includes("users.delete"),U=g||x.includes("users.impersonate"),V=g||x.includes("users.block"),q=g||x.includes("users.activate"),G=t=>{const a={active:{bg:"bg-emerald-100",text:"text-emerald-800",label:"Actif",icon:oe},pending:{bg:"bg-amber-100",text:"text-amber-800",label:"En attente",icon:ie},blocked:{bg:"bg-red-100",text:"text-red-800",label:"Bloqué",icon:re},suspended:{bg:"bg-orange-100",text:"text-orange-800",label:"Suspendu",icon:P}},r=a[t]||a.pending,n=r.icon;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium ${r.bg} ${r.text}`,children:[e.jsx(n,{className:"h-3 w-3"}),r.label]})},H=t=>{switch(t){case"ROOT":return"bg-purple-100 text-purple-800";case"TENANT_ADMIN":return"bg-amber-100 text-amber-800";case"MERCHANT":return"bg-blue-100 text-blue-800";case"SELLER":return"bg-cyan-100 text-cyan-800";case"STAFF":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},X=t=>({ROOT:"Administrateur",TENANT_ADMIN:"Admin Tenant",MERCHANT:"Commerçant",SELLER:"Vendeur",STAFF:"Personnel"})[t]||t,J=async t=>{if(!v){o.error("Veuillez sélectionner un rôle");return}d({...s,[`role-${t}`]:!0});try{const a=await h.post(route("admin.users.assign-role",t),{role_id:v,tenant_id:null});o.success(a.data?.message||"Rôle assigné avec succès. L'utilisateur devra se reconnecter pour voir les nouvelles permissions.",{duration:5e3}),u.reload(),A(null),N("")}catch(a){o.error(a.response?.data?.error||a.response?.data?.message||"Erreur lors de l'assignation du rôle")}finally{d({...s,[`role-${t}`]:!1})}},K=async t=>{if(!T){alert("Veuillez sélectionner un statut");return}d({...s,[`status-${t}`]:!0});try{await h.post(route("admin.users.update-status",t),{status:T}),u.reload(),R(null),w("")}catch(a){alert(a.response?.data?.error||"Erreur lors de la mise à jour du statut")}finally{d({...s,[`status-${t}`]:!1})}},Q=async t=>{if(!m||!p){c("Veuillez remplir tous les champs");return}if(m.length<8){c("Le mot de passe doit contenir au moins 8 caractères");return}if(m!==p){c("Les mots de passe ne correspondent pas");return}d({...s,[`password-${t}`]:!0}),c("");try{await h.post(route("admin.users.reset-password",t),{password:m,password_confirmation:p}),alert("Mot de passe réinitialisé avec succès"),u.reload(),$(null),C(""),S("")}catch(a){c(a.response?.data?.error||"Erreur lors de la réinitialisation")}finally{d({...s,[`password-${t}`]:!1})}},W=async t=>{if(confirm("Êtes-vous sûr de vouloir supprimer cet utilisateur ? Cette action est irréversible.")){d({...s,[`delete-${t}`]:!0});try{await h.delete(route("admin.users.delete",t)),u.reload(),E(null)}catch(a){alert(a.response?.data?.error||"Erreur lors de la suppression")}finally{d({...s,[`delete-${t}`]:!1})}}},Y=async t=>{const a=i.find(n=>n.id===t),r=a?`${a.first_name} ${a.last_name}`:"cet utilisateur";o.custom(n=>e.jsx("div",{className:`${n.visible?"animate-enter":"animate-leave"} max-w-md w-full bg-white dark:bg-gray-800 shadow-lg rounded-lg pointer-events-auto flex ring-1 ring-black ring-opacity-5`,children:e.jsxs("div",{className:"flex-1 w-0 p-4",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(O,{className:"h-6 w-6 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Confirmation d'impersonation"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:["Vous allez vous connecter comme ",r,". Continuer ?"]})]})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{onClick:()=>{o.dismiss(n.id),d({...s,[`impersonate-${t}`]:!0}),h.post(route("admin.users.impersonate",t)).then(()=>{o.success("Impersonation démarrée avec succès"),u.visit(route("dashboard"))}).catch(_=>{o.error(_.response?.data?.error||_.response?.data?.message||"Erreur lors de l'impersonation"),d({...s,[`impersonate-${t}`]:!1})})},className:"flex-1 bg-amber-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-amber-700 transition",children:"Continuer"}),e.jsx("button",{onClick:()=>o.dismiss(n.id),className:"flex-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-md text-sm font-medium hover:bg-gray-200 dark:hover:bg-gray-600 transition",children:"Annuler"})]})]})}),{duration:1/0})},Z=i.reduce((t,a)=>{const r=a.tenant?.name||"(Aucun tenant)";return t[r]||(t[r]=[]),t[r].push(a),t},{}),b={total:i.length,active:i.filter(t=>t.status==="active").length,pending:i.filter(t=>t.status==="pending").length,blocked:i.filter(t=>t.status==="blocked").length,suspended:i.filter(t=>t.status==="suspended").length};return e.jsx(ee,{children:e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Gestion des Utilisateurs"}),e.jsx("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:"Gérez tous les utilisateurs de la plateforme"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx("a",{href:route("admin.tenants.select.view"),className:"inline-flex items-center px-4 py-2 rounded-lg text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition",children:"← Retour"})})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Total"}),e.jsx("div",{className:"mt-2 text-3xl font-bold text-gray-900 dark:text-white",children:b.total})]}),e.jsxs("div",{className:"bg-emerald-50 dark:bg-emerald-900/20 rounded-lg p-6 border border-emerald-200 dark:border-emerald-800",children:[e.jsx("div",{className:"text-sm font-medium text-emerald-700 dark:text-emerald-400",children:"Actifs"}),e.jsx("div",{className:"mt-2 text-3xl font-bold text-emerald-900 dark:text-emerald-300",children:b.active})]}),e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-6 border border-amber-200 dark:border-amber-800",children:[e.jsx("div",{className:"text-sm font-medium text-amber-700 dark:text-amber-400",children:"En attente"}),e.jsx("div",{className:"mt-2 text-3xl font-bold text-amber-900 dark:text-amber-300",children:b.pending})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-6 border border-red-200 dark:border-red-800",children:[e.jsx("div",{className:"text-sm font-medium text-red-700 dark:text-red-400",children:"Bloqués"}),e.jsx("div",{className:"mt-2 text-3xl font-bold text-red-900 dark:text-red-300",children:b.blocked})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-6 border border-orange-200 dark:border-orange-800",children:[e.jsx("div",{className:"text-sm font-medium text-orange-700 dark:text-orange-400",children:"Suspendus"}),e.jsx("div",{className:"mt-2 text-3xl font-bold text-orange-900 dark:text-orange-300",children:b.suspended})]})]}),Object.entries(Z).map(([t,a])=>e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[t,e.jsxs("span",{className:"ml-2 text-sm font-normal text-gray-500 dark:text-gray-400",children:["(",a.length,")"]})]}),e.jsxs("button",{onClick:()=>u.reload({only:["users","roles"]}),className:"inline-flex items-center gap-2 px-3 py-1.5 text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-md transition",title:"Actualiser la liste",children:[e.jsx(se,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Actualiser"})]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider",children:"Nom"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider",children:"Rôle"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider",children:"Statut"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider",children:"Inscrit"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:a.map(r=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-900/50 transition",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[r.first_name," ",r.last_name]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:r.email})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.roles&&r.roles.length>0?e.jsx("div",{className:"flex flex-wrap gap-1",children:r.roles.map(n=>e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",children:n.name},n.id))}):e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${H(r.type)}`,children:X(r.type)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:G(r.status||"pending")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-400",children:new Date(r.created_at).toLocaleDateString("fr-FR")}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[r.type!=="ROOT"&&e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[B&&e.jsx("button",{onClick:()=>{A(r.id),N("")},className:"p-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition",title:"Assigner un rôle",children:e.jsx(le,{className:"h-4 w-4"})}),(q||V)&&e.jsx("button",{onClick:()=>{R(r.id),w(r.status||"pending")},className:"p-2 text-amber-600 dark:text-amber-400 hover:bg-amber-50 dark:hover:bg-amber-900/20 rounded-lg transition",title:"Modifier le statut",children:e.jsx(de,{className:"h-4 w-4"})}),D&&e.jsx("button",{onClick:()=>{$(r.id),C(""),S(""),c("")},className:"p-2 text-purple-600 dark:text-purple-400 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded-lg transition",title:"Réinitialiser le mot de passe",children:e.jsx(te,{className:"h-4 w-4"})}),U&&e.jsx("button",{onClick:()=>Y(r.id),disabled:s[`impersonate-${r.id}`],className:"p-2 text-green-600 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/20 rounded-lg transition disabled:opacity-50",title:"Se connecter comme cet utilisateur",children:e.jsx(O,{className:"h-4 w-4"})}),F&&e.jsx("button",{onClick:()=>E(r.id),className:"p-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",title:"Supprimer",children:e.jsx(ne,{className:"h-4 w-4"})})]}),r.type==="ROOT"&&e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 italic",children:"Administrateur"})]})]},r.id))})]})})})]},t)),i.length===0&&e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 px-6 py-12 text-center",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Aucun utilisateur trouvé"})})]}),y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4",children:"Assigner un rôle"}),e.jsxs("select",{value:v,onChange:t=>N(t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"",children:"Sélectionner un rôle"}),z?.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{A(null),N("")},className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:"Annuler"}),e.jsx("button",{onClick:()=>J(y),disabled:s[`role-${y}`]||!v,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition",children:s[`role-${y}`]?"En cours...":"Assigner"})]})]})}),f&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4",children:"Modifier le statut"}),e.jsxs("select",{value:T,onChange:t=>w(t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"pending",children:"En attente"}),e.jsx("option",{value:"active",children:"Actif"}),e.jsx("option",{value:"blocked",children:"Bloqué"}),e.jsx("option",{value:"suspended",children:"Suspendu"})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{R(null),w("")},className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:"Annuler"}),e.jsx("button",{onClick:()=>K(f),disabled:s[`status-${f}`],className:"flex-1 px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 disabled:opacity-50 transition",children:s[`status-${f}`]?"En cours...":"Mettre à jour"})]})]})}),k&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4",children:"Réinitialiser le mot de passe"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Nouveau mot de passe"}),e.jsx("input",{type:"password",value:m,onChange:t=>C(t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"Minimum 8 caractères"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Confirmer le mot de passe"}),e.jsx("input",{type:"password",value:p,onChange:t=>S(t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),M&&e.jsx("div",{className:"text-sm text-red-600 dark:text-red-400",children:M})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{$(null),C(""),S(""),c("")},className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:"Annuler"}),e.jsx("button",{onClick:()=>Q(k),disabled:s[`password-${k}`]||!m||!p,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 transition",children:s[`password-${k}`]?"En cours...":"Réinitialiser"})]})]})}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(P,{className:"h-6 w-6 text-red-600 dark:text-red-400"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Supprimer l'utilisateur"})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Êtes-vous sûr de vouloir supprimer cet utilisateur ? Cette action est irréversible."}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>E(null),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:"Annuler"}),e.jsx("button",{onClick:()=>W(j),disabled:s[`delete-${j}`],className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 transition",children:s[`delete-${j}`]?"Suppression...":"Supprimer"})]})]})}),e.jsx(ae,{})]})})}export{we as default};
