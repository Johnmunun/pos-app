import{u as ne,b as Ae,r as o,j as e,c as F,n as x,H as ze,a as ee}from"./app-B8F_Smya.js";import{b as W,I as _e,ad as Me,a8 as Ce,ae as Ue,T as Le,D as xe,J as Oe,a as Ve,t as $e,a7 as Ge,m as ie,F as Be,x as He,f as We,_ as Je,p as Qe,q as Xe,k as Ye,j as Ze,A as Ke,P as ue,E as es,$ as he,c as pe,af as ss,C as ts,s as ge,v as fe,e as as}from"./AppLayout-Cyrikcek.js";import{C as ye,a as je,b as be,c as ve}from"./card-DwWU2KFG.js";import{B as f}from"./Button-BSACjJaD.js";import{I as v}from"./Input-DyZz_-qK.js";import{B as V}from"./badge-CezgjasG.js";import{M as ae}from"./Modal-DDeTHNuf.js";import{D as rs}from"./Drawer-Ch-0G5k5.js";import{L as h}from"./Label-Dhk_jhe5.js";import{T as is}from"./textarea-BXphG8CV.js";import{o as ns}from"./syncService-BGKuX8VT.js";import{X as Q,C as ls}from"./x-Ce9nIuKt.js";import{L as se}from"./loader-circle-5vrT9r4x.js";import{R as Ne}from"./refresh-cw-BeeT9s1l.js";import{C as cs,T as ds}from"./user-cog-Cgo5DVwg.js";import"./createLucideIcon-NKf32Z79.js";import"./shield-x-CXAQmM6w.js";import"./Dropdown-CXpnj_1U.js";import"./transition-L_iZ831R.js";import"./arrow-left-uFeYT1yE.js";import"./FlashMessages-CHIUDfR7.js";const os="pos-saas-images-v1",we=50*1024*1024;class ms{constructor(){this.cache=null,this.initPromise=null}async init(){return this.initPromise?this.initPromise:"caches"in window?(this.initPromise=caches.open(os).then(i=>(this.cache=i,i)),this.initPromise):Promise.resolve(null)}async isCached(i){if(this.cache||await this.init(),!this.cache)return!1;try{return!!await this.cache.match(i)}catch(s){return console.warn("Error checking image cache:",s),!1}}async getImage(i){if(this.cache||await this.init(),!this.cache)return i;try{const s=await this.cache.match(i);if(s)return URL.createObjectURL(await s.blob());if(navigator.onLine){const p=await fetch(i);if(p.ok){const y=p.headers.get("content-length");if(y&&parseInt(y)>we)return i;const _=p.clone();return await this.cache.put(i,_),URL.createObjectURL(await p.blob())}}return i}catch(s){return console.warn("Error fetching image:",s),i}}async cacheImage(i){if(this.cache||await this.init(),!this.cache||!navigator.onLine)return!1;try{if(await this.isCached(i))return!0;const s=await fetch(i);if(s.ok){const p=s.headers.get("content-length");return p&&parseInt(p)>we?!1:(await this.cache.put(i,s.clone()),!0)}}catch(s){console.warn("Error caching image:",s)}return!1}async removeImage(i){if(this.cache||await this.init(),!this.cache)return!1;try{return await this.cache.delete(i)}catch(s){return console.warn("Error removing image from cache:",s),!1}}async cleanCache(){if(this.cache||await this.init(),!!this.cache)try{const i=await this.cache.keys();if(i.length>100){const s=i.slice(0,i.length-100);await Promise.all(s.map(p=>this.cache.delete(p)))}}catch(i){console.warn("Error cleaning cache:",i)}}async getCacheSize(){if(this.cache||await this.init(),!this.cache)return 0;try{const i=await this.cache.keys();let s=0;for(const p of i){const y=await this.cache.match(p);if(y){const _=await y.blob();s+=_.size}}return s}catch(i){return console.warn("Error calculating cache size:",i),0}}}const ke=new ms;function xs({isOpen:E,onClose:i,product:s=null,categories:p=[]}){const y=!!s,{shop:_}=ne().props,$=_?.currency||"CDF",{data:n,setData:m,post:G,put:q,processing:S,errors:l,reset:D}=Ae({name:s?.name||"",product_code:s?.product_code||"",description:s?.description||"",category_id:s?.category_id||"",price:s?.price_amount||"",currency:s?.price_currency||$,cost:s?.cost||"",minimum_stock:s?.minimum_stock||"",unit:s?.unit||"",medicine_type:s?.medicine_type||"",dosage:s?.dosage||"",prescription_required:s?.prescription_required||!1,manufacturer:s?.manufacturer||"",wholesale_price:s?.wholesale_price_amount??"",wholesale_min_quantity:s?.wholesale_min_quantity??"",supplier_id:s?.supplier_id||"",image:null,image_url:s?.image_url||"",remove_image:!1,type_unite:s?.type_unite||"UNITE",quantite_par_unite:s?.quantite_par_unite??1,est_divisible:s?.est_divisible!==!1}),[I,R]=o.useState(!!s?.medicine_type),[w,k]=o.useState(s?.image_url||null),[T,B]=o.useState(!1),[A,J]=o.useState([]),[c,u]=o.useState(!1);o.useEffect(()=>{E&&(async()=>{u(!0);try{const j=await F.get(route("pharmacy.suppliers.active"));j.data.success&&J(j.data.suppliers||[])}catch(j){console.error("Error loading suppliers:",j)}finally{u(!1)}})()},[E]),o.useEffect(()=>{s?(m({name:s.name||"",product_code:s.product_code||"",description:s.description||"",category_id:s.category_id||"",price:s.price_amount||"",currency:s.price_currency||$,cost:s.cost||"",minimum_stock:s.minimum_stock||"",unit:s.unit||"",medicine_type:s.medicine_type||"",dosage:s.dosage||"",prescription_required:s.prescription_required||!1,manufacturer:s.manufacturer||"",wholesale_price:s.wholesale_price_amount??"",wholesale_min_quantity:s.wholesale_min_quantity??"",supplier_id:s.supplier_id||"",image:null,image_url:s.image_url||"",remove_image:!1,type_unite:s.type_unite||"UNITE",quantite_par_unite:s.quantite_par_unite??1,est_divisible:s.est_divisible!==!1}),R(!!s.medicine_type),s.image_url?ke.getImage(s.image_url).then(a=>{k(a)}).catch(()=>{k(s.image_url)}):k(null)):(D(),R(!1),k(null))},[s]);const z=a=>{const j=a.target.files[0];if(j){const t=["image/jpeg","image/jpg","image/png","image/webp"];if(j.size>2097152){x.error("L'image ne doit pas dépasser 2 Mo");return}if(!t.includes(j.type)){x.error("Format d'image non supporté. Utilisez JPG, PNG ou WebP");return}m("image",j),m("remove_image",!1);const d=new FileReader;d.onloadend=()=>{k(d.result)},d.readAsDataURL(j)}},M=()=>{m("image",null),m("image_url",""),m("remove_image",!0),k(null)},U=async()=>{if(!n.name){x.error("Veuillez d'abord saisir le nom du produit.");return}if(!navigator.onLine){x.error("La génération automatique du code nécessite une connexion internet.");return}try{B(!0);const a=await F.get(route("pharmacy.products.generate-code"),{params:{name:n.name}});a.data?.code?(m("product_code",a.data.code),x.success("Code produit généré automatiquement.")):x.error("Impossible de générer un code produit. Réessayez.")}catch(a){console.error(a),x.error(a.response?.data?.message||"Erreur lors de la génération du code produit.")}finally{B(!1)}},H=async a=>{a.preventDefault();const j=navigator.onLine,C={name:n.name,product_code:n.product_code,description:n.description,category_id:n.category_id,price:n.price,currency:n.currency,cost:n.cost,minimum_stock:n.minimum_stock,unit:n.unit,medicine_type:n.medicine_type,dosage:n.dosage,prescription_required:n.prescription_required,manufacturer:n.manufacturer,wholesale_price:n.wholesale_price||null,wholesale_min_quantity:n.wholesale_min_quantity||null,supplier_id:n.supplier_id,type_unite:n.type_unite||"UNITE",quantite_par_unite:n.quantite_par_unite??1,est_divisible:n.est_divisible};if(j){const t=new FormData;Object.keys(C).forEach(d=>{const b=C[d];b!=null&&(typeof b=="boolean"?t.append(d,b?"1":"0"):t.append(d,b))}),n.image&&t.append("image",n.image),n.remove_image&&t.append("remove_image","1");try{y?(t.append("_method","PUT"),await F.post(route("pharmacy.products.update",s.id),t,{headers:{"Content-Type":"multipart/form-data"}}),x.success("Produit mis à jour avec succès")):(await F.post(route("pharmacy.products.store"),t,{headers:{"Content-Type":"multipart/form-data"}}),x.success("Produit créé avec succès")),n.image&&w&&await ke.cacheImage(w),i(),D(),k(null),window.location.reload()}catch(d){x.error(d.response?.data?.message||"Erreur lors de l'enregistrement"),console.error(d)}}else try{const t=y?s.id:null,d=await ns.savePendingProduct({...C,id:t},n.image);x.success("Produit enregistré localement. Synchronisation automatique à la reconnexion.",{icon:e.jsx(Ge,{className:"h-5 w-5"}),duration:5e3}),i(),D(),k(null),window.location.reload()}catch(t){x.error("Erreur lors de l'enregistrement local"),console.error(t)}},L=()=>{D(),i()};return e.jsx(rs,{isOpen:E,onClose:L,title:y?"Modifier le produit":"Nouveau produit",size:"xl",children:e.jsxs("form",{onSubmit:H,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(W,{className:"h-5 w-5 mr-2"}),"Informations de base"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"name",children:"Nom du produit *"}),e.jsx(v,{id:"name",value:n.name,onChange:a=>m("name",a.target.value),placeholder:"Nom du produit",className:"w-full"}),l.name&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"product_code",children:"Code produit *"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(_e,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400 dark:text-gray-500"}),e.jsx(v,{id:"product_code",value:n.product_code,onChange:a=>m("product_code",a.target.value),placeholder:"PROD-001",className:"pl-10 w-full"})]}),e.jsxs(f,{type:"button",variant:"outline",size:"sm",onClick:U,disabled:T,className:"whitespace-nowrap",children:[e.jsx(Me,{className:"h-4 w-4 mr-1"}),T?"Génération...":"Auto"]})]}),l.product_code&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.product_code})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"description",children:"Description"}),e.jsx(is,{id:"description",value:n.description,onChange:a=>m("description",a.target.value),placeholder:"Description du produit...",rows:3,className:"w-full"}),l.description&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.description})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"image",children:"Image du produit"}),e.jsxs("div",{className:"space-y-3",children:[w&&e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:w,alt:"Preview",className:"h-32 w-32 object-cover rounded-lg border-2 border-gray-300 dark:border-gray-600"}),e.jsx("button",{type:"button",onClick:M,className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors","aria-label":"Supprimer l'image",children:e.jsx(Q,{className:"h-4 w-4"})})]}),!w&&e.jsxs("label",{htmlFor:"image",className:"flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 dark:border-gray-600 border-dashed rounded-lg cursor-pointer bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx(Ce,{className:"w-8 h-8 mb-2 text-gray-400 dark:text-gray-500"}),e.jsxs("p",{className:"mb-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-semibold",children:"Cliquez pour uploader"})," ou glissez-déposez"]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"JPG, PNG ou WebP (MAX. 2 Mo)"})]}),e.jsx("input",{id:"image",type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",className:"hidden",onChange:z})]}),w&&e.jsxs("label",{htmlFor:"image",className:"inline-flex items-center justify-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 cursor-pointer transition-colors",children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Remplacer l'image",e.jsx("input",{id:"image",type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",className:"hidden",onChange:z})]})]}),l.image&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.image})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"category_id",children:"Catégorie *"}),e.jsxs("div",{className:"relative",children:[e.jsx(Le,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400 dark:text-gray-500"}),e.jsxs("select",{id:"category_id",value:n.category_id,onChange:a=>m("category_id",a.target.value),className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white pl-10 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Sélectionner une catégorie"}),p.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),l.category_id&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.category_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"unit",children:"Unité *"}),e.jsx(v,{id:"unit",value:n.unit,onChange:a=>m("unit",a.target.value),placeholder:"ex: bouteille, boîte, comprimé",className:"w-full"}),l.unit&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.unit})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"type_unite",children:"Type d'unité *"}),e.jsxs("select",{id:"type_unite",value:n.type_unite,onChange:a=>m("type_unite",a.target.value),className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[e.jsx("option",{value:"PLAQUETTE",children:"Plaquette"}),e.jsx("option",{value:"BOITE",children:"Boîte"}),e.jsx("option",{value:"FLACON",children:"Flacon"}),e.jsx("option",{value:"TUBE",children:"Tube"}),e.jsx("option",{value:"SACHET",children:"Sachet"}),e.jsx("option",{value:"UNITE",children:"Unité"})]}),l.type_unite&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.type_unite})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"quantite_par_unite",children:"Quantité par unité *"}),e.jsx(v,{id:"quantite_par_unite",type:"number",min:1,value:n.quantite_par_unite,onChange:a=>m("quantite_par_unite",parseInt(a.target.value,10)||1),placeholder:"ex: 10",className:"w-full"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"ex: 10 comprimés par plaquette"}),l.quantite_par_unite&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.quantite_par_unite})]}),e.jsxs("div",{className:"space-y-2 flex flex-col justify-end",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"est_divisible",checked:n.est_divisible,onChange:a=>m("est_divisible",a.target.checked),className:"rounded border-gray-300 dark:border-gray-600"}),e.jsx(h,{htmlFor:"est_divisible",className:"cursor-pointer",children:"Vente en fraction autorisée"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Désactiver pour boîte/flacon (qté entière uniquement)"}),l.est_divisible&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.est_divisible})]})]})]}),e.jsxs("div",{className:"space-y-4 border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(xe,{className:"h-5 w-5 mr-2"}),"Informations de prix"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"price",children:"Prix de vente *"}),e.jsx(v,{id:"price",type:"number",step:"0.01",value:n.price,onChange:a=>m("price",a.target.value),placeholder:"0.00",className:"w-full"}),l.price&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.price})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"cost",children:"Prix de revient"}),e.jsx(v,{id:"cost",type:"number",step:"0.01",value:n.cost,onChange:a=>m("cost",a.target.value),placeholder:"0.00",className:"w-full"}),l.cost&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.cost})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"currency",children:"Devise *"}),e.jsx("select",{id:"currency",value:n.currency,onChange:a=>m("currency",a.target.value),className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:_?.currencies&&_.currencies.length>0?_.currencies.map(a=>e.jsxs("option",{value:a.code,children:[a.code," - ",a.name]},a.code)):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"CDF",children:"CDF - Franc Congolais"}),e.jsx("option",{value:"USD",children:"USD - Dollar US"}),e.jsx("option",{value:"EUR",children:"EUR - Euro"})]})}),l.currency&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.currency})]})]})]}),e.jsxs("div",{className:"space-y-4 border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(xe,{className:"h-5 w-5 mr-2"}),"Vente en gros"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"wholesale_price",children:"Prix gros (optionnel)"}),e.jsx(v,{id:"wholesale_price",type:"number",min:"0",step:"0.01",value:n.wholesale_price,onChange:a=>m("wholesale_price",a.target.value),placeholder:"Prix unitaire en gros",className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"wholesale_min_quantity",children:"Qté min. pour prix gros"}),e.jsx(v,{id:"wholesale_min_quantity",type:"number",min:"0",value:n.wholesale_min_quantity,onChange:a=>m("wholesale_min_quantity",a.target.value),placeholder:"Ex: 10",className:"w-full"})]})]})]}),e.jsxs("div",{className:"space-y-4 border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(Oe,{className:"h-5 w-5 mr-2"}),"Paramètres de stock"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"minimum_stock",children:"Stock minimum *"}),e.jsx(v,{id:"minimum_stock",type:"number",value:n.minimum_stock,onChange:a=>m("minimum_stock",a.target.value),placeholder:"10",className:"w-full"}),l.minimum_stock&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.minimum_stock})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"manufacturer",children:"Fabricant"}),e.jsx(v,{id:"manufacturer",value:n.manufacturer,onChange:a=>m("manufacturer",a.target.value),placeholder:"Nom du fabricant",className:"w-full"}),l.manufacturer&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.manufacturer})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"supplier_id",children:"Fournisseur"}),e.jsxs("select",{id:"supplier_id",value:n.supplier_id,onChange:a=>m("supplier_id",a.target.value),disabled:c,className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:c?"Chargement...":"Sélectionner un fournisseur"}),A.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),l.supplier_id&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.supplier_id})]})]}),e.jsxs("div",{className:"space-y-4 border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(Ve,{className:"h-5 w-5 mr-2"}),"Informations médicament"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:I,onChange:a=>R(a.target.checked),className:"rounded border-gray-300 dark:border-gray-600 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600 dark:text-gray-400",children:"C'est un médicament"})]})]}),I&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"medicine_type",children:"Type de médicament"}),e.jsxs("select",{id:"medicine_type",value:n.medicine_type,onChange:a=>m("medicine_type",a.target.value),className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Sélectionner un type"}),e.jsx("option",{value:"MEDICINE",children:"Médicament"}),e.jsx("option",{value:"PARAPHARMACY",children:"Parapharmacie"}),e.jsx("option",{value:"DEVICE",children:"Dispositif médical"}),e.jsx("option",{value:"VACCINE",children:"Vaccin"}),e.jsx("option",{value:"NUTRITION",children:"Nutrition"})]}),l.medicine_type&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.medicine_type})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"dosage",children:"Dosage"}),e.jsx(v,{id:"dosage",value:n.dosage,onChange:a=>m("dosage",a.target.value),placeholder:"ex: 500mg, 10ml",className:"w-full"}),l.dosage&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.dosage})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"prescription_required",checked:n.prescription_required,onChange:a=>m("prescription_required",a.target.checked),className:"rounded border-gray-300 dark:border-gray-600 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"}),e.jsx(h,{htmlFor:"prescription_required",className:"ml-2",children:"Prescription requise"})]}),l.prescription_required&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l.prescription_required})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-3 sm:gap-4 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("button",{type:"button",onClick:L,disabled:S,className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 px-4 py-2 h-10 w-full sm:w-auto",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Annuler"]}),e.jsxs("button",{type:"submit",disabled:S,className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-amber-500 text-white hover:bg-amber-600 dark:bg-amber-600 dark:text-white dark:hover:bg-amber-700 px-4 py-2 h-10 shadow-sm hover:shadow-md w-full sm:w-auto",children:[e.jsx($e,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:S?y?"Mise à jour...":"Création...":y?"Enregistrer":"Créer"}),e.jsx("span",{className:"sm:hidden",children:S?"...":y?"Enregistrer":"Créer"})]})]})]})})}const re=20;function us({isOpen:E,onClose:i,product:s=null,initialFilters:p={}}){const{auth:y,shop:_}=ne().props,$=y?.permissions||[];_?.currency;const n=t=>y?.user?.type==="ROOT"?!0:$.includes(t),m=n("stock.movement.view"),G=n("stock.movement.print"),[q,S]=o.useState(!1),[l,D]=o.useState([]),[I,R]=o.useState({total_movements:0,total_in:0,total_out:0,total_adjustment:0}),[w,k]=o.useState(1),[T,B]=o.useState(!1),[A,J]=o.useState(null),[c,u]=o.useState({product_id:s?.id||p.product_id||"",product_name:s?.name||p.product_name||"",product_code:p.product_code||"",type:p.type||"",from:p.from||"",to:p.to||""}),z=o.useCallback(async()=>{if(!m){x.error("Vous n'avez pas la permission de voir les mouvements");return}S(!0);try{const t=new URLSearchParams;c.product_id&&t.append("product_id",c.product_id),c.product_name&&t.append("product_name",c.product_name),c.product_code&&t.append("product_code",c.product_code),c.type&&t.append("type",c.type),c.from&&t.append("from",c.from),c.to&&t.append("to",c.to);const d=`${route("pharmacy.api.product-movements.index")}?${t.toString()}`,b=await F.get(d);D(b.data.movements||[]),R(b.data.stats||{}),k(1)}catch(t){console.error("Error loading movements:",t),x.error("Erreur lors du chargement des mouvements")}finally{S(!1)}},[c,m]);o.useEffect(()=>{E&&m&&z()},[E,m]),o.useEffect(()=>{s&&u(t=>({...t,product_id:s.id,product_name:s.name}))},[s]);const M=Math.ceil(l.length/re),U=l.slice((w-1)*re,w*re),H=async()=>{if(!G){x.error("Vous n'avez pas la permission d'imprimer");return}B(!0);try{const t=new URLSearchParams;c.product_id&&t.append("product_id",c.product_id),c.product_name&&t.append("product_name",c.product_name),c.product_code&&t.append("product_code",c.product_code),c.type&&t.append("type",c.type),c.from&&t.append("from",c.from),c.to&&t.append("to",c.to);const d=`${route("pharmacy.api.product-movements.pdf.global")}?${t.toString()}`,b=await F.get(d,{responseType:"blob"}),P=window.URL.createObjectURL(new Blob([b.data])),O=document.createElement("a");O.href=P,O.setAttribute("download",`mouvements_stock_${new Date().toISOString().slice(0,10)}.pdf`),document.body.appendChild(O),O.click(),O.remove(),window.URL.revokeObjectURL(P),x.success("Export PDF généré avec succès")}catch(t){console.error("Error exporting:",t),x.error("Erreur lors de l'export PDF")}finally{B(!1)}},L=async t=>{if(!G){x.error("Vous n'avez pas la permission d'imprimer");return}J(t);try{const d=await F.get(route("pharmacy.api.product-movements.pdf.single",{id:t}),{responseType:"blob"}),b=window.URL.createObjectURL(new Blob([d.data])),P=document.createElement("a");P.href=b,P.setAttribute("download",`mouvement_${t.slice(0,8)}.pdf`),document.body.appendChild(P),P.click(),P.remove(),window.URL.revokeObjectURL(b),x.success("Fiche de mouvement générée")}catch(d){console.error("Error exporting single:",d),x.error("Erreur lors de l'export")}finally{J(null)}},a=()=>{u({product_id:s?.id||"",product_name:s?.name||"",product_code:"",type:"",from:"",to:""})},j=t=>{switch(t){case"IN":return e.jsxs(V,{className:"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300",children:[e.jsx(Ze,{className:"h-3 w-3 mr-1"}),"Entrée"]});case"OUT":return e.jsxs(V,{className:"bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300",children:[e.jsx(Ye,{className:"h-3 w-3 mr-1"}),"Sortie"]});case"ADJUSTMENT":return e.jsxs(V,{className:"bg-orange-100 text-orange-800 dark:bg-orange-900/50 dark:text-orange-300",children:[e.jsx(cs,{className:"h-3 w-3 mr-1"}),"Ajustement"]});case"RETURN":return e.jsxs(V,{className:"bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300",children:[e.jsx(Ne,{className:"h-3 w-3 mr-1"}),"Retour"]});default:return e.jsx(V,{children:t})}},C=(t,d)=>{switch(t){case"IN":case"RETURN":return e.jsxs("span",{className:"text-green-600 dark:text-green-400 font-semibold",children:["+",d]});case"OUT":return e.jsxs("span",{className:"text-red-600 dark:text-red-400 font-semibold",children:["-",d]});default:return e.jsx("span",{className:"text-orange-600 dark:text-orange-400 font-semibold",children:d})}};return E?e.jsxs("div",{className:"fixed inset-0 z-50 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 transition-opacity",onClick:i}),e.jsxs("div",{className:"absolute inset-4 md:inset-8 lg:inset-12 bg-white dark:bg-slate-900 rounded-xl shadow-2xl flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center",children:e.jsx(W,{className:"h-5 w-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Historique des Mouvements"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:s?`Produit: ${s.name}`:"Tous les produits"})]})]}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-gray-200 dark:hover:bg-slate-700 rounded-lg transition-colors",children:e.jsx(Q,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})})]}),e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-slate-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Total mouvements"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:I.total_movements})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400",children:"Entrées"}),e.jsxs("p",{className:"text-xl font-bold text-green-700 dark:text-green-300",children:["+",I.total_in]})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:"Sorties"}),e.jsxs("p",{className:"text-xl font-bold text-red-700 dark:text-red-300",children:["-",I.total_out]})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-orange-600 dark:text-orange-400",children:"Ajustements"}),e.jsx("p",{className:"text-xl font-bold text-orange-700 dark:text-orange-300",children:I.total_adjustment})]})]})}),e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800/50",children:e.jsxs("div",{className:"flex flex-wrap items-end gap-4",children:[!s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1 min-w-[180px]",children:[e.jsx(h,{className:"text-xs mb-1 block",children:"Nom produit"}),e.jsx(v,{type:"text",placeholder:"Rechercher...",value:c.product_name,onChange:t=>u(d=>({...d,product_name:t.target.value})),className:"h-9"})]}),e.jsxs("div",{className:"w-[140px]",children:[e.jsx(h,{className:"text-xs mb-1 block",children:"Code produit"}),e.jsx(v,{type:"text",placeholder:"Code...",value:c.product_code,onChange:t=>u(d=>({...d,product_code:t.target.value})),className:"h-9"})]})]}),e.jsxs("div",{className:"w-[130px]",children:[e.jsx(h,{className:"text-xs mb-1 block",children:"Type"}),e.jsxs("select",{value:c.type,onChange:t=>u(d=>({...d,type:t.target.value})),className:"w-full h-9 rounded-md border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-gray-900 dark:text-white text-sm px-2",children:[e.jsx("option",{value:"",children:"Tous"}),e.jsx("option",{value:"IN",children:"Entrée"}),e.jsx("option",{value:"OUT",children:"Sortie"}),e.jsx("option",{value:"ADJUSTMENT",children:"Ajustement"})]})]}),e.jsxs("div",{className:"w-[140px]",children:[e.jsx(h,{className:"text-xs mb-1 block",children:"Date début"}),e.jsx(v,{type:"date",value:c.from,onChange:t=>u(d=>({...d,from:t.target.value})),className:"h-9"})]}),e.jsxs("div",{className:"w-[140px]",children:[e.jsx(h,{className:"text-xs mb-1 block",children:"Date fin"}),e.jsx(v,{type:"date",value:c.to,onChange:t=>u(d=>({...d,to:t.target.value})),className:"h-9"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{onClick:z,disabled:q,size:"sm",className:"h-9",children:[q?e.jsx(se,{className:"h-4 w-4 animate-spin"}):e.jsx(ie,{className:"h-4 w-4"}),e.jsx("span",{className:"ml-1",children:"Filtrer"})]}),e.jsx(f,{onClick:a,variant:"outline",size:"sm",className:"h-9",children:e.jsx(Ne,{className:"h-4 w-4"})})]}),G&&e.jsxs(f,{onClick:H,disabled:T||l.length===0,variant:"outline",size:"sm",className:"h-9 ml-auto",children:[T?e.jsx(se,{className:"h-4 w-4 animate-spin"}):e.jsx(Be,{className:"h-4 w-4"}),e.jsx("span",{className:"ml-1",children:"Export PDF"})]})]})}),e.jsx("div",{className:"flex-1 overflow-auto",children:q?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(se,{className:"h-8 w-8 animate-spin text-amber-500"})}):l.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500 dark:text-gray-400",children:[e.jsx(W,{className:"h-16 w-16 mb-4 opacity-30"}),e.jsx("p",{className:"text-lg font-medium",children:"Aucun mouvement trouvé"}),e.jsx("p",{className:"text-sm",children:"Modifiez vos filtres pour voir les résultats"})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-slate-800 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Date"}),!s&&e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Produit"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Référence"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Quantité"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Utilisateur"}),G&&e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-slate-700",children:U.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(He,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:t.created_at_formatted})]})}),!s&&e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.product_name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.product_code})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:t.reference||"—"})]})}),e.jsx("td",{className:"px-4 py-3 text-center",children:j(t.type)}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("span",{className:"text-lg",children:C(t.type,t.quantity)})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:t.created_by_name})]})}),G&&e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>L(t.id),disabled:A===t.id,title:"Imprimer fiche",children:A===t.id?e.jsx(se,{className:"h-4 w-4 animate-spin"}):e.jsx(Je,{className:"h-4 w-4"})})})]},t.id))})]})}),M>1&&e.jsxs("div",{className:"px-6 py-3 border-t border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800 flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Page ",w," sur ",M," (",l.length," mouvements)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{variant:"outline",size:"sm",onClick:()=>k(t=>Math.max(1,t-1)),disabled:w===1,children:e.jsx(Qe,{className:"h-4 w-4"})}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>k(t=>Math.min(M,t+1)),disabled:w===M,children:e.jsx(Xe,{className:"h-4 w-4"})})]})]})]})]}):null}function Rs({auth:E,products:i,categories:s,filters:p,canImport:y=!1}){const{auth:_,depots:$=[],currentDepot:n}=ne().props??{},m=_?.permissions||[],q=(r=>_?.user?.type==="ROOT"?!0:m.includes(r))("stock.movement.view"),[S,l]=o.useState(p?.search||""),[D,I]=o.useState(p?.category_id||""),[R,w]=o.useState(p?.status||""),[k,T]=o.useState(!1),[B,A]=o.useState(null),[J,c]=o.useState(!1),[u,z]=o.useState(null),[M,U]=o.useState(!1),[H,L]=o.useState(null),[a,j]=o.useState(!1),[C,t]=o.useState(null),[d,b]=o.useState(!1),[P,O]=o.useState(null),[Se,X]=o.useState(!1),[Y,te]=o.useState(null),[Z,K]=o.useState(""),[le,ce]=o.useState(!1),Pe=r=>{r.preventDefault(),ee.get(route("pharmacy.products"),{search:S,category_id:D,status:R||void 0})},Ee=()=>{U(!0),L(null),t(null)},De=async r=>{if(r.preventDefault(),!H){x.error("Veuillez sélectionner un fichier.");return}j(!0),t(null);try{const g=new FormData;g.append("file",H);const N=await F.post(route("pharmacy.products.import"),g,{headers:{"Content-Type":"multipart/form-data"}});t(N.data),N.data.success>0&&(x.success(`${N.data.success} produit(s) importé(s) avec succès.`),ee.reload()),N.data.failed>0&&N.data.errors?.length&&x.error(`${N.data.failed} ligne(s) en erreur.`)}catch(g){const N=g.response?.data?.message||"Erreur lors de l'import.";x.error(N),t({success:0,failed:0,total:0,errors:[N]})}finally{j(!1)}},de=()=>{A(null),T(!0)},oe=r=>{A(r),T(!0)},Ie=r=>{z(r),c(!0)},me=(r=null)=>{O(r),b(!0)},Te=r=>{te(r),K(""),X(!0)},Fe=async r=>{if(r.preventDefault(),!Y||!Z){x.error("Veuillez sélectionner un dépôt cible.");return}ce(!0);try{const g=await F.post(route("pharmacy.products.duplicate-to-depot",Y.id),{target_depot_id:Z});g.data?.success&&g.data?.product_id&&(x.success(g.data.message||"Produit dupliqué avec succès."),X(!1),te(null),K(""),ee.visit(route("pharmacy.products.edit",g.data.product_id)))}catch(g){const N=g.response?.data?.message||"Erreur lors de la duplication.";x.error(N)}finally{ce(!1)}},qe=r=>{x.custom(g=>e.jsx("div",{className:`${g.visible?"animate-enter":"animate-leave"} max-w-md w-full bg-white dark:bg-gray-800 shadow-lg rounded-lg pointer-events-auto flex ring-1 ring-black ring-opacity-5`,children:e.jsxs("div",{className:"flex-1 w-0 p-4",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(as,{className:"h-6 w-6 text-red-600 dark:text-red-400"})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Confirmer la suppression"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:['Êtes-vous sûr de vouloir supprimer "',r.name,'" ? Cette action est irréversible.']})]})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{onClick:()=>{x.dismiss(g.id),ee.delete(route("pharmacy.products.destroy",r.id),{preserveScroll:!0,onSuccess:()=>{x.success("Produit supprimé avec succès")},onError:N=>{x.error(N.message||"Erreur lors de la suppression du produit")}})},className:"flex-1 bg-red-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-red-700 transition",children:"Supprimer"}),e.jsx("button",{onClick:()=>x.dismiss(g.id),className:"flex-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-md text-sm font-medium hover:bg-gray-200 dark:hover:bg-gray-600 transition",children:"Annuler"})]})]})}),{duration:1/0})},Re=r=>{const g=r.current_stock??r.stock??0,N=r.minimum_stock??0;return g<=0?e.jsx(V,{variant:"destructive",children:"Out of Stock"}):g<=N?e.jsx(V,{variant:"warning",children:"Low Stock"}):e.jsx(V,{variant:"success",children:"In Stock"})};return e.jsxs(Ke,{header:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"font-semibold text-xl text-gray-800 dark:text-white leading-tight",children:"Gestion des Produits"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"hidden sm:flex items-center gap-2",children:[e.jsxs("a",{href:i.length?route("pharmacy.products.export.pdf"):"#",target:"_blank",rel:"noreferrer","aria-disabled":i.length===0,className:`inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 px-3 h-10 shadow-sm hover:shadow-md ${i.length===0?"opacity-50 cursor-not-allowed pointer-events-none bg-rose-400 text-white/80":"bg-rose-500 text-white hover:bg-rose-600 dark:bg-rose-600 dark:hover:bg-rose-700"}`,children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Exporter PDF"]}),e.jsxs("a",{href:i.length?route("pharmacy.products.export.excel"):"#","aria-disabled":i.length===0,className:`inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 px-3 h-10 shadow-sm hover:shadow-md ${i.length===0?"opacity-50 cursor-not-allowed pointer-events-none bg-emerald-400 text-white/80":"bg-emerald-500 text-white hover:bg-emerald-600 dark:bg-emerald-600 dark:hover:bg-emerald-700"}`,children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Exporter Excel"]})]}),e.jsxs("div",{className:"flex sm:hidden items-center gap-2",children:[e.jsxs("a",{href:i.length?route("pharmacy.products.export.pdf"):"#",target:"_blank",rel:"noreferrer","aria-disabled":i.length===0,className:`inline-flex items-center justify-center rounded-md text-xs font-medium px-2 h-8 shadow-sm ${i.length===0?"opacity-50 cursor-not-allowed pointer-events-none bg-rose-400 text-white/80":"bg-rose-500 text-white hover:bg-rose-600"}`,children:[e.jsx(ge,{className:"h-3 w-3 mr-1"}),"PDF"]}),e.jsxs("a",{href:i.length?route("pharmacy.products.export.excel"):"#","aria-disabled":i.length===0,className:`inline-flex items-center justify-center rounded-md text-xs font-medium px-2 h-8 shadow-sm ${i.length===0?"opacity-50 cursor-not-allowed pointer-events-none bg-emerald-400 text-white/80":"bg-emerald-500 text-white hover:bg-emerald-600"}`,children:[e.jsx(fe,{className:"h-3 w-3 mr-1"}),"Excel"]})]}),q&&e.jsxs("button",{type:"button",onClick:()=>me(null),className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-500 focus-visible:ring-offset-2 px-3 h-10 shadow-sm hover:shadow-md bg-amber-100 text-amber-700 hover:bg-amber-200 dark:bg-amber-900/50 dark:text-amber-300 dark:hover:bg-amber-900/70 border border-amber-300 dark:border-amber-700",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Historique"})]}),y&&e.jsxs("button",{type:"button",onClick:Ee,className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 px-3 h-10 shadow-sm hover:shadow-md bg-blue-500 text-white hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700",children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Importer"})]}),e.jsxs("button",{onClick:de,className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-amber-500 text-white hover:bg-amber-600 dark:bg-amber-600 dark:text-white dark:hover:bg-amber-700 px-4 py-2 h-10 shadow-sm hover:shadow-md",children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Ajouter un produit"}),e.jsx("span",{className:"sm:hidden",children:"Ajouter"})]})]})]}),children:[e.jsx(ze,{title:"Gestion des Produits"}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[e.jsxs(ye,{className:"mb-6 bg-white dark:bg-gray-800",children:[e.jsx(je,{children:e.jsxs(be,{className:"flex items-center text-gray-900 dark:text-white",children:[e.jsx(ie,{className:"h-5 w-5 mr-2"}),"Search Products"]})}),e.jsx(ve,{children:e.jsx("form",{onSubmit:Pe,className:"flex flex-col gap-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(v,{placeholder:"Rechercher par nom ou code...",value:S,onChange:r=>l(r.target.value)})}),e.jsx("div",{className:"flex-1",children:e.jsxs("select",{className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500",value:D,onChange:r=>I(r.target.value),children:[e.jsx("option",{value:"",children:"Toutes les catégories"}),s.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})}),e.jsx("div",{className:"flex-1",children:e.jsxs("select",{className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500",value:R,onChange:r=>w(r.target.value),children:[e.jsx("option",{value:"",children:"Tous les statuts"}),e.jsx("option",{value:"active",children:"Actif"}),e.jsx("option",{value:"inactive",children:"Inactif"})]})}),e.jsxs(f,{type:"submit",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Rechercher"]})]})})})]}),e.jsxs(ye,{className:"bg-white dark:bg-gray-800",children:[e.jsx(je,{children:e.jsxs(be,{className:"flex items-center text-gray-900 dark:text-white",children:[e.jsx(W,{className:"h-5 w-5 mr-2"}),"Products List (",i.length,")"]})}),e.jsx(ve,{children:i.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(W,{className:"h-12 w-12 mx-auto text-gray-400 dark:text-gray-500 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No products found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Get started by creating your first product."}),e.jsxs("button",{onClick:de,className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-amber-500 text-white hover:bg-amber-600 dark:bg-amber-600 dark:text-white dark:hover:bg-amber-700 px-4 py-2 h-10 shadow-sm hover:shadow-md",children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Ajouter un produit"]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Product"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Code"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Category"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Price"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Stock"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:i.map(r=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex-shrink-0 relative h-10 w-10 rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-700",children:[r.image_url&&e.jsx("img",{src:r.image_url,alt:r.name,className:"absolute inset-0 h-10 w-10 object-cover z-[1]",onError:g=>{g.target.onerror=null,g.target.style.display="none"}}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-0",children:e.jsx(W,{className:"h-6 w-6 text-gray-400 dark:text-gray-500"})})]}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:r.name}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[r.description?.substring(0,50),"..."]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:r.product_code}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:r.category?.name||"N/A"}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:[r.price_currency," ",r.price_amount?.toFixed(2)]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:[e.jsx("span",{className:"font-medium",children:r.current_stock}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[" / ",r.minimum_stock]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:Re(r)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(f,{variant:"outline",size:"sm",onClick:()=>Ie(r),title:"Voir le détail",children:e.jsx(es,{className:"h-4 w-4"})}),q&&e.jsx(f,{variant:"outline",size:"sm",onClick:()=>me(r),title:"Historique des mouvements",className:"text-amber-600 hover:text-amber-700 hover:border-amber-300",children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>oe(r),title:"Modifier",children:e.jsx(pe,{className:"h-4 w-4"})}),$?.length>=1&&e.jsx(f,{variant:"outline",size:"sm",onClick:()=>Te(r),title:"Dupliquer vers un autre dépôt",className:"text-blue-600 hover:text-blue-700 hover:border-blue-300",children:e.jsx(ss,{className:"h-4 w-4"})}),e.jsx(f,{variant:"destructive",size:"sm",onClick:()=>qe(r),children:e.jsx(ds,{className:"h-4 w-4"})})]})})]},r.id))})]})})})]})]})}),e.jsx(ae,{show:J,onClose:()=>{c(!1),z(null)},maxWidth:"xl",children:u&&e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Détail du produit"}),e.jsx("button",{type:"button",onClick:()=>c(!1),className:"rounded-md text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(Q,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex gap-6",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"relative h-32 w-32 rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-700",children:[u.image_url?e.jsx("img",{src:u.image_url,alt:u.name,className:"absolute inset-0 h-full w-full object-cover",onError:r=>{r.target.onerror=null,r.target.style.display="none"}}):null,e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(W,{className:"h-16 w-16 text-gray-400 dark:text-gray-500"})})]})}),e.jsxs("div",{className:"flex-1 space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Nom"}),e.jsx("p",{className:"text-gray-900 dark:text-white font-medium",children:u.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Code"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:u.product_code})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Catégorie"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:u.category?.name||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Prix"}),e.jsxs("p",{className:"text-gray-900 dark:text-white",children:[u.price_currency," ",u.price_amount?.toFixed(2),u.cost!=null&&e.jsxs("span",{className:"text-gray-500 dark:text-gray-400 ml-2",children:["(Revient: ",u.price_currency," ",u.cost?.toFixed(2),")"]})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Stock"}),e.jsxs("p",{className:"text-gray-900 dark:text-white",children:[u.current_stock??u.stock??0," / ",u.minimum_stock??0," min"]})]}),u.description&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Description"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:u.description})]}),e.jsx("div",{className:"pt-4",children:e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>{c(!1),oe(u)},children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Modifier"]})})]})]})]})}),e.jsx(ae,{show:Se,onClose:()=>{X(!1),te(null),K("")},maxWidth:"sm",children:Y&&e.jsxs("form",{onSubmit:Fe,className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Dupliquer vers un dépôt"}),e.jsx("button",{type:"button",onClick:()=>X(!1),className:"rounded-md text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(Q,{className:"h-5 w-5"})})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:["Créer une copie de « ",Y.name," » dans un autre dépôt (même infos, nouveau code, stock à 0)."]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"duplicate-depot",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Dépôt cible"}),e.jsxs("select",{id:"duplicate-depot",value:Z,onChange:r=>K(r.target.value),className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white shadow-sm focus:ring-orange-500 focus:border-orange-500",required:!0,children:[e.jsx("option",{value:"",children:"— Choisir un dépôt —"}),($??[]).map(r=>e.jsxs("option",{value:r.id,children:[r.name||`Dépôt ${r.id}`,n?.id===r.id?" (actuel)":""]},r.id))]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>X(!1),children:"Annuler"}),e.jsx(f,{type:"submit",disabled:le||!Z,children:le?"Duplication…":"Dupliquer"})]})]})}),e.jsx(ae,{show:M,onClose:()=>{U(!1),L(null),t(null)},maxWidth:"lg",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Importer des produits"}),e.jsx("button",{type:"button",onClick:()=>U(!1),className:"rounded-md text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(Q,{className:"h-5 w-5"})})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:["Fichiers acceptés : .xlsx ou .csv. Colonnes obligatoires : ",e.jsx("strong",{children:"nom"}),", ",e.jsx("strong",{children:"code"}),", ",e.jsx("strong",{children:"categorie_id"})," (ou nom de catégorie), ",e.jsx("strong",{children:"prix"}),", ",e.jsx("strong",{children:"unite"}),"."]}),e.jsxs("form",{onSubmit:De,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Fichier"}),e.jsx("input",{type:"file",accept:".xlsx,.csv,.txt",onChange:r=>L(r.target.files?.[0]||null),className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 dark:file:bg-blue-900/20 dark:file:text-blue-400"})]}),C&&e.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"flex items-center text-green-600 dark:text-green-400",children:[e.jsx(ls,{className:"h-5 w-5 mr-1"}),C.success," importé(s)"]}),C.failed>0&&e.jsxs("span",{className:"flex items-center text-red-600 dark:text-red-400",children:[e.jsx(ts,{className:"h-5 w-5 mr-1"}),C.failed," échoué(s)"]})]}),C.errors?.length>0&&e.jsx("div",{className:"mt-2 max-h-32 overflow-y-auto text-xs text-red-600 dark:text-red-400",children:C.errors.map((r,g)=>e.jsx("div",{children:r},g))})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>U(!1),children:"Fermer"}),e.jsx(f,{type:"submit",disabled:!H||a,children:a?"Import en cours...":"Importer"})]})]})]})}),e.jsx(xs,{isOpen:k,onClose:()=>{T(!1),A(null)},product:B,categories:s}),q&&e.jsx(us,{isOpen:d,onClose:()=>{b(!1),O(null)},product:P})]})}export{Rs as default};
