import{b as se,r as d,j as e,H as de,L as O,c as I,z as C,a as F}from"./app-Bu58nmqp.js";import{A as le,b as U,e as G,s as P,$ as q,F as ie,i as ce,P as Q,x as ne,a0 as oe}from"./AppLayout-PYzm33Di.js";import{C as i,a as c,b as n,c as o}from"./card-DoR82Obt.js";import{B as l}from"./Button-CJzVzbMf.js";import{I as N}from"./Input-B1xyFs7T.js";import{L as x}from"./Label-BUXOAy6-.js";import{B as W}from"./badge-Dg1bczFZ.js";import{M as xe}from"./Modal-I7t2t8jt.js";import{E as me}from"./ExportButtons-D3_NazGx.js";import"./createLucideIcon-D31lZ7X_.js";import"./shield-x-Be2eaKBY.js";import"./x-BNg5u3GU.js";import"./user-cog-DOLB-E56.js";import"./Dropdown-BckUvWPZ.js";import"./transition-Dwpb1-fu.js";import"./arrow-left-DSvgm0i3.js";import"./loader-circle-BgO0_QPs.js";import"./refresh-cw-DMClxRp8.js";import"./FlashMessages-Ce1oH_d3.js";function ze({products:y,lowStock:p,expiringSoon:b,categories:X=[],filters:m={},pagination:r}){const{data:a,setData:h,post:he,processing:ge,errors:A}=se({product_id:"",type:"adjust",quantity:"",batch_number:"",expiry_date:"",supplier_id:"",purchase_order_id:""}),[K,f]=d.useState(!1),[j,v]=d.useState(null),[M,V]=d.useState(m.search||""),[T,$]=d.useState(m.category_id||""),[z,J]=d.useState(m.stock_status||""),[L,Y]=d.useState(m.per_page||r?.per_page||15),[Z,w]=d.useState(!1),[R,_]=d.useState(null),[E,S]=d.useState([]),[g,H]=d.useState(!1),ee=async()=>{if(j){H(!0);try{await I.post(route("pharmacy.products.stock.update",j.id),{type:a.type,quantity:a.quantity,batch_number:a.batch_number||null,expiry_date:a.expiry_date||null,supplier_id:a.supplier_id||null,purchase_order_id:a.purchase_order_id||null},{headers:{Accept:"application/json","Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}}),C.success("Stock mis à jour avec succès"),f(!1),v(null),h({product_id:"",type:"adjust",quantity:"",batch_number:"",expiry_date:"",supplier_id:"",purchase_order_id:""}),F.reload()}catch(t){let s="Échec de la mise à jour du stock";const u=t.response?.data;if(u){if(typeof u.message=="string")s=u.message;else if(u.errors&&typeof u.errors=="object"){const B=Object.values(u.errors).flat()[0];B&&(s=B)}}C.error(String(s))}finally{H(!1)}}},k=(t,s="adjust")=>{v(t),h({...a,product_id:t.id,type:s}),f(!0)},te=t=>t.current_stock<=0?{status:"out",color:"destructive",label:"Rupture"}:t.current_stock<=t.minimum_stock?{status:"low",color:"warning",label:"Stock faible"}:{status:"good",color:"success",label:"OK"},re=t=>{t.preventDefault(),F.get(route("pharmacy.stock.index"),{search:M||void 0,category_id:T||void 0,stock_status:z||void 0,per_page:L||void 0},{preserveState:!0,preserveScroll:!0})},D=t=>{F.get(route("pharmacy.stock.index"),{search:m.search,category_id:m.category_id,stock_status:m.stock_status,per_page:r?.per_page,page:t},{preserveState:!0,preserveScroll:!0})},ae=async t=>{try{const s=await I.get(route("pharmacy.stock.movements",t.id));S(s.data.movements||[]),_(t),w(!0)}catch{C.error("Impossible de charger l'historique")}};return e.jsxs(le,{header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 dark:text-gray-100 leading-tight",children:"Gestion du Stock"}),children:[e.jsx(de,{title:"Gestion du Stock"}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs(i,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Total Produits"}),e.jsx(U,{className:"h-4 w-4 text-blue-500"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:r?.total??y.length}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"produits en stock"})]})]}),e.jsxs(i,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Stock Faible"}),e.jsx(G,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:p.length}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"produits à réapprovisionner"})]})]}),e.jsxs(i,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Expirations Proches"}),e.jsx(P,{className:"h-4 w-4 text-red-500"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:b.length}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3",children:"lots expirent bientôt"}),e.jsxs(O,{href:route("pharmacy.expirations.index"),className:"flex items-center justify-center gap-2 w-full px-3 py-2 text-sm font-medium rounded-md bg-red-500 hover:bg-red-600 text-white transition-colors",children:[e.jsx(P,{className:"h-4 w-4"}),e.jsx("span",{children:"Voir tout"})]})]})]}),e.jsxs(i,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Actions rapides"}),e.jsx(q,{className:"h-4 w-4 text-purple-500"})]}),e.jsx(o,{children:e.jsxs(O,{href:route("pharmacy.stock.movements.index"),className:"flex items-center justify-center gap-2 w-full px-3 py-2 text-sm font-medium rounded-md bg-purple-500 hover:bg-purple-600 text-white transition-colors",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("span",{children:"Historique mouvements"})]})})]})]}),e.jsxs(i,{className:"mb-6 bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(c,{className:"flex flex-row items-center justify-between",children:[e.jsxs(n,{className:"flex items-center text-gray-900 dark:text-white",children:[e.jsx(ie,{className:"h-5 w-5 mr-2 text-amber-500"}),"Filtres"]}),e.jsx(me,{pdfUrl:route("pharmacy.exports.stock.pdf"),excelUrl:route("pharmacy.exports.stock.excel"),disabled:!y.length})]}),e.jsx(o,{children:e.jsxs("form",{onSubmit:re,className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(x,{htmlFor:"search",className:"text-gray-700 dark:text-gray-300",children:"Recherche"}),e.jsx(N,{id:"search",placeholder:"Nom ou code produit",value:M,onChange:t=>V(t.target.value),className:"bg-white dark:bg-slate-800 border-gray-300 dark:border-slate-600 text-gray-900 dark:text-gray-100"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(x,{htmlFor:"category",className:"text-gray-700 dark:text-gray-300",children:"Catégorie"}),e.jsxs("select",{id:"category",value:T,onChange:t=>$(t.target.value),className:"w-full h-10 rounded-md border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-gray-900 dark:text-gray-100 px-3 focus:outline-none focus:ring-2 focus:ring-amber-500",children:[e.jsx("option",{value:"",children:"Toutes"}),X.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(x,{htmlFor:"stock_status",className:"text-gray-700 dark:text-gray-300",children:"Statut stock"}),e.jsxs("select",{id:"stock_status",value:z,onChange:t=>J(t.target.value),className:"w-full h-10 rounded-md border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-gray-900 dark:text-gray-100 px-3 focus:outline-none focus:ring-2 focus:ring-amber-500",children:[e.jsx("option",{value:"",children:"Tous"}),e.jsx("option",{value:"low",children:"Stock faible"}),e.jsx("option",{value:"out",children:"Rupture"})]})]}),e.jsxs("div",{className:"w-full md:w-32",children:[e.jsx(x,{htmlFor:"per_page",className:"text-gray-700 dark:text-gray-300",children:"Par page"}),e.jsxs("select",{id:"per_page",value:L,onChange:t=>Y(t.target.value),className:"w-full h-10 rounded-md border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-gray-900 dark:text-gray-100 px-3 focus:outline-none focus:ring-2 focus:ring-amber-500",children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:15,children:"15"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(l,{type:"submit",className:"bg-amber-500 hover:bg-amber-600 text-white",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Filtrer"]})})]})})]}),p.length>0&&e.jsxs(i,{className:"mb-6 bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800",children:[e.jsx(c,{children:e.jsxs(n,{className:"flex items-center text-orange-800 dark:text-orange-300",children:[e.jsx(G,{className:"h-5 w-5 mr-2"}),"Alerte Stock Faible (",p.length," produits)"]})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-3",children:p.slice(0,5).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white dark:bg-slate-800 rounded-lg border border-orange-100 dark:border-orange-900",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Actuel: ",t.current_stock," | Minimum: ",t.minimum_stock]})]}),e.jsxs(l,{size:"sm",onClick:()=>k(t,"add"),className:"bg-orange-500 hover:bg-orange-600 text-white",children:[e.jsx(Q,{className:"h-4 w-4 mr-1"}),"Ajouter"]})]},t.id))})})]}),b.length>0&&e.jsxs(i,{className:"mb-6 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800",children:[e.jsx(c,{children:e.jsxs(n,{className:"flex items-center text-red-800 dark:text-red-300",children:[e.jsx(P,{className:"h-5 w-5 mr-2"}),"Expirations Proches (",b.length," lots)"]})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-3",children:b.slice(0,5).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white dark:bg-slate-800 rounded-lg border border-red-100 dark:border-red-900",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:t.product_name}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Lot: ",t.batch_number," | Expire: ",t.expiry_date]})]}),e.jsxs(W,{variant:"destructive",children:[t.days_until_expiry," jours"]})]},t.id))})})]}),K&&j&&e.jsxs(i,{className:"mb-6 bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsx(c,{children:e.jsxs(n,{className:"text-gray-900 dark:text-white",children:["Mettre à jour le stock de ",j.name]})}),e.jsx(o,{children:e.jsxs("form",{onSubmit:t=>t.preventDefault(),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"type",className:"text-gray-700 dark:text-gray-300",children:"Type d'opération"}),e.jsxs("select",{id:"type",value:a.type,onChange:t=>h("type",t.target.value),className:"w-full h-10 rounded-md border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-gray-900 dark:text-gray-100 px-3 focus:outline-none focus:ring-2 focus:ring-amber-500",children:[e.jsx("option",{value:"add",children:"Ajouter"}),e.jsx("option",{value:"remove",children:"Retirer"}),e.jsx("option",{value:"adjust",children:"Ajuster"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"quantity",className:"text-gray-700 dark:text-gray-300",children:"Quantité *"}),e.jsx(N,{id:"quantity",type:"number",value:a.quantity,onChange:t=>h("quantity",t.target.value),placeholder:"Entrez la quantité",className:"bg-white dark:bg-slate-800 border-gray-300 dark:border-slate-600 text-gray-900 dark:text-gray-100"}),A.quantity&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:A.quantity})]})]}),(a.type==="add"||a.type==="adjust")&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"batch_number",className:"text-gray-700 dark:text-gray-300",children:"Numéro de lot"}),e.jsx(N,{id:"batch_number",value:a.batch_number,onChange:t=>h("batch_number",t.target.value),placeholder:"LOT-001",className:"bg-white dark:bg-slate-800 border-gray-300 dark:border-slate-600 text-gray-900 dark:text-gray-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"expiry_date",className:"text-gray-700 dark:text-gray-300",children:"Date d'expiration"}),e.jsx(N,{id:"expiry_date",type:"date",value:a.expiry_date,onChange:t=>h("expiry_date",t.target.value),className:"bg-white dark:bg-slate-800 border-gray-300 dark:border-slate-600 text-gray-900 dark:text-gray-100"})]})]})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>{f(!1),v(null)},disabled:g,className:"border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-200",children:"Annuler"}),e.jsx(l,{type:"button",disabled:g,onClick:ee,className:"bg-amber-500 hover:bg-amber-600 text-white",children:g?"Mise à jour...":"Mettre à jour"})]})]})})]}),e.jsxs(i,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsx(c,{children:e.jsxs(n,{className:"flex items-center text-gray-900 dark:text-white",children:[e.jsx(U,{className:"h-5 w-5 mr-2 text-blue-500"}),"Produits (",r?.total??y.length,")"]})}),e.jsx(o,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-slate-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-slate-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Produit"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Stock actuel"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Statut"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-slate-900 divide-y divide-gray-200 dark:divide-slate-700",children:y.map(t=>{const s=te(t);return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-slate-800",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.name}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.product_code})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm text-gray-900 dark:text-white",children:[e.jsx("span",{className:"font-medium",children:t.current_stock}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[" / ",t.minimum_stock]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(W,{variant:s.color,children:s.label})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>k(t,"add"),disabled:g,className:"border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-slate-700",title:"Ajouter",children:e.jsx(Q,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>k(t,"remove"),disabled:g,className:"border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-slate-700",title:"Retirer",children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>k(t,"adjust"),disabled:g,className:"border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-slate-700",title:"Ajuster",children:e.jsx(oe,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>ae(t),className:"border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-slate-700",title:"Historique",children:e.jsx(q,{className:"h-4 w-4"})})]})})]},t.id)})})]})})})]}),r&&r.last_page>1&&e.jsxs("div",{className:"mt-4 flex items-center justify-between text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{children:["Affichage de ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:r.from})," à"," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:r.to})," sur"," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:r.total})," produit(s)"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(l,{variant:"outline",size:"sm",disabled:r.current_page<=1,onClick:()=>D(r.current_page-1),className:"border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-200",children:"Précédent"}),e.jsx(l,{variant:"outline",size:"sm",disabled:r.current_page>=r.last_page,onClick:()=>D(r.current_page+1),className:"border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-200",children:"Suivant"})]})]})]})}),R&&e.jsx(xe,{show:Z,onClose:()=>{w(!1),_(null),S([])},maxWidth:"xl",children:e.jsxs("div",{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Historique des mouvements – ",R.name]}),e.jsx("button",{type:"button",onClick:()=>{w(!1),_(null),S([])},className:"rounded-md text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 text-2xl",children:"×"})]}),E.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Aucun mouvement enregistré."}):e.jsx("div",{className:"overflow-x-auto max-h-80",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-slate-700 text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-slate-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-4 py-2 text-right font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Quantité"}),e.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Référence"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-slate-900 divide-y divide-gray-200 dark:divide-slate-700",children:E.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-gray-700 dark:text-gray-300",children:t.created_at}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-gray-700 dark:text-gray-300",children:t.type}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-right text-gray-700 dark:text-gray-300",children:t.quantity}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-gray-700 dark:text-gray-300",children:t.reference||"—"})]},t.id))})]})})]})})]})}export{ze as default};
