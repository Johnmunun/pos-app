import{b as te,r as d,j as e,H as re,L as R,a as C,c as ae}from"./app-3PKVeuQh.js";import{A as se,b as B,e as D,n as F,z as P,F as de,h as le,P as I,w as ie,I as ce}from"./AppLayout-DSrKCpOy.js";import{C as l,a as i,b as c,c as n}from"./card-FPNRX1p2.js";import{B as a}from"./Button-RC9FN5z3.js";import{I as j}from"./Input-5gvkn2nv.js";import{L as x}from"./Label-DCTvEg5s.js";import{B as O}from"./badge-Ca6uIRAr.js";import{u as ne}from"./use-toast-B4iWoEZ4.js";import{M as xe}from"./Modal-DSnhLKcn.js";import{E as oe}from"./ExportButtons-Bm2TEI_V.js";import"./createLucideIcon-CyiEew_u.js";import"./shield-x-gOy17OJ-.js";import"./x-YL0zAneP.js";import"./user-cog-nVqfHm0b.js";import"./Dropdown-B_QkibTR.js";import"./transition-CufTvwOt.js";import"./arrow-left-CvJq81LS.js";import"./loader-circle-D2tkCN5O.js";import"./refresh-cw-L3GUbwVE.js";import"./FlashMessages-bPB7K-Ql.js";function qe({products:u,lowStock:y,expiringSoon:p,categories:U=[],filters:o={},pagination:r}){const{toast:k}=ne(),{data:m,setData:g,post:G,processing:h,errors:A}=te({product_id:"",type:"adjust",quantity:"",batch_number:"",expiry_date:"",supplier_id:"",purchase_order_id:""}),[Q,N]=d.useState(!1),[v,f]=d.useState(null),[M,K]=d.useState(o.search||""),[q,V]=d.useState(o.category_id||""),[E,W]=d.useState(o.stock_status||""),[T,J]=d.useState(o.per_page||r?.per_page||15),[X,w]=d.useState(!1),[z,_]=d.useState(null),[L,S]=d.useState([]),Y=t=>{t.preventDefault(),G(route("pharmacy.products.stock.update",v.id),{onSuccess:()=>{k({title:"Succès",description:"Stock mis à jour avec succès"}),N(!1),f(null),C.reload()},onError:s=>{k({title:"Erreur",description:s.message||"Échec de la mise à jour du stock",variant:"destructive"})}})},b=(t,s="adjust")=>{f(t),g({...m,product_id:t.id,type:s}),N(!0)},Z=t=>t.current_stock<=0?{status:"out",color:"destructive",label:"Rupture"}:t.current_stock<=t.minimum_stock?{status:"low",color:"warning",label:"Stock faible"}:{status:"good",color:"success",label:"OK"},$=t=>{t.preventDefault(),C.get(route("pharmacy.stock.index"),{search:M||void 0,category_id:q||void 0,stock_status:E||void 0,per_page:T||void 0},{preserveState:!0,preserveScroll:!0})},H=t=>{C.get(route("pharmacy.stock.index"),{search:o.search,category_id:o.category_id,stock_status:o.stock_status,per_page:r?.per_page,page:t},{preserveState:!0,preserveScroll:!0})},ee=async t=>{try{const s=await ae.get(route("pharmacy.stock.movements",t.id));S(s.data.movements||[]),_(t),w(!0)}catch{k({title:"Erreur",description:"Impossible de charger l'historique",variant:"destructive"})}};return e.jsxs(se,{header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 dark:text-gray-100 leading-tight",children:"Gestion du Stock"}),children:[e.jsx(re,{title:"Gestion du Stock"}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs(l,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Total Produits"}),e.jsx(B,{className:"h-4 w-4 text-blue-500"})]}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:r?.total??u.length}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"produits en stock"})]})]}),e.jsxs(l,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Stock Faible"}),e.jsx(D,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:y.length}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"produits à réapprovisionner"})]})]}),e.jsxs(l,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Expirations Proches"}),e.jsx(F,{className:"h-4 w-4 text-red-500"})]}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:p.length}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3",children:"lots expirent bientôt"}),e.jsxs(R,{href:route("pharmacy.expirations.index"),className:"flex items-center justify-center gap-2 w-full px-3 py-2 text-sm font-medium rounded-md bg-red-500 hover:bg-red-600 text-white transition-colors",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx("span",{children:"Voir tout"})]})]})]}),e.jsxs(l,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Actions rapides"}),e.jsx(P,{className:"h-4 w-4 text-purple-500"})]}),e.jsx(n,{children:e.jsxs(R,{href:route("pharmacy.stock.movements.index"),className:"flex items-center justify-center gap-2 w-full px-3 py-2 text-sm font-medium rounded-md bg-purple-500 hover:bg-purple-600 text-white transition-colors",children:[e.jsx(P,{className:"h-4 w-4"}),e.jsx("span",{children:"Historique mouvements"})]})})]})]}),e.jsxs(l,{className:"mb-6 bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(i,{className:"flex flex-row items-center justify-between",children:[e.jsxs(c,{className:"flex items-center text-gray-900 dark:text-white",children:[e.jsx(de,{className:"h-5 w-5 mr-2 text-amber-500"}),"Filtres"]}),e.jsx(oe,{pdfUrl:route("pharmacy.exports.stock.pdf"),excelUrl:route("pharmacy.exports.stock.excel"),disabled:!u.length})]}),e.jsx(n,{children:e.jsxs("form",{onSubmit:$,className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(x,{htmlFor:"search",className:"text-gray-700 dark:text-gray-300",children:"Recherche"}),e.jsx(j,{id:"search",placeholder:"Nom ou code produit",value:M,onChange:t=>K(t.target.value),className:"bg-white dark:bg-slate-800 border-gray-300 dark:border-slate-600 text-gray-900 dark:text-gray-100"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(x,{htmlFor:"category",className:"text-gray-700 dark:text-gray-300",children:"Catégorie"}),e.jsxs("select",{id:"category",value:q,onChange:t=>V(t.target.value),className:"w-full h-10 rounded-md border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-gray-900 dark:text-gray-100 px-3 focus:outline-none focus:ring-2 focus:ring-amber-500",children:[e.jsx("option",{value:"",children:"Toutes"}),U.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(x,{htmlFor:"stock_status",className:"text-gray-700 dark:text-gray-300",children:"Statut stock"}),e.jsxs("select",{id:"stock_status",value:E,onChange:t=>W(t.target.value),className:"w-full h-10 rounded-md border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-gray-900 dark:text-gray-100 px-3 focus:outline-none focus:ring-2 focus:ring-amber-500",children:[e.jsx("option",{value:"",children:"Tous"}),e.jsx("option",{value:"low",children:"Stock faible"}),e.jsx("option",{value:"out",children:"Rupture"})]})]}),e.jsxs("div",{className:"w-full md:w-32",children:[e.jsx(x,{htmlFor:"per_page",className:"text-gray-700 dark:text-gray-300",children:"Par page"}),e.jsxs("select",{id:"per_page",value:T,onChange:t=>J(t.target.value),className:"w-full h-10 rounded-md border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-gray-900 dark:text-gray-100 px-3 focus:outline-none focus:ring-2 focus:ring-amber-500",children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:15,children:"15"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(a,{type:"submit",className:"bg-amber-500 hover:bg-amber-600 text-white",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Filtrer"]})})]})})]}),y.length>0&&e.jsxs(l,{className:"mb-6 bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800",children:[e.jsx(i,{children:e.jsxs(c,{className:"flex items-center text-orange-800 dark:text-orange-300",children:[e.jsx(D,{className:"h-5 w-5 mr-2"}),"Alerte Stock Faible (",y.length," produits)"]})}),e.jsx(n,{children:e.jsx("div",{className:"space-y-3",children:y.slice(0,5).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white dark:bg-slate-800 rounded-lg border border-orange-100 dark:border-orange-900",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Actuel: ",t.current_stock," | Minimum: ",t.minimum_stock]})]}),e.jsxs(a,{size:"sm",onClick:()=>b(t,"add"),className:"bg-orange-500 hover:bg-orange-600 text-white",children:[e.jsx(I,{className:"h-4 w-4 mr-1"}),"Ajouter"]})]},t.id))})})]}),p.length>0&&e.jsxs(l,{className:"mb-6 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800",children:[e.jsx(i,{children:e.jsxs(c,{className:"flex items-center text-red-800 dark:text-red-300",children:[e.jsx(F,{className:"h-5 w-5 mr-2"}),"Expirations Proches (",p.length," lots)"]})}),e.jsx(n,{children:e.jsx("div",{className:"space-y-3",children:p.slice(0,5).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white dark:bg-slate-800 rounded-lg border border-red-100 dark:border-red-900",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:t.product_name}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Lot: ",t.batch_number," | Expire: ",t.expiry_date]})]}),e.jsxs(O,{variant:"destructive",children:[t.days_until_expiry," jours"]})]},t.id))})})]}),Q&&v&&e.jsxs(l,{className:"mb-6 bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsx(i,{children:e.jsxs(c,{className:"text-gray-900 dark:text-white",children:["Mettre à jour le stock de ",v.name]})}),e.jsx(n,{children:e.jsxs("form",{onSubmit:Y,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"type",className:"text-gray-700 dark:text-gray-300",children:"Type d'opération"}),e.jsxs("select",{id:"type",value:m.type,onChange:t=>g("type",t.target.value),className:"w-full h-10 rounded-md border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-gray-900 dark:text-gray-100 px-3 focus:outline-none focus:ring-2 focus:ring-amber-500",children:[e.jsx("option",{value:"add",children:"Ajouter"}),e.jsx("option",{value:"remove",children:"Retirer"}),e.jsx("option",{value:"adjust",children:"Ajuster"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"quantity",className:"text-gray-700 dark:text-gray-300",children:"Quantité *"}),e.jsx(j,{id:"quantity",type:"number",value:m.quantity,onChange:t=>g("quantity",t.target.value),placeholder:"Entrez la quantité",className:"bg-white dark:bg-slate-800 border-gray-300 dark:border-slate-600 text-gray-900 dark:text-gray-100"}),A.quantity&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:A.quantity})]})]}),(m.type==="add"||m.type==="adjust")&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"batch_number",className:"text-gray-700 dark:text-gray-300",children:"Numéro de lot"}),e.jsx(j,{id:"batch_number",value:m.batch_number,onChange:t=>g("batch_number",t.target.value),placeholder:"LOT-001",className:"bg-white dark:bg-slate-800 border-gray-300 dark:border-slate-600 text-gray-900 dark:text-gray-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"expiry_date",className:"text-gray-700 dark:text-gray-300",children:"Date d'expiration"}),e.jsx(j,{id:"expiry_date",type:"date",value:m.expiry_date,onChange:t=>g("expiry_date",t.target.value),className:"bg-white dark:bg-slate-800 border-gray-300 dark:border-slate-600 text-gray-900 dark:text-gray-100"})]})]})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(a,{type:"button",variant:"outline",onClick:()=>{N(!1),f(null)},disabled:h,className:"border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-200",children:"Annuler"}),e.jsx(a,{type:"submit",disabled:h,className:"bg-amber-500 hover:bg-amber-600 text-white",children:h?"Mise à jour...":"Mettre à jour"})]})]})})]}),e.jsxs(l,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsx(i,{children:e.jsxs(c,{className:"flex items-center text-gray-900 dark:text-white",children:[e.jsx(B,{className:"h-5 w-5 mr-2 text-blue-500"}),"Produits (",r?.total??u.length,")"]})}),e.jsx(n,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-slate-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-slate-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Produit"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Stock actuel"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Statut"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-slate-900 divide-y divide-gray-200 dark:divide-slate-700",children:u.map(t=>{const s=Z(t);return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-slate-800",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.name}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.product_code})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm text-gray-900 dark:text-white",children:[e.jsx("span",{className:"font-medium",children:t.current_stock}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[" / ",t.minimum_stock]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(O,{variant:s.color,children:s.label})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(a,{variant:"outline",size:"sm",onClick:()=>b(t,"add"),disabled:h,className:"border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-slate-700",title:"Ajouter",children:e.jsx(I,{className:"h-4 w-4"})}),e.jsx(a,{variant:"outline",size:"sm",onClick:()=>b(t,"remove"),disabled:h,className:"border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-slate-700",title:"Retirer",children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx(a,{variant:"outline",size:"sm",onClick:()=>b(t,"adjust"),disabled:h,className:"border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-slate-700",title:"Ajuster",children:e.jsx(ce,{className:"h-4 w-4"})}),e.jsx(a,{variant:"outline",size:"sm",onClick:()=>ee(t),className:"border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-slate-700",title:"Historique",children:e.jsx(P,{className:"h-4 w-4"})})]})})]},t.id)})})]})})})]}),r&&r.last_page>1&&e.jsxs("div",{className:"mt-4 flex items-center justify-between text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{children:["Affichage de ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:r.from})," à"," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:r.to})," sur"," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:r.total})," produit(s)"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{variant:"outline",size:"sm",disabled:r.current_page<=1,onClick:()=>H(r.current_page-1),className:"border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-200",children:"Précédent"}),e.jsx(a,{variant:"outline",size:"sm",disabled:r.current_page>=r.last_page,onClick:()=>H(r.current_page+1),className:"border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-200",children:"Suivant"})]})]})]})}),z&&e.jsx(xe,{show:X,onClose:()=>{w(!1),_(null),S([])},maxWidth:"xl",children:e.jsxs("div",{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Historique des mouvements – ",z.name]}),e.jsx("button",{type:"button",onClick:()=>{w(!1),_(null),S([])},className:"rounded-md text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 text-2xl",children:"×"})]}),L.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Aucun mouvement enregistré."}):e.jsx("div",{className:"overflow-x-auto max-h-80",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-slate-700 text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-slate-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-4 py-2 text-right font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Quantité"}),e.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Référence"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-slate-900 divide-y divide-gray-200 dark:divide-slate-700",children:L.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-gray-700 dark:text-gray-300",children:t.created_at}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-gray-700 dark:text-gray-300",children:t.type}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-right text-gray-700 dark:text-gray-300",children:t.quantity}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-gray-700 dark:text-gray-300",children:t.reference||"—"})]},t.id))})]})})]})})]})}export{qe as default};
