import{u as U,r as y,j as e,H as V,a as J}from"./app-DtqU_Gmt.js";import{A as K,I as P,t as O,y as Q,F as Y,v as W,D as X,d as E,G as $,h as Z,b as ee,e as te,i as re,k as se,j as ae,J as de,K as N}from"./AppLayout-C4K4I5xd.js";import{C as s,a,b as d,c as l}from"./card-Daek165Z.js";import{B as S}from"./Button-4k-pObky.js";import{I as q}from"./Input-BpgKxISb.js";import{L as M}from"./Label-QVyen-Zj.js";import{f as le}from"./currency-CAle3Gff.js";import{R as xe}from"./refresh-cw-CcjnuCLI.js";import"./createLucideIcon-BH-qXF_i.js";import"./shield-x-Cz4kXV9c.js";import"./x-Cw-ZD_Fb.js";import"./user-cog-BQwjoD4w.js";import"./Dropdown--z3bvfF1.js";import"./transition-DbHxI3Hw.js";import"./arrow-left-BGTcItEv.js";import"./loader-circle-DtoZnQ6b.js";import"./FlashMessages-D-g4FpAa.js";import"./utils-CDN07tui.js";function ne(){const r=new Date,c=v=>String(v).padStart(2,"0"),o=`${r.getFullYear()}-${c(r.getMonth()+1)}-01`,w=r.toISOString().slice(0,10);return{from:o,to:w}}function Se({report:r,filters:c,routePrefix:o="pharmacy"}){const{shop:w}=U().props,v=w?.currency||"CDF",x=t=>le(t,v),D=ne(),A=r?.period||{},[b,I]=y.useState(A.from||c?.from||D.from),[j,L]=y.useState(A.to||c?.to||D.to),z=t=>{t.preventDefault(),J.get(route(`${o}.reports.index`),{from:b,to:j},{preserveState:!0})},i=r?.sales||{},m=r?.purchases||{},u=r?.movements||{},_=r?.stock||{},F=r?.products_analysis||[],n=r?.period||{from:c?.from,to:c?.to},[C,B]=y.useState({key:"revenue",dir:"desc"}),R=y.useMemo(()=>{const t=[...F],h=C.key,k=C.dir==="asc"?1:-1;return t.sort((H,G)=>{const g=H[h],p=G[h];return typeof g=="number"&&typeof p=="number"?k*(g-p):g==null&&p==null?0:g==null?k:p==null?-k:k*String(g).localeCompare(String(p))}),t},[F,C]),f=t=>{B(h=>h.key===t?{key:t,dir:h.dir==="asc"?"desc":"asc"}:{key:t,dir:"desc"})},T=y.useMemo(()=>!n?.from||!n?.to?"Période":n.from===n.to?n.from:`${n.from} → ${n.to}`,[n]);return e.jsxs(K,{header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 dark:text-gray-100 leading-tight",children:"Rapport d'activité"}),children:[e.jsx(V,{title:"Rapport d'activité - Pharmacy"}),e.jsxs("div",{className:"py-6 space-y-6",children:[e.jsxs(s,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700 shadow-sm",children:[e.jsx(a,{className:"pb-4",children:e.jsxs(d,{className:"text-base flex items-center gap-2 text-gray-900 dark:text-white",children:[e.jsx(P,{className:"h-4 w-4 text-amber-500"}),"Période du rapport"]})}),e.jsxs(l,{children:[e.jsxs("form",{onSubmit:z,className:"flex flex-col sm:flex-row sm:flex-wrap items-stretch sm:items-end gap-4",children:[e.jsxs("div",{className:"space-y-2 w-full sm:w-auto sm:min-w-[160px]",children:[e.jsx(M,{htmlFor:"date_from",className:"text-gray-700 dark:text-gray-300",children:"Date début"}),e.jsx(q,{id:"date_from",type:"date",value:b,onChange:t=>I(t.target.value),className:"h-10 w-full"})]}),e.jsxs("div",{className:"space-y-2 w-full sm:w-auto sm:min-w-[160px]",children:[e.jsx(M,{htmlFor:"date_to",className:"text-gray-700 dark:text-gray-300",children:"Date fin"}),e.jsx(q,{id:"date_to",type:"date",value:j,onChange:t=>L(t.target.value),className:"h-10 w-full"})]}),e.jsxs(S,{type:"submit",size:"sm",className:"w-full sm:w-auto bg-amber-500 hover:bg-amber-600 text-white h-10 px-4",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Générer le rapport"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-3",children:["Période : ",e.jsx("strong",{className:"text-gray-700 dark:text-gray-300",children:T})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 pb-2 border-b border-gray-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-100 dark:bg-amber-900/30",children:e.jsx(O,{className:"h-6 w-6 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Rapport d'activité"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:T})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Généré le ",new Date().toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{type:"button",variant:"outline",size:"sm",className:"h-9",asChild:!0,children:e.jsxs("a",{href:route(`${o}.exports.reports.pdf`,{from:b,to:j}),target:"_blank",rel:"noopener noreferrer",children:[e.jsx(Y,{className:"h-4 w-4 mr-1.5"}),"Exporter PDF"]})}),e.jsx(S,{type:"button",variant:"outline",size:"sm",className:"h-9",asChild:!0,children:e.jsxs("a",{href:route(`${o}.exports.reports.excel`,{from:b,to:j}),target:"_blank",rel:"noopener noreferrer",children:[e.jsx(W,{className:"h-4 w-4 mr-1.5"}),"Exporter Excel"]})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4",children:[e.jsxs(s,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(a,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Chiffre d'affaires"}),e.jsx(X,{className:"h-4 w-4 text-green-500 dark:text-green-400"})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-xl font-bold text-gray-900 dark:text-white",children:x(i.total||0)}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[i.count??0," ventes"]})]})]}),e.jsxs(s,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(a,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Ventes"}),e.jsx(E,{className:"h-4 w-4 text-blue-500 dark:text-blue-400"})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-xl font-bold text-gray-900 dark:text-white",children:i.count??0}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Transactions complétées"})]})]}),e.jsxs(s,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(a,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Achats reçus"}),e.jsx($,{className:"h-4 w-4 text-indigo-500 dark:text-indigo-400"})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-xl font-bold text-gray-900 dark:text-white",children:m.count??0}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:x(m.total||0)})]})]}),e.jsxs(s,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(a,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Mouvements stock"}),e.jsx(Z,{className:"h-4 w-4 text-slate-500 dark:text-slate-400"})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-xl font-bold text-gray-900 dark:text-white",children:u.total_ops??0}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Entrées / Sorties / Réglages"})]})]}),e.jsxs(s,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(a,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Valeur stock"}),e.jsx(ee,{className:"h-4 w-4 text-amber-500 dark:text-amber-400"})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-xl font-bold text-gray-900 dark:text-white",children:x(_.total_value||0)}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[_.product_count??0," produits actifs"]})]})]}),e.jsxs(s,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(a,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Stock bas"}),e.jsx(te,{className:"h-4 w-4 text-orange-500 dark:text-orange-400"})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-xl font-bold text-orange-600 dark:text-orange-400",children:_.low_stock_count??0}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"À réapprovisionner"})]})]})]}),e.jsxs(s,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsx(a,{children:e.jsxs(d,{className:"text-base flex items-center gap-2 text-gray-900 dark:text-white",children:[e.jsx(re,{className:"h-5 w-5 text-amber-500"}),"Synthèse des mouvements de stock"]})}),e.jsx(l,{children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 rounded-lg bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800",children:[e.jsx(se,{className:"h-8 w-8 text-green-600 dark:text-green-400 shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-800 dark:text-green-200",children:"Entrées"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:["+",u.qty_in??0]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 rounded-lg bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800",children:[e.jsx(ae,{className:"h-8 w-8 text-red-600 dark:text-red-400 shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:"Sorties"}),e.jsxs("p",{className:"text-2xl font-bold text-red-700 dark:text-red-300",children:["-",u.qty_out??0]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 rounded-lg bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700",children:[e.jsx(P,{className:"h-8 w-8 text-slate-600 dark:text-slate-400 shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Réglages"}),e.jsx("p",{className:"text-2xl font-bold text-slate-700 dark:text-slate-300",children:u.qty_adjustment??0})]})]})]})})]}),e.jsxs(s,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(a,{children:[e.jsxs(d,{className:"text-base flex items-center gap-2 text-gray-900 dark:text-white",children:[e.jsx(de,{className:"h-5 w-5 text-amber-500"}),"Analyse par produit"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Par période : qui rapporte le plus, produits les plus vendus, bénéfice et marge (si coût renseigné)."})]}),e.jsx(l,{children:R.length>0?e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200 dark:border-slate-700",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 dark:bg-slate-800 border-b border-gray-200 dark:border-slate-700",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:"Produit"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:"Code"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:e.jsxs("button",{type:"button",onClick:()=>f("qty_sold"),className:"inline-flex items-center gap-1 hover:text-gray-900 dark:hover:text-white",children:["Qté vendue ",e.jsx(N,{className:"h-3.5 w-3.5"})]})}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:e.jsxs("button",{type:"button",onClick:()=>f("revenue"),className:"inline-flex items-center gap-1 hover:text-gray-900 dark:hover:text-white",children:["Chiffre d'affaires ",e.jsx(N,{className:"h-3.5 w-3.5"})]})}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:"Coût"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:e.jsxs("button",{type:"button",onClick:()=>f("benefit"),className:"inline-flex items-center gap-1 hover:text-gray-900 dark:hover:text-white",children:["Bénéfice ",e.jsx(N,{className:"h-3.5 w-3.5"})]})}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:e.jsxs("button",{type:"button",onClick:()=>f("margin_percent"),className:"inline-flex items-center gap-1 hover:text-gray-900 dark:hover:text-white",children:["Marge % ",e.jsx(N,{className:"h-3.5 w-3.5"})]})})]})}),e.jsx("tbody",{children:R.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-slate-800 hover:bg-gray-50 dark:hover:bg-slate-800/50",children:[e.jsx("td",{className:"py-3 px-4 text-gray-900 dark:text-white font-medium",children:t.product_name}),e.jsx("td",{className:"py-3 px-4 text-gray-600 dark:text-gray-400",children:t.product_code||"—"}),e.jsx("td",{className:"py-3 px-4 text-right text-gray-700 dark:text-gray-300",children:t.qty_sold}),e.jsx("td",{className:"py-3 px-4 text-right font-semibold text-gray-900 dark:text-white",children:x(t.revenue)}),e.jsx("td",{className:"py-3 px-4 text-right text-gray-600 dark:text-gray-400",children:t.cost!=null?x(t.cost):"—"}),e.jsx("td",{className:"py-3 px-4 text-right",children:t.benefit!=null?e.jsx("span",{className:t.benefit>=0?"text-green-600 dark:text-green-400 font-medium":"text-red-600 dark:text-red-400 font-medium",children:x(t.benefit)}):e.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:"—"})}),e.jsx("td",{className:"py-3 px-4 text-right",children:t.margin_percent!=null?e.jsxs("span",{className:t.margin_percent>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400",children:[t.margin_percent," %"]}):e.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:"—"})})]},t.product_id))})]})}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400 py-6 text-center",children:"Aucune vente par produit sur la période."})})]}),e.jsxs(s,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsx(a,{children:e.jsxs(d,{className:"text-base flex items-center gap-2 text-gray-900 dark:text-white",children:[e.jsx(E,{className:"h-5 w-5 text-blue-500"}),"Ventes par jour"]})}),e.jsx(l,{children:i.by_day&&i.by_day.length>0?e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200 dark:border-slate-700",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 dark:bg-slate-800 border-b border-gray-200 dark:border-slate-700",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:"Date"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:"Nombre de ventes"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:"Chiffre d'affaires"})]})}),e.jsx("tbody",{children:i.by_day.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-slate-800 hover:bg-gray-50 dark:hover:bg-slate-800/50",children:[e.jsx("td",{className:"py-3 px-4 text-gray-900 dark:text-white font-medium",children:t.date}),e.jsx("td",{className:"py-3 px-4 text-right text-gray-700 dark:text-gray-300",children:t.count}),e.jsx("td",{className:"py-3 px-4 text-right font-semibold text-gray-900 dark:text-white",children:x(t.total)})]},t.date))})]})}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400 py-6 text-center",children:"Aucune vente sur la période."})})]}),e.jsxs(s,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsx(a,{children:e.jsxs(d,{className:"text-base flex items-center gap-2 text-gray-900 dark:text-white",children:[e.jsx($,{className:"h-5 w-5 text-indigo-500"}),"Achats reçus par jour"]})}),e.jsx(l,{children:m.by_day&&m.by_day.length>0?e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200 dark:border-slate-700",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 dark:bg-slate-800 border-b border-gray-200 dark:border-slate-700",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:"Date"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:"Nombre"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:"Montant total"})]})}),e.jsx("tbody",{children:m.by_day.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-slate-800 hover:bg-gray-50 dark:hover:bg-slate-800/50",children:[e.jsx("td",{className:"py-3 px-4 text-gray-900 dark:text-white font-medium",children:t.date}),e.jsx("td",{className:"py-3 px-4 text-right text-gray-700 dark:text-gray-300",children:t.count}),e.jsx("td",{className:"py-3 px-4 text-right font-semibold text-gray-900 dark:text-white",children:x(t.total)})]},t.date))})]})}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400 py-6 text-center",children:"Aucun achat reçu sur la période."})})]})]})]})}export{Se as default};
