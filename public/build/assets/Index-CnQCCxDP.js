import{r,j as e,H as I,L as P,c as k,z as i,a as C}from"./app-B8F_Smya.js";import{A as H,W as O,P as F,L as W,n as M}from"./AppLayout-Cyrikcek.js";import{B as t}from"./Button-BSACjJaD.js";import{I as o}from"./Input-DyZz_-qK.js";import{B as z}from"./badge-CezgjasG.js";import{A as G}from"./arrow-left-uFeYT1yE.js";import"./createLucideIcon-NKf32Z79.js";import"./shield-x-CXAQmM6w.js";import"./x-Ce9nIuKt.js";import"./user-cog-Cgo5DVwg.js";import"./Dropdown-CXpnj_1U.js";import"./transition-L_iZ831R.js";import"./loader-circle-5vrT9r4x.js";import"./refresh-cw-BeeT9s1l.js";import"./FlashMessages-CHIUDfR7.js";function S({open:p,onClose:h,title:n,children:f}){return p?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:h,children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto",onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-slate-700 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:n}),e.jsx("button",{type:"button",onClick:h,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200",children:"×"})]}),e.jsx("div",{className:"p-4",children:f})]})}):null}function le({cashRegisters:p=[]}){const[h,n]=r.useState(!1),[f,c]=r.useState(!1),[A,g]=r.useState(!1),[d,m]=r.useState(null),[j,y]=r.useState(null),[l,u]=r.useState({name:"",code:"",description:"",initial_balance:"0"}),[_,w]=r.useState({opening_balance:"0"}),[b,v]=r.useState({closing_balance:"",notes:""}),[N,x]=r.useState(!1),E=async s=>{s.preventDefault(),x(!0);try{await k.post(route("pharmacy.cash-registers.store"),{name:l.name,code:l.code,description:l.description||null,initial_balance:l.initial_balance||0}),i.success("Caisse créée"),n(!1),u({name:"",code:"",description:"",initial_balance:"0"}),C.reload({only:["cashRegisters"]})}catch(a){i.error(a.response?.data?.message||"Erreur")}finally{x(!1)}},L=s=>{m(s),w({opening_balance:s.initial_balance?.toString()??"0"}),c(!0)},R=async s=>{if(s.preventDefault(),!!d){x(!0);try{await k.post(route("pharmacy.cash-registers.open",d.id),{opening_balance:parseFloat(_.opening_balance)||0}),i.success("Session ouverte"),c(!1),m(null),C.reload({only:["cashRegisters"]})}catch(a){i.error(a.response?.data?.message||"Erreur")}finally{x(!1)}}},q=s=>{const a=s.open_session;a&&(m(s),y(a),v({closing_balance:"",notes:""}),g(!0))},B=async s=>{if(s.preventDefault(),!j)return;const a=parseFloat(b.closing_balance);if(isNaN(a)||a<0){i.error("Saisissez un solde de fermeture valide.");return}x(!0);try{await k.post(route("pharmacy.cash-registers.sessions.close",j.id),{closing_balance:a,notes:b.notes||null}),i.success("Session fermée"),g(!1),m(null),y(null),C.reload({only:["cashRegisters"]})}catch(D){i.error(D.response?.data?.message||"Erreur")}finally{x(!1)}};return e.jsxs(H,{children:[e.jsx(I,{title:"Caisses"}),e.jsxs("div",{className:"container mx-auto py-6 px-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P,{href:route("pharmacy.sales.index"),className:"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:e.jsx(G,{className:"h-5 w-5"})}),e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2 text-gray-900 dark:text-gray-100",children:[e.jsx(O,{className:"h-6 w-6"}),"Caisses"]})]}),e.jsxs(t,{onClick:()=>n(!0),className:"inline-flex items-center gap-2",children:[e.jsx(F,{className:"h-4 w-4"}),"Nouvelle caisse"]})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Ouvrez une session pour enregistrer les ventes sur une caisse. Fermez la session en fin de poste avec le solde réel."}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:p.map(s=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-gray-200 dark:border-slate-700 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:s.code})]}),s.open_session?e.jsx(z,{className:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",children:"Ouverte"}):e.jsx(z,{variant:"secondary",children:"Fermée"})]}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3 line-clamp-2",children:s.description}),s.open_session?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:["Ouverte le ",s.open_session.opened_at," · Solde d'ouverture: ",Number(s.open_session.opening_balance).toLocaleString()]}),e.jsxs(t,{variant:"outline",size:"sm",className:"w-full border-amber-500 text-amber-600 hover:bg-amber-50 dark:hover:bg-amber-900/20",onClick:()=>q(s),children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Fermer la session"]})]}):e.jsxs(t,{size:"sm",className:"w-full bg-green-600 hover:bg-green-700",onClick:()=>L(s),children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Ouvrir une session"]})]},s.id))}),p.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx(O,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Aucune caisse. Créez une caisse pour gérer les sessions."}),e.jsxs(t,{className:"mt-4",onClick:()=>n(!0),children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Nouvelle caisse"]})]})]}),e.jsx(S,{open:h,onClose:()=>n(!1),title:"Nouvelle caisse",children:e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Nom"}),e.jsx(o,{value:l.name,onChange:s=>u(a=>({...a,name:s.target.value})),placeholder:"Ex: Caisse 1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Code"}),e.jsx(o,{value:l.code,onChange:s=>u(a=>({...a,code:s.target.value})),placeholder:"Ex: CAISSE-01",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description (optionnel)"}),e.jsx(o,{value:l.description,onChange:s=>u(a=>({...a,description:s.target.value})),placeholder:"Optionnel"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Fonds de caisse initial (optionnel)"}),e.jsx(o,{type:"number",step:"0.01",min:"0",value:l.initial_balance,onChange:s=>u(a=>({...a,initial_balance:s.target.value}))})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(t,{type:"button",variant:"outline",onClick:()=>n(!1),className:"flex-1",children:"Annuler"}),e.jsx(t,{type:"submit",disabled:N,className:"flex-1",children:"Créer"})]})]})}),e.jsx(S,{open:f,onClose:()=>{c(!1),m(null)},title:"Ouvrir une session",children:d&&e.jsxs("form",{onSubmit:R,className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Caisse: ",e.jsx("strong",{children:d.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Solde d'ouverture"}),e.jsx(o,{type:"number",step:"0.01",min:"0",value:_.opening_balance,onChange:s=>w(a=>({...a,opening_balance:s.target.value}))})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(t,{type:"button",variant:"outline",onClick:()=>c(!1),className:"flex-1",children:"Annuler"}),e.jsx(t,{type:"submit",disabled:N,className:"flex-1",children:"Ouvrir"})]})]})}),e.jsx(S,{open:A,onClose:()=>{g(!1),m(null),y(null)},title:"Fermer la session",children:d&&j&&e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Caisse: ",e.jsx("strong",{children:d.name}),". Saisissez le solde réel en caisse."]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Solde de fermeture (réel) *"}),e.jsx(o,{type:"number",step:"0.01",min:"0",value:b.closing_balance,onChange:s=>v(a=>({...a,closing_balance:s.target.value})),placeholder:"0.00",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Notes (optionnel)"}),e.jsx(o,{value:b.notes,onChange:s=>v(a=>({...a,notes:s.target.value})),placeholder:"Ex: Écart expliqué..."})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(t,{type:"button",variant:"outline",onClick:()=>g(!1),className:"flex-1",children:"Annuler"}),e.jsx(t,{type:"submit",disabled:N,className:"flex-1",children:"Fermer la session"})]})]})})]})}export{le as default};
