import{r as l,u as $,j as e,c as u,a as w}from"./app-DtqU_Gmt.js";import{F as J}from"./FlashMessages-D-g4FpAa.js";import{E as Q,S as W,U as X,K as Y,a as Z,T as ee,C as se}from"./user-cog-BQwjoD4w.js";import"./createLucideIcon-BH-qXF_i.js";function de({users:c,roles:_=[]}){const[te,ae]=l.useState(null),[n,r]=l.useState(null),[m,S]=l.useState(null),[p,C]=l.useState(null),[g,k]=l.useState(null),[h,A]=l.useState(null),[M,i]=l.useState(null),[b,y]=l.useState(""),[j,f]=l.useState(""),[d,N]=l.useState(""),[R,v]=l.useState(""),{auth:E}=$().props,o=E?.permissions??[],x=E?.user?.type==="ROOT",L=x||o.includes("users.assign_role"),O=x||o.includes("users.activate")||o.includes("users.block"),z=x||o.includes("users.reset_password"),P=x||o.includes("users.delete"),D=x||o.includes("users.impersonate"),F=s=>{switch(s){case"ROOT":return"bg-purple-100 text-purple-800";case"TENANT_ADMIN":return"bg-amber-100 text-amber-800";case"MERCHANT":return"bg-blue-100 text-blue-800";case"SELLER":return"bg-cyan-100 text-cyan-800";case"STAFF":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},U=s=>({ROOT:"Administrateur",TENANT_ADMIN:"Admin Tenant",MERCHANT:"Commerçant",SELLER:"Vendeur",STAFF:"Personnel"})[s]||s,I=s=>{const a=s.status||(s.is_active?"active":"pending"),T={active:{label:"Actif",color:"bg-emerald-100 text-emerald-800"},pending:{label:"En attente",color:"bg-yellow-100 text-yellow-800"},blocked:{label:"Bloqué",color:"bg-red-100 text-red-800"},suspended:{label:"Suspendu",color:"bg-orange-100 text-orange-800"}}[a]||{label:a,color:"bg-gray-100 text-gray-800"};return e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${T.color}`,children:T.label})},B=async s=>{if(!b){alert("Veuillez sélectionner un rôle");return}r(s);try{await u.post(route("admin.users.assign-role",s),{role_id:b,tenant_id:null}),w.reload({only:["users"]}),S(null),y("")}catch(a){alert(a.response?.data?.error||"Erreur lors de l'assignation du rôle")}finally{r(null)}},V=async s=>{if(!j){alert("Veuillez sélectionner un statut");return}r(s);try{await u.post(route("admin.users.update-status",s),{status:j}),w.reload({only:["users"]}),C(null),f("")}catch(a){alert(a.response?.data?.error||"Erreur lors de la mise à jour du statut")}finally{r(null)}},q=async s=>{if(!d||d.length<8){alert("Le mot de passe doit contenir au moins 8 caractères");return}if(d!==R){alert("Les mots de passe ne correspondent pas");return}r(s);try{await u.post(route("admin.users.reset-password",s),{password:d,password_confirmation:R}),alert("Mot de passe réinitialisé avec succès"),k(null),N(""),v("")}catch(a){alert(a.response?.data?.error||"Erreur lors de la réinitialisation du mot de passe")}finally{r(null)}},G=async s=>{if(confirm("Êtes-vous sûr de vouloir supprimer cet utilisateur ? Cette action est irréversible.")){r(s);try{await u.delete(route("admin.users.delete",s)),w.reload({only:["users"]}),A(null)}catch(a){alert(a.response?.data?.error||"Erreur lors de la suppression")}finally{r(null)}}},H=async s=>{if(confirm("Vous allez vous connecter comme cet utilisateur. Continuer ?")){r(s);try{await u.post(route("admin.users.impersonate",s)),w.visit(route("dashboard"))}catch(a){alert(a.response?.data?.error||a.response?.data?.message||"Erreur lors de l'impersonation"),r(null)}}},K=c.reduce((s,a)=>{const t=a.tenant?.name||"(Aucun tenant)";return s[t]||(s[t]=[]),s[t].push(a),s},{});return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Gestion des Utilisateurs"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Gérez tous les utilisateurs de la plateforme"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx("a",{href:route("admin.tenants.select.view"),className:"inline-flex items-center px-4 py-2 rounded-lg text-gray-700 bg-gray-100 hover:bg-gray-200 transition",children:"← Retour"})})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6 border border-gray-200",children:[e.jsx("div",{className:"text-sm font-medium text-gray-600",children:"Utilisateurs Total"}),e.jsx("div",{className:"mt-2 text-3xl font-bold text-gray-900",children:c.length})]}),e.jsxs("div",{className:"bg-emerald-50 rounded-lg p-6 border border-emerald-200",children:[e.jsx("div",{className:"text-sm font-medium text-emerald-700",children:"Actifs"}),e.jsx("div",{className:"mt-2 text-3xl font-bold text-emerald-900",children:c.filter(s=>s.is_active).length})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-6 border border-red-200",children:[e.jsx("div",{className:"text-sm font-medium text-red-700",children:"Inactifs"}),e.jsx("div",{className:"mt-2 text-3xl font-bold text-red-900",children:c.filter(s=>!s.is_active).length})]})]}),Object.entries(K).map(([s,a])=>e.jsxs("div",{className:"mb-8",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:[s,e.jsxs("span",{className:"ml-2 text-sm font-normal text-gray-500",children:["(",a.length,")"]})]}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 border-b border-gray-200",children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Nom"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Rôle"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Statut"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Inscrit"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:a.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[t.first_name," ",t.last_name]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-600",children:t.email})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${F(t.type)}`,children:U(t.type)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:I(t)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:new Date(t.created_at).toLocaleDateString("fr-FR")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.type==="ROOT"?e.jsx("span",{className:"text-xs text-gray-500 italic",children:"Administrateur"}):e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:"p-1 rounded hover:bg-gray-100 transition",onClick:()=>{i(M===t.id?null:t.id)},children:e.jsx(Q,{className:"h-4 w-4 text-gray-600"})}),M===t.id&&e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-10",children:[L&&e.jsxs("button",{onClick:()=>{S(t.id),y(""),i(null)},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),"Assigner rôle"]}),O&&e.jsxs("button",{onClick:()=>{C(t.id),f(t.status||"active"),i(null)},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),"Changer statut"]}),z&&e.jsxs("button",{onClick:()=>{k(t.id),N(""),v(""),i(null)},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),"Réinitialiser mot de passe"]}),D&&e.jsxs("button",{onClick:()=>{i(null),H(t.id)},disabled:n===t.id,className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2 disabled:opacity-50",children:[e.jsx(Z,{className:"h-4 w-4"}),"Impersonner"]}),P&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-t border-gray-200 my-1"}),e.jsxs("button",{onClick:()=>{A(t.id),i(null)},className:"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4"}),"Supprimer"]})]})]})]})})})]},t.id))})]})})]},s)),c.length===0&&e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 px-6 py-12 text-center",children:e.jsx("p",{className:"text-gray-500",children:"Aucun utilisateur trouvé"})})]}),m&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Assigner un rôle"}),e.jsxs("select",{value:b,onChange:s=>y(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg mb-4",children:[e.jsx("option",{value:"",children:"Sélectionner un rôle"}),_.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>{S(null),y("")},className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200",children:"Annuler"}),e.jsx("button",{onClick:()=>B(m),disabled:!b||n===m,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:n===m?"Chargement...":"Assigner"})]})]})}),p&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Changer le statut"}),e.jsxs("select",{value:j,onChange:s=>f(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg mb-4",children:[e.jsx("option",{value:"pending",children:"En attente"}),e.jsx("option",{value:"active",children:"Actif"}),e.jsx("option",{value:"blocked",children:"Bloqué"}),e.jsx("option",{value:"suspended",children:"Suspendu"})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>{C(null),f("")},className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200",children:"Annuler"}),e.jsx("button",{onClick:()=>V(p),disabled:!j||n===p,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:n===p?"Chargement...":"Mettre à jour"})]})]})}),g&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Réinitialiser le mot de passe"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nouveau mot de passe"}),e.jsx("input",{type:"password",value:d,onChange:s=>N(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Minimum 8 caractères"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirmer le mot de passe"}),e.jsx("input",{type:"password",value:R,onChange:s=>v(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Confirmer le mot de passe"})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end mt-6",children:[e.jsx("button",{onClick:()=>{k(null),N(""),v("")},className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200",children:"Annuler"}),e.jsx("button",{onClick:()=>q(g),disabled:!d||n===g,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:n===g?"Chargement...":"Réinitialiser"})]})]})}),h&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(se,{className:"h-6 w-6 text-red-600"}),e.jsx("h3",{className:"text-lg font-bold",children:"Supprimer l'utilisateur"})]}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Êtes-vous sûr de vouloir supprimer cet utilisateur ? Cette action est irréversible."}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>A(null),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200",children:"Annuler"}),e.jsx("button",{onClick:()=>G(h),disabled:n===h,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50",children:n===h?"Suppression...":"Supprimer"})]})]})}),e.jsx(J,{})]})}export{de as default};
