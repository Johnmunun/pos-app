import{u as ie,r as l,j as e,H as de,L as ce,z as d,c as D,a as oe}from"./app-3PKVeuQh.js";import{A as xe,h as me,G as ue,b as S,P as L,v as ge,d as he,w as be,x as ye,k as pe,R as fe,y as je}from"./AppLayout-DSrKCpOy.js";import{B as u}from"./Button-RC9FN5z3.js";import{I as W}from"./Input-5gvkn2nv.js";import{B as M}from"./badge-Ca6uIRAr.js";import{f as ke}from"./currency-C0RJmSMb.js";import{A as Ne}from"./arrow-left-CvJq81LS.js";import{T as ve}from"./user-cog-nVqfHm0b.js";import{X as we,b as _e,c as Ce}from"./x-YL0zAneP.js";import"./createLucideIcon-CyiEew_u.js";import"./shield-x-gOy17OJ-.js";import"./Dropdown-B_QkibTR.js";import"./transition-CufTvwOt.js";import"./loader-circle-D2tkCN5O.js";import"./refresh-cw-L3GUbwVE.js";import"./FlashMessages-bPB7K-Ql.js";function Ve({products:E=[],categories:Y=[],customers:Z=[]}){const{shop:Q}=ie().props,y=Q?.currency||"CDF",n=s=>ke(s,y),[P,B]=l.useState("thumbnails"),[p,ee]=l.useState(""),[g,F]=l.useState(null),[f,q]=l.useState(""),[a,x]=l.useState([]),[j,R]=l.useState(""),[h,k]=l.useState(!1),[b,H]=l.useState([]),[I,A]=l.useState(z()),[se,N]=l.useState(!1),[T,te]=l.useState("cash"),[o,v]=l.useState({type:"percent",value:0}),[w,Se]=l.useState(0);function z(){return"A01-"+String(Math.floor(Math.random()*9e8)+1e8).padStart(10,"0")}const $=l.useMemo(()=>{let s=E;if(g&&(s=s.filter(t=>t.category_id===g)),p.trim()){const t=p.toLowerCase();s=s.filter(r=>(r.name||"").toLowerCase().includes(t)||(r.code||"").toLowerCase().includes(t))}return s},[E,p,g]),V=s=>{if((s.stock||0)<1){d.error("Stock insuffisant");return}const t=a.find(r=>r.product_id===s.id);if(t){if(t.quantity>=s.stock){d.error("Stock insuffisant");return}x(a.map(r=>r.product_id===s.id?{...r,quantity:r.quantity+1}:r))}else x([...a,{product_id:s.id,name:s.name,code:s.code,price:s.price_amount,currency:s.price_currency||y,quantity:1,max_stock:s.stock,discount_percent:0,image_url:s.image_url}])},G=(s,t)=>{if(t<1){X(s);return}const r=a.find(c=>c.product_id===s);if(r&&t>r.max_stock){d.error("Stock insuffisant");return}x(a.map(c=>c.product_id===s?{...c,quantity:t}:c))},X=s=>{x(a.filter(t=>t.product_id!==s))},J=()=>{x([]),v({type:"percent",value:0}),A(z())},m=l.useMemo(()=>a.reduce((s,t)=>{const r=t.price*t.quantity,c=t.discount_percent?r*t.discount_percent/100:0;return s+(r-c)},0),[a]),O=l.useMemo(()=>m*w/100,[m,w]),_=l.useMemo(()=>o.type==="percent"?m*o.value/100:o.value,[m,o]),i=l.useMemo(()=>Math.max(0,m+O-_),[m,O,_]),C=Number(j)||0,K=Math.max(0,i-C),U=C>i?C-i:0,ae=()=>{if(a.length===0){d.error("Panier vide");return}H([...b,{orderNumber:I,cart:[...a],customerId:f,discount:o,timestamp:new Date}]),x([]),q(""),v({type:"percent",value:0}),A(z()),d.success("Commande mise en attente")},re=s=>{const t=b[s];x(t.cart),q(t.customerId),v(t.discount),A(t.orderNumber),H(b.filter((r,c)=>c!==s))},le=async()=>{if(a.length===0){d.error("Panier vide. Ajoutez au moins un produit.");return}k(!0);try{const t=(await D.post(route("pharmacy.sales.store"),{customer_id:f||null,currency:a[0]?.currency||y,lines:a.map(r=>({product_id:r.product_id,quantity:r.quantity,unit_price:r.price,discount_percent:r.discount_percent||null}))})).data.sale.id;await D.post(route("pharmacy.sales.finalize",t),{paid_amount:j||i}),d.success("Vente finalisée avec succès!"),N(!1),J(),R("")}catch(s){d.error(s.response?.data?.message||"Erreur lors de la vente")}finally{k(!1)}},ne=async()=>{if(a.length===0){d.error("Panier vide");return}k(!0);try{const s=await D.post(route("pharmacy.sales.store"),{customer_id:f||null,currency:a[0]?.currency||y,lines:a.map(t=>({product_id:t.product_id,quantity:t.quantity,unit_price:t.price,discount_percent:t.discount_percent||null}))});d.success("Brouillon enregistré"),oe.visit(route("pharmacy.sales.show",s.data.sale.id))}catch(s){d.error(s.response?.data?.message||"Erreur")}finally{k(!1)}};return e.jsxs(xe,{children:[e.jsx(de,{title:"Point de Vente"}),e.jsxs("div",{className:"h-[calc(100vh-64px)] flex",children:[e.jsxs("div",{className:"flex-1 flex flex-col bg-gray-50 dark:bg-slate-950",children:[e.jsx("div",{className:"p-4 bg-white dark:bg-slate-900 border-b border-gray-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(u,{variant:"ghost",size:"sm",asChild:!0,className:"text-gray-600 dark:text-gray-300",children:e.jsxs(ce,{href:route("pharmacy.sales.index"),children:[e.jsx(Ne,{className:"h-4 w-4 mr-1"}),"Retour"]})}),e.jsxs("div",{className:"flex items-center bg-gray-100 dark:bg-slate-800 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>B("list"),className:`px-3 py-1.5 rounded text-sm font-medium transition-colors ${P==="list"?"bg-white dark:bg-slate-700 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400"}`,children:"List Item"}),e.jsx("button",{onClick:()=>B("thumbnails"),className:`px-3 py-1.5 rounded text-sm font-medium transition-colors ${P==="thumbnails"?"bg-white dark:bg-slate-700 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400"}`,children:"Thumbnails"})]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(me,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(W,{type:"text",placeholder:"Search Here",value:p,onChange:s=>ee(s.target.value),className:"pl-10 bg-gray-100 dark:bg-slate-800 border-0"})]}),e.jsx(u,{variant:"outline",size:"icon",className:"bg-blue-500 hover:bg-blue-600 text-white border-0",children:e.jsx(ue,{className:"h-4 w-4"})})]})}),e.jsx("div",{className:"p-3 bg-white dark:bg-slate-900 border-b border-gray-200 dark:border-slate-700 overflow-x-auto",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>F(null),className:`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors ${g?"bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-slate-700":"bg-amber-500 text-white"}`,children:"Tous"}),Y.map(s=>e.jsx("button",{onClick:()=>F(s.id),className:`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors ${g===s.id?"bg-amber-500 text-white":"bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-slate-700"}`,children:s.name},s.id))]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[P==="thumbnails"?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:$.map(s=>e.jsxs("button",{onClick:()=>V(s),disabled:s.stock<1,className:`bg-white dark:bg-slate-800 rounded-xl p-3 text-center shadow-sm hover:shadow-md transition-all border border-gray-200 dark:border-slate-700 ${s.stock<1?"opacity-50 cursor-not-allowed":"hover:border-amber-300 dark:hover:border-amber-500"}`,children:[e.jsxs("div",{className:"aspect-square mb-2 rounded-lg bg-gray-100 dark:bg-slate-700 overflow-hidden flex items-center justify-center",children:[s.image_url?e.jsx("img",{src:s.image_url,alt:s.name,className:"w-full h-full object-cover",onError:t=>{t.target.style.display="none",t.target.nextSibling.style.display="flex"}}):null,e.jsx("div",{className:`flex items-center justify-center ${s.image_url?"hidden":""}`,children:e.jsx(S,{className:"h-10 w-10 text-gray-400"})})]}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white line-clamp-2 mb-1",children:s.name}),e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400 font-semibold",children:n(s.price_amount)}),s.stock<5&&s.stock>0&&e.jsxs(M,{variant:"outline",className:"mt-1 text-xs text-orange-600 border-orange-300",children:["Stock: ",s.stock]}),s.stock<1&&e.jsx(M,{variant:"destructive",className:"mt-1 text-xs",children:"Rupture"})]},s.id))}):e.jsx("div",{className:"space-y-2",children:$.map(s=>e.jsxs("button",{onClick:()=>V(s),disabled:s.stock<1,className:`w-full flex items-center gap-4 bg-white dark:bg-slate-800 rounded-lg p-3 shadow-sm hover:shadow-md transition-all border border-gray-200 dark:border-slate-700 ${s.stock<1?"opacity-50 cursor-not-allowed":"hover:border-amber-300 dark:hover:border-amber-500"}`,children:[e.jsx("div",{className:"w-16 h-16 rounded-lg bg-gray-100 dark:bg-slate-700 overflow-hidden flex items-center justify-center flex-shrink-0",children:s.image_url?e.jsx("img",{src:s.image_url,alt:s.name,className:"w-full h-full object-cover"}):e.jsx(S,{className:"h-8 w-8 text-gray-400"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:s.code})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-amber-600 dark:text-amber-400",children:n(s.price_amount)}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Stock: ",s.stock]})]}),e.jsx(L,{className:"h-5 w-5 text-amber-500"})]},s.id))}),$.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx(S,{className:"h-16 w-16 mb-4 opacity-50"}),e.jsx("p",{children:"Aucun produit trouvé"})]})]})]}),e.jsxs("div",{className:"w-96 bg-white dark:bg-slate-900 border-l border-gray-200 dark:border-slate-700 flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs(u,{variant:"outline",size:"sm",onClick:ae,disabled:a.length===0,className:"text-gray-600 dark:text-gray-300",children:[e.jsx(ge,{className:"h-4 w-4 mr-1"}),"Hold"]}),e.jsx(M,{className:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300 px-3 py-1",children:I}),e.jsxs(u,{variant:"outline",size:"sm",onClick:J,className:"text-amber-600 border-amber-300 hover:bg-amber-50 dark:hover:bg-amber-900/20",children:[e.jsx(L,{className:"h-4 w-4 mr-1"}),"New"]})]}),b.length>0&&e.jsx("div",{className:"flex gap-2 overflow-x-auto py-2",children:b.map((s,t)=>e.jsxs("button",{onClick:()=>re(t),className:"flex-shrink-0 px-3 py-1.5 bg-orange-100 dark:bg-orange-900/30 text-orange-800 dark:text-orange-300 rounded-full text-xs font-medium hover:bg-orange-200 dark:hover:bg-orange-900/50 transition-colors",children:[s.orderNumber.slice(-6)," (",s.cart.length,")"]},t))})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:a.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[e.jsx(he,{className:"h-16 w-16 mb-4 opacity-50"}),e.jsx("p",{children:"Panier vide"}),e.jsx("p",{className:"text-sm",children:"Ajoutez des produits"})]}):e.jsx("div",{className:"space-y-3",children:a.map((s,t)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 dark:bg-slate-800 rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gray-200 dark:bg-slate-700 overflow-hidden flex-shrink-0",children:s.image_url?e.jsx("img",{src:s.image_url,alt:s.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(S,{className:"h-6 w-6 text-gray-400"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white text-sm truncate",children:s.name}),s.discount_percent>0&&e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400",children:["-",s.discount_percent,"% Discount"]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("button",{onClick:()=>G(s.product_id,s.quantity-1),className:"w-6 h-6 rounded-full bg-gray-200 dark:bg-slate-700 flex items-center justify-center hover:bg-gray-300 dark:hover:bg-slate-600 transition-colors",children:e.jsx(be,{className:"h-3 w-3"})}),e.jsx("span",{className:"w-8 text-center font-medium text-sm",children:s.quantity}),e.jsx("button",{onClick:()=>G(s.product_id,s.quantity+1),className:"w-6 h-6 rounded-full bg-gray-200 dark:bg-slate-700 flex items-center justify-center hover:bg-gray-300 dark:hover:bg-slate-600 transition-colors",children:e.jsx(L,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:n(s.price*s.quantity)}),e.jsx("button",{onClick:()=>X(s.product_id),className:"text-red-500 hover:text-red-600 mt-1",children:e.jsx(ve,{className:"h-4 w-4"})})]})]},s.product_id))})}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-slate-700 p-4 space-y-3",children:[e.jsxs("button",{className:"w-full flex items-center justify-between py-2 text-sm text-blue-600 dark:text-blue-400 hover:underline",onClick:()=>{const s=prompt("Remise (%) ?",String(o.value));s!==null&&v({type:"percent",value:parseFloat(s)||0})},children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4"}),"Add Order Discount"]}),o.value>0&&e.jsxs(M,{className:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",children:[o.value,"%"]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{children:["Sous-total ",e.jsxs("span",{className:"text-xs",children:["(",a.length," articles)"]})]}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:n(m)})]}),w>0&&e.jsxs("div",{className:"flex justify-between text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{className:"text-blue-600 dark:text-blue-400",children:["Taxe (",w,"% TVA incluse)"]}),e.jsx("span",{children:n(O)})]}),_>0&&e.jsxs("div",{className:"flex justify-between text-green-600 dark:text-green-400",children:[e.jsx("span",{children:"Remise"}),e.jsxs("span",{children:["-",n(_)]})]})]}),e.jsxs("button",{className:"w-full flex items-center justify-between py-2 text-sm text-gray-700 dark:text-gray-300 border-t border-gray-200 dark:border-slate-700",onClick:()=>N(!0),children:[e.jsx("span",{children:"Select payment mode"}),e.jsx(pe,{className:"h-4 w-4"})]}),e.jsx("div",{className:"bg-blue-500 dark:bg-blue-600 rounded-xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-lg font-medium",children:"Total"}),e.jsx("span",{className:"text-2xl font-bold",children:n(i)})]})}),e.jsxs(u,{onClick:()=>N(!0),disabled:a.length===0||h,className:"w-full bg-amber-500 hover:bg-amber-600 text-white py-6 text-lg font-semibold",children:[e.jsx(fe,{className:"h-5 w-5 mr-2"}),h?"Traitement...":"Finaliser la vente"]})]})]})]}),se&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-2xl w-full max-w-md mx-4 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-slate-700 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Mode de paiement"}),e.jsx("button",{onClick:()=>N(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200",children:e.jsx(we,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{id:"cash",icon:je,label:"Espèces"},{id:"card",icon:_e,label:"Carte"},{id:"mobile",icon:Ce,label:"Mobile"}].map(s=>e.jsxs("button",{onClick:()=>te(s.id),className:`p-4 rounded-xl border-2 flex flex-col items-center gap-2 transition-all ${T===s.id?"border-amber-500 bg-amber-50 dark:bg-amber-900/20":"border-gray-200 dark:border-slate-700 hover:border-gray-300 dark:hover:border-slate-600"}`,children:[e.jsx(s.icon,{className:`h-6 w-6 ${T===s.id?"text-amber-500":"text-gray-400"}`}),e.jsx("span",{className:`text-sm font-medium ${T===s.id?"text-amber-600 dark:text-amber-400":"text-gray-600 dark:text-gray-400"}`,children:s.label})]},s.id))}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Montant reçu"}),e.jsx(W,{type:"number",step:"0.01",min:0,value:j,onChange:s=>R(s.target.value),placeholder:i.toFixed(2),className:"text-2xl h-14 text-center font-semibold"})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[i,Math.ceil(i/10)*10,Math.ceil(i/50)*50,Math.ceil(i/100)*100].map((s,t)=>e.jsx("button",{onClick:()=>R(String(s)),className:"py-2 px-3 bg-gray-100 dark:bg-slate-800 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-slate-700",children:n(s)},t))}),e.jsxs("div",{className:"bg-gray-50 dark:bg-slate-800 rounded-xl p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Total"}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:n(i)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Reçu"}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:n(Number(j)||0)})]}),U>0&&e.jsxs("div",{className:"flex justify-between text-sm border-t border-gray-200 dark:border-slate-700 pt-2 mt-2",children:[e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Monnaie à rendre"}),e.jsx("span",{className:"font-bold text-green-600 dark:text-green-400",children:n(U)})]}),K>0&&C>0&&e.jsxs("div",{className:"flex justify-between text-sm border-t border-gray-200 dark:border-slate-700 pt-2 mt-2",children:[e.jsx("span",{className:"text-orange-600 dark:text-orange-400",children:"Reste à payer"}),e.jsx("span",{className:"font-bold text-orange-600 dark:text-orange-400",children:n(K)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Client (optionnel)"}),e.jsxs("select",{className:"w-full rounded-lg border-gray-300 dark:border-slate-600 dark:bg-slate-800 dark:text-white",value:f,onChange:s=>q(s.target.value),children:[e.jsx("option",{value:"",children:"Sans client"}),Z.map(s=>e.jsx("option",{value:s.id,children:s.full_name},s.id))]})]})]}),e.jsxs("div",{className:"p-6 bg-gray-50 dark:bg-slate-800 flex gap-3",children:[e.jsx(u,{variant:"outline",onClick:ne,disabled:h,className:"flex-1",children:"Enregistrer brouillon"}),e.jsx(u,{onClick:le,disabled:h||a.length===0,className:"flex-1 bg-amber-500 hover:bg-amber-600 text-white",children:h?"Traitement...":"Valider la vente"})]})]})})]})}export{Ve as default};
