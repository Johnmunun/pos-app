import{b as B,r as N,j as e,n as t,H as E,a as b}from"./app-BGTsh8B3.js";import{u as V,A,m as D,T as P,c as q,P as L}from"./AppLayout-B9W2Qjn-.js";import{C as z,a as T,b as R,c as F}from"./card-DzyZZsrB.js";import{B as m}from"./Button-Cm51LcKk.js";import{I as _}from"./Input-LVtkliO7.js";import{B as C}from"./badge-vyxm7s9H.js";import{D as M}from"./Drawer-D_RvWb8n.js";import{L as w}from"./Label-CEns7YJb.js";import{T as Q}from"./textarea-Dc6vmaOE.js";import{X as $}from"./x-Bqi0sytM.js";import{T as U}from"./user-cog-CgPvrrVM.js";import{R as X}from"./refresh-cw-CA0aJ90x.js";import"./createLucideIcon-B4miffV9.js";import"./shield-x-DRqpxde8.js";import"./Dropdown-DbeWMHj2.js";import"./transition-JR3jNvu7.js";import"./arrow-left-BMPE_XAu.js";import"./loader-circle-CIdMfzjo.js";import"./FlashMessages-o0prhkl9.js";function G({isOpen:d,onClose:l,category:r=null,categories:n=[],canCreate:j=!0,canUpdate:u=!0}){const p=!!r,{data:g,setData:c,post:y,put:f,processing:o,errors:i,reset:x}=B({name:r?.name||"",description:r?.description||"",parent_id:r?.parent_id||"",sort_order:r?.sort_order??0});N.useEffect(()=>{r?c({name:r.name||"",description:r.description||"",parent_id:r.parent_id||"",sort_order:r.sort_order??0}):x()},[r]);const v=async a=>{if(a.preventDefault(),p&&!u){t.error("Vous n'avez pas la permission de modifier une catégorie");return}if(!p&&!j){t.error("Vous n'avez pas la permission de créer une catégorie");return}try{p?await f(route("hardware.categories.update",r.id),{preserveScroll:!0,onSuccess:()=>{t.success("Catégorie mise à jour"),l(),x()},onError:h=>h.message&&t.error(h.message)}):await y(route("hardware.categories.store"),{preserveScroll:!0,onSuccess:()=>{t.success("Catégorie créée"),l(),x()},onError:h=>h.message&&t.error(h.message)})}catch{t.error("Erreur lors de la soumission")}},k=n.filter(a=>!r||a.id!==r.id);return e.jsx(M,{isOpen:d,onClose:()=>{x(),l()},title:p?"Modifier la catégorie":"Ajouter une catégorie",children:e.jsxs("form",{onSubmit:v,className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4",children:[e.jsxs("div",{children:[e.jsxs(w,{htmlFor:"name",children:["Nom ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(_,{id:"name",value:g.name,onChange:a=>c("name",a.target.value),className:"mt-1",placeholder:"Ex: Outils électriques",required:!0,disabled:o}),i.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:i.name})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"description",children:"Description"}),e.jsx(Q,{id:"description",value:g.description,onChange:a=>c("description",a.target.value),className:"mt-1",placeholder:"Description de la catégorie (optionnel)",rows:3,disabled:o}),i.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:i.description})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"parent_id",children:"Catégorie parente"}),e.jsxs("select",{id:"parent_id",value:g.parent_id,onChange:a=>c("parent_id",a.target.value||""),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-amber-500 focus:ring-amber-500 dark:bg-gray-700 dark:text-white sm:text-sm",disabled:o,children:[e.jsx("option",{value:"",children:"Aucune (catégorie principale)"}),k.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),i.parent_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:i.parent_id})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"sort_order",children:"Ordre d'affichage"}),e.jsx(_,{id:"sort_order",type:"number",value:g.sort_order,onChange:a=>c("sort_order",parseInt(a.target.value)||0),className:"mt-1",placeholder:"0",min:0,disabled:o}),i.sort_order&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:i.sort_order})]})]}),e.jsxs("div",{className:"mt-6 flex gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs(m,{type:"button",variant:"outline",onClick:l,disabled:o,children:[e.jsx($,{className:"h-4 w-4 mr-2"})," Annuler"]}),e.jsxs(m,{type:"submit",className:"bg-amber-500 dark:bg-amber-600 text-white hover:bg-amber-600 dark:hover:bg-amber-700",disabled:o,children:[e.jsx(V,{className:"h-4 w-4 mr-2"})," ",o?"Enregistrement...":p?"Enregistrer":"Créer"]})]})]})})}function J({pagination:d,filters:l}){if(!d||d.last_page<=1)return null;const{current_page:r,last_page:n}=d,j=u=>{b.get(route("hardware.categories.index"),{...l,page:u},{preserveState:!0,preserveScroll:!0})};return e.jsxs("div",{className:"flex items-center justify-between px-6 py-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Page ",r," / ",n]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{variant:"outline",size:"sm",disabled:r<=1,onClick:()=>j(r-1),children:"Précédent"}),e.jsx(m,{variant:"outline",size:"sm",disabled:r>=n,onClick:()=>j(r+1),children:"Suivant"})]})]})}function pe({categories:d=[],pagination:l,filters:r={},permissions:n={},routePrefix:j="hardware"}){const[u,p]=N.useState(r?.search||""),[g,c]=N.useState(!1),[y,f]=N.useState(null),o=n?.view!==!1,i=n?.create!==!1,x=n?.update!==!1,v=n?.delete!==!1;if(!o)return e.jsxs(A,{children:[e.jsx(E,{title:"Accès refusé"}),e.jsx("div",{className:"py-12 text-center",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Vous n'avez pas la permission de voir les catégories."})})]});const k=s=>{s.preventDefault(),b.get(route("hardware.categories.index"),{search:u})},a=()=>{if(!i)return t.error("Permission refusée");f(null),c(!0)},h=s=>{if(!x)return t.error("Permission refusée");f(s),c(!0)},H=s=>{if(!v)return t.error("Permission refusée");t.custom(S=>e.jsxs("div",{className:"max-w-md w-full bg-white dark:bg-gray-800 shadow-lg rounded-lg p-4 flex flex-col gap-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Supprimer la catégorie"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:['Êtes-vous sûr de vouloir supprimer "',s.name,'" ? Cette action est irréversible.']}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{t.dismiss(S.id),b.delete(route("hardware.categories.destroy",s.id),{preserveScroll:!0,onSuccess:()=>t.success("Catégorie supprimée"),onError:O=>t.error(O?.message||"Erreur")})},className:"flex-1 bg-red-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-red-700",children:"Supprimer"}),e.jsx("button",{onClick:()=>t.dismiss(S.id),className:"flex-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-md text-sm font-medium",children:"Annuler"})]})]}),{duration:1/0})},I=()=>b.reload();return e.jsxs(A,{header:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"font-semibold text-xl text-gray-800 dark:text-white leading-tight",children:"Catégories — Quincaillerie"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{variant:"outline",size:"sm",onClick:I,children:[e.jsx(X,{className:"h-4 w-4 mr-2"})," Actualiser"]}),i&&e.jsxs(m,{onClick:a,className:"bg-amber-500 hover:bg-amber-600 text-white",children:[e.jsx(L,{className:"h-4 w-4 mr-2"})," Ajouter une catégorie"]})]})]}),children:[e.jsx(E,{title:"Catégories - Quincaillerie"}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[e.jsxs(z,{className:"mb-6 bg-white dark:bg-gray-800 shadow-md dark:shadow-lg dark:shadow-gray-900/50",children:[e.jsx(T,{children:e.jsxs(R,{className:"flex items-center text-gray-900 dark:text-white",children:[e.jsx(D,{className:"h-5 w-5 mr-2"})," Rechercher"]})}),e.jsx(F,{children:e.jsxs("form",{onSubmit:k,className:"flex flex-col sm:flex-row gap-4",children:[e.jsx(_,{placeholder:"Rechercher par nom ou description...",value:u,onChange:s=>p(s.target.value),className:"flex-1"}),e.jsxs(m,{type:"submit",children:[e.jsx(D,{className:"h-4 w-4 mr-2"})," Rechercher"]})]})})]}),e.jsxs(z,{className:"bg-white dark:bg-gray-800 shadow-md dark:shadow-lg dark:shadow-gray-900/50",children:[e.jsx(T,{children:e.jsxs(R,{className:"text-gray-900 dark:text-white",children:["Catégories ",l?`(${l.total})`:`(${d.length})`]})}),e.jsx(F,{className:"p-0",children:d.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(P,{className:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-white",children:"Aucune catégorie"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:u?"Aucun résultat.":"Créez une catégorie pour commencer."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Nom"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Produits"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Statut"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:d.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(P,{className:"h-5 w-5 text-amber-600 dark:text-amber-400 mr-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:s.name}),s.parent&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Sous-catégorie de: ",s.parent.name]})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 max-w-xs truncate",children:s.description||"—"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(C,{variant:"outline",children:s.products_count??0})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.is_active?e.jsx(C,{variant:"success",children:"Active"}):e.jsx(C,{variant:"destructive",children:"Inactive"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[x&&e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>h(s),title:"Modifier",children:e.jsx(q,{className:"h-5 w-5"})}),v&&e.jsx(m,{variant:"ghost",size:"sm",className:"text-red-600 hover:text-red-700",onClick:()=>H(s),title:"Supprimer",children:e.jsx(U,{className:"h-5 w-5"})})]})})]},s.id))})]})}),e.jsx(J,{pagination:l,filters:r})]})})]})]})}),e.jsx(G,{isOpen:g,onClose:()=>{c(!1),f(null)},category:y,categories:d,canCreate:i,canUpdate:x})]})}export{pe as default};
