import{u as H,r as n,j as e,H as Q,L as k,n as d,c as D,a as F}from"./app-B8F_Smya.js";import{A as $,B as u,b as _,m as G,t as J}from"./AppLayout-Cyrikcek.js";import{C as m,a as h,b as p,c as g}from"./card-DwWU2KFG.js";import{B as o}from"./Button-BSACjJaD.js";import{I as S}from"./Input-DyZz_-qK.js";import{L as C}from"./Label-Dhk_jhe5.js";import{B as L}from"./badge-CezgjasG.js";import{A as K,L as O}from"./loader-circle-5vrT9r4x.js";import{C as U,T as V}from"./user-cog-Cgo5DVwg.js";import{A as W}from"./arrow-left-uFeYT1yE.js";import"./createLucideIcon-NKf32Z79.js";import"./shield-x-CXAQmM6w.js";import"./x-Ce9nIuKt.js";import"./Dropdown-CXpnj_1U.js";import"./transition-L_iZ831R.js";import"./refresh-cw-BeeT9s1l.js";import"./FlashMessages-CHIUDfR7.js";function pe({shops:j,products:T,currentShopId:q}){const{auth:X}=H().props,[f,b]=n.useState(!1),[l,A]=n.useState(q||""),[i,I]=n.useState(""),[y,z]=n.useState(""),[s,x]=n.useState([]),[c,N]=n.useState(""),v=T.filter(t=>t.name.toLowerCase().includes(c.toLowerCase())||t.code&&t.code.toLowerCase().includes(c.toLowerCase())),B=t=>{if(s.find(a=>a.product_id===t.id)){d.error("Ce produit est déjà dans le transfert");return}x([...s,{product_id:t.id,product_name:t.name,product_code:t.code,current_stock:t.stock,quantity:1}]),N("")},E=(t,a)=>{x(s.map(r=>r.product_id===t?{...r,quantity:Math.max(1,parseInt(a)||1)}:r))},R=t=>{x(s.filter(a=>a.product_id!==t))},P=s.reduce((t,a)=>t+a.quantity,0),M=async t=>{if(t.preventDefault(),!l){d.error("Sélectionnez le magasin source");return}if(!i){d.error("Sélectionnez le magasin destination");return}if(l===i){d.error("Les magasins source et destination doivent être différents");return}if(s.length===0){d.error("Ajoutez au moins un produit");return}const a=s.filter(r=>r.quantity>r.current_stock);if(a.length>0){d.error(`Stock insuffisant pour: ${a.map(r=>r.product_name).join(", ")}`);return}b(!0);try{const r=await D.post(route("pharmacy.transfers.store"),{from_shop_id:l,to_shop_id:i,notes:y,items:s.map(w=>({product_id:w.product_id,quantity:w.quantity}))});r.data.success?(d.success("Transfert créé avec succès"),F.visit(route("pharmacy.transfers.show",r.data.transfer_id))):d.error(r.data.message||"Erreur lors de la création")}catch(r){console.error(r),d.error(r.response?.data?.message||"Erreur lors de la création du transfert")}finally{b(!1)}};return e.jsxs($,{header:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"font-semibold text-xl text-gray-800 dark:text-white leading-tight",children:"Nouveau Transfert"}),e.jsx(k,{href:route("pharmacy.transfers.index"),children:e.jsxs(o,{variant:"outline",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Retour"]})})]}),children:[e.jsx(Q,{title:"Nouveau Transfert"}),e.jsx("div",{className:"py-6",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("form",{onSubmit:M,className:"space-y-6",children:[e.jsxs(m,{className:"bg-white dark:bg-slate-800",children:[e.jsx(h,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(u,{className:"h-5 w-5 text-blue-600"}),"Magasins"]})}),e.jsx(g,{children:e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 items-end",children:[e.jsxs("div",{children:[e.jsxs(C,{className:"text-red-600 flex items-center gap-2 mb-2",children:[e.jsx(u,{className:"h-4 w-4"}),"Magasin Source (Expéditeur)"]}),e.jsxs("select",{value:l,onChange:t=>A(t.target.value),className:"w-full h-10 rounded-md border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-gray-900 dark:text-white px-3",required:!0,children:[e.jsx("option",{value:"",children:"Sélectionner..."}),j.map(t=>e.jsxs("option",{value:t.id,disabled:t.id.toString()===i,children:[t.name," (",t.code,")"]},t.id))]})]}),e.jsx("div",{className:"hidden md:flex justify-center",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-100 dark:bg-blue-900/50 flex items-center justify-center",children:e.jsx(K,{className:"h-5 w-5 text-blue-600"})})}),e.jsxs("div",{children:[e.jsxs(C,{className:"text-green-600 flex items-center gap-2 mb-2",children:[e.jsx(u,{className:"h-4 w-4"}),"Magasin Destination (Récepteur)"]}),e.jsxs("select",{value:i,onChange:t=>I(t.target.value),className:"w-full h-10 rounded-md border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-gray-900 dark:text-white px-3",required:!0,children:[e.jsx("option",{value:"",children:"Sélectionner..."}),j.map(t=>e.jsxs("option",{value:t.id,disabled:t.id.toString()===l,children:[t.name," (",t.code,")"]},t.id))]})]})]})})]}),e.jsxs(m,{className:"bg-white dark:bg-slate-800",children:[e.jsx(h,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5 text-blue-600"}),"Produits à transférer"]})}),e.jsxs(g,{children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx(G,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(S,{type:"text",placeholder:"Rechercher un produit par nom ou code...",value:c,onChange:t=>N(t.target.value),className:"pl-10"}),c&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-600 rounded-md shadow-lg max-h-60 overflow-y-auto",children:v.length===0?e.jsx("div",{className:"p-3 text-center text-gray-500",children:"Aucun produit trouvé"}):v.slice(0,10).map(t=>e.jsx("div",{onClick:()=>B(t),className:"p-3 hover:bg-gray-50 dark:hover:bg-slate-700 cursor-pointer border-b border-gray-100 dark:border-slate-700 last:border-0",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t.name}),t.code&&e.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["(",t.code,")"]})]}),e.jsxs(L,{variant:t.stock>0?"default":"destructive",children:["Stock: ",t.stock]})]})},t.id))})]}),s.length===0?e.jsxs("div",{className:"text-center py-12 border-2 border-dashed border-gray-200 dark:border-slate-700 rounded-lg",children:[e.jsx(_,{className:"h-12 w-12 mx-auto text-gray-300 dark:text-gray-600 mb-3"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Recherchez et ajoutez des produits à transférer"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-slate-700",children:[e.jsx("th",{className:"text-left py-3 px-4 text-xs font-medium text-gray-500 uppercase",children:"Produit"}),e.jsx("th",{className:"text-center py-3 px-4 text-xs font-medium text-gray-500 uppercase",children:"Stock actuel"}),e.jsx("th",{className:"text-center py-3 px-4 text-xs font-medium text-gray-500 uppercase",children:"Quantité"}),e.jsx("th",{className:"text-center py-3 px-4 text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-slate-700",children:s.map(t=>e.jsxs("tr",{children:[e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:t.product_name}),t.product_code&&e.jsx("div",{className:"text-xs text-gray-500",children:t.product_code})]}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx(L,{variant:t.current_stock>=t.quantity?"default":"destructive",children:t.current_stock})}),e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(S,{type:"number",min:"1",max:t.current_stock,value:t.quantity,onChange:a=>E(t.product_id,a.target.value),className:"w-20 text-center"})}),t.quantity>t.current_stock&&e.jsxs("div",{className:"flex items-center justify-center gap-1 mt-1 text-xs text-red-500",children:[e.jsx(U,{className:"h-3 w-3"}),"Stock insuffisant"]})]}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>R(t.product_id),className:"text-red-500 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20",children:e.jsx(V,{className:"h-4 w-4"})})})]},t.product_id))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-gray-50 dark:bg-slate-700/50",children:[e.jsxs("td",{colSpan:"2",className:"py-3 px-4 text-right font-medium",children:["Total (",s.length," produit",s.length>1?"s":"",")"]}),e.jsxs("td",{className:"py-3 px-4 text-center font-bold text-lg",children:[P," unités"]}),e.jsx("td",{})]})})]})})]})]}),e.jsxs(m,{className:"bg-white dark:bg-slate-800",children:[e.jsx(h,{children:e.jsx(p,{children:"Notes"})}),e.jsx(g,{children:e.jsx("textarea",{value:y,onChange:t=>z(t.target.value),placeholder:"Notes ou commentaires (optionnel)...",rows:3,className:"w-full rounded-md border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-gray-900 dark:text-white px-3 py-2"})})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(k,{href:route("pharmacy.transfers.index"),children:e.jsx(o,{type:"button",variant:"outline",children:"Annuler"})}),e.jsxs(o,{type:"submit",disabled:f||s.length===0,className:"bg-blue-600 hover:bg-blue-700",children:[f?e.jsx(O,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(J,{className:"h-4 w-4 mr-2"}),"Créer le Transfert"]})]})]})})})]})}export{pe as default};
