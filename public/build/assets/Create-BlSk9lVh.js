import{r as n,j as e,H as P,L as b,c as A,a as F}from"./app-3PKVeuQh.js";import{A as I,b as U,P as z}from"./AppLayout-DSrKCpOy.js";import{C as v,a as f,b as g,c as y}from"./card-FPNRX1p2.js";import{B as d}from"./Button-RC9FN5z3.js";import{I as u}from"./Input-5gvkn2nv.js";import{u as R}from"./use-toast-B4iWoEZ4.js";import{T}from"./user-cog-nVqfHm0b.js";import"./createLucideIcon-CyiEew_u.js";import"./shield-x-gOy17OJ-.js";import"./x-YL0zAneP.js";import"./Dropdown-B_QkibTR.js";import"./transition-CufTvwOt.js";import"./arrow-left-CvJq81LS.js";import"./loader-circle-D2tkCN5O.js";import"./refresh-cw-L3GUbwVE.js";import"./FlashMessages-bPB7K-Ql.js";function ae({auth:B,products:m=[],suppliers:N=[]}){const{toast:l}=R(),[c,_]=n.useState(""),[x,C]=n.useState(""),[h,k]=n.useState("USD"),[r,o]=n.useState([{product_id:"",product_name:"",ordered_quantity:1,unit_cost:0}]),[w,p]=n.useState(!1),S=()=>{o([...r,{product_id:"",product_name:"",ordered_quantity:1,unit_cost:0}])},L=(s,a)=>{const t=[...r];t[s]={...t[s],product_id:a.id,product_name:a.name,unit_cost:a.cost_amount??0},o(t)},j=(s,a,t)=>{const i=[...r];i[s]={...i[s],[a]:t},o(i)},q=s=>{o(r.filter((a,t)=>t!==s))},D=async s=>{if(s.preventDefault(),!c){l({title:"Sélectionnez un fournisseur",variant:"destructive"});return}const a=r.filter(t=>t.product_id&&t.ordered_quantity>0&&Number(t.unit_cost)>=0);if(a.length===0){l({title:"Ajoutez au moins une ligne avec produit et quantité",variant:"destructive"});return}p(!0);try{await A.post(route("pharmacy.purchases.store"),{supplier_id:c,currency:h,expected_at:x||null,lines:a.map(t=>({product_id:t.product_id,ordered_quantity:Number(t.ordered_quantity),unit_cost:Number(t.unit_cost)}))}),l({title:"Bon de commande créé"}),F.visit(route("pharmacy.purchases.index"))}catch(t){l({title:"Erreur",description:t.response?.data?.message||"Erreur",variant:"destructive"})}finally{p(!1)}};return e.jsxs(I,{header:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold text-xl text-gray-800 dark:text-white leading-tight",children:"Nouveau bon de commande"}),e.jsx(d,{variant:"outline",asChild:!0,children:e.jsx(b,{href:route("pharmacy.purchases.index"),children:"Retour"})})]}),children:[e.jsx(P,{title:"Nouveau bon de commande"}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"max-w-4xl mx-auto sm:px-6 lg:px-8",children:e.jsxs("form",{onSubmit:D,children:[e.jsxs(v,{className:"mb-6",children:[e.jsx(f,{children:e.jsx(g,{children:"Fournisseur & dates"})}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Fournisseur *"}),e.jsxs("select",{className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:c,onChange:s=>_(s.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Choisir..."}),N.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Date livraison prévue"}),e.jsx(u,{type:"date",value:x,onChange:s=>C(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Devise"}),e.jsxs("select",{className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:h,onChange:s=>k(s.target.value),children:[e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"EUR",children:"EUR"}),e.jsx("option",{value:"CDF",children:"CDF"})]})]})]})]})]}),e.jsxs(v,{className:"mb-6",children:[e.jsx(f,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(g,{className:"flex items-center",children:[e.jsx(U,{className:"h-5 w-5 mr-2"}),"Lignes"]}),e.jsxs(d,{type:"button",variant:"outline",size:"sm",onClick:S,children:[e.jsx(z,{className:"h-4 w-4 mr-1"})," Ligne"]})]})}),e.jsx(y,{children:e.jsx("div",{className:"space-y-4",children:r.map((s,a)=>e.jsxs("div",{className:"flex flex-wrap items-end gap-4 p-4 border dark:border-gray-700 rounded",children:[e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Produit"}),e.jsxs("select",{className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:s.product_id,onChange:t=>{const i=m.find(E=>E.id===t.target.value);i&&L(a,i)},children:[e.jsx("option",{value:"",children:"Choisir..."}),m.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.code,")"]},t.id))]})]}),e.jsxs("div",{className:"w-24",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Qté"}),e.jsx(u,{type:"number",min:1,value:s.ordered_quantity,onChange:t=>j(a,"ordered_quantity",parseInt(t.target.value,10)||1)})]}),e.jsxs("div",{className:"w-28",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Prix d'achat"}),e.jsx(u,{type:"number",step:"0.01",min:0,value:s.unit_cost,onChange:t=>j(a,"unit_cost",parseFloat(t.target.value)||0)})]}),e.jsx(d,{type:"button",variant:"ghost",size:"sm",onClick:()=>q(a),disabled:r.length<=1,children:e.jsx(T,{className:"h-4 w-4 text-red-500"})})]},a))})})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(d,{type:"button",variant:"outline",asChild:!0,children:e.jsx(b,{href:route("pharmacy.purchases.index"),children:"Annuler"})}),e.jsx(d,{type:"submit",disabled:w,children:"Enregistrer le bon de commande"})]})]})})})]})}export{ae as default};
