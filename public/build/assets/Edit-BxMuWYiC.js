import{u as F,r as b,b as E,R as I,j as e,H as v,L as h,n as m,a as R}from"./app-BGTsh8B3.js";import{A as y,b as q,I as T,u as U}from"./AppLayout-B9W2Qjn-.js";import{C as D,a as L,b as S,c as A}from"./card-DzyZZsrB.js";import{B as p}from"./Button-Cm51LcKk.js";import{I as l}from"./Input-LVtkliO7.js";import{L as n}from"./Label-CEns7YJb.js";import{T as G}from"./textarea-Dc6vmaOE.js";import{X as M}from"./x-Bqi0sytM.js";import{A as O}from"./arrow-left-BMPE_XAu.js";import"./createLucideIcon-B4miffV9.js";import"./shield-x-DRqpxde8.js";import"./user-cog-CgPvrrVM.js";import"./Dropdown-DbeWMHj2.js";import"./transition-JR3jNvu7.js";import"./loader-circle-CIdMfzjo.js";import"./refresh-cw-CA0aJ90x.js";import"./FlashMessages-o0prhkl9.js";const H=["PIECE","LOT","METRE","KG","LITRE","BOITE","CARTON","UNITE"];function te({product:a,categories:N=[]}){const{props:x}=F(),o=x.shop?.currencies||[],f=x.shop?.currency||o.find(r=>r.is_default)?.code||o[0]?.code||"USD",[g,u]=b.useState(a?.image_url||null),{data:i,setData:s,put:w,processing:_,errors:t}=E({name:a?.name||"",description:a?.description||"",category_id:a?.category_id||"",price:a?.price_amount??"",currency:a?.price_currency||f,minimum_stock:a?.minimum_stock??0,type_unite:a?.type_unite||"UNITE",quantite_par_unite:a?.quantite_par_unite??1,est_divisible:a?.est_divisible!==!1,image:null,remove_image:!1,price_normal:a?.price_normal??a?.price_amount??"",price_reduced:a?.price_reduced??"",price_reduction_percent:a?.price_reduction_percent??"",price_non_negotiable:a?.price_non_negotiable??"",price_wholesale_normal:a?.price_wholesale_normal??"",price_wholesale_reduced:a?.price_wholesale_reduced??"",price_non_negotiable_1:a?.price_non_negotiable_1??"",price_non_negotiable_2:a?.price_non_negotiable_2??"",price_non_negotiable_3:a?.price_non_negotiable_3??""});b.useEffect(()=>{a?.image_url&&u(a.image_url)},[a?.image_url]);const C=r=>{const c=r.target.files?.[0];if(!c)return;if(c.size>2*1024*1024){m.error("L'image ne doit pas dépasser 2 Mo");return}if(!c.type.match(/^image\/(jpeg|jpg|png|webp)$/)){m.error("Format d'image non supporté. Utilisez JPG, PNG ou WebP.");return}s("image",c),s("remove_image",!1);const d=new FileReader;d.onloadend=()=>{u(d.result)},d.readAsDataURL(c)},P=()=>{s("image",null),s("remove_image",!0),u(null)},j=()=>{const r=parseFloat(i.price_normal||i.price)||0,c=parseFloat(i.price_reduction_percent)||0;if(r>0&&c>0){const d=r*(1-c/100);s("price_reduced",d.toFixed(2))}else s("price_reduced","")};I.useEffect(()=>{i.price_reduction_percent&&(i.price_normal||i.price)&&j()},[i.price_normal,i.price,i.price_reduction_percent]);const k=r=>{r.preventDefault(),!i.price_normal&&i.price&&s("price_normal",i.price),w(route("hardware.products.update",a.id),{forceFormData:!0,onSuccess:()=>{m.success("Produit mis à jour"),R.visit(route("hardware.products.show",a.id))},onError:c=>m.error(c?.message||"Erreur")})};return a?e.jsxs(y,{header:e.jsxs("div",{className:"flex items-center",children:[e.jsx(p,{variant:"ghost",asChild:!0,className:"mr-4",children:e.jsxs(h,{href:route("hardware.products.show",a.id),children:[e.jsx(O,{className:"h-4 w-4 mr-2"})," Retour"]})}),e.jsxs("h2",{className:"font-semibold text-xl text-gray-800 dark:text-white leading-tight",children:["Modifier — ",a.name]})]}),children:[e.jsx(v,{title:`Modifier ${a.name} - Quincaillerie`}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"max-w-4xl mx-auto sm:px-6 lg:px-8",children:e.jsx("form",{onSubmit:k,children:e.jsxs(D,{children:[e.jsx(L,{children:e.jsxs(S,{className:"flex items-center",children:[e.jsx(q,{className:"h-5 w-5 mr-2"})," Modifier le produit"]})}),e.jsxs(A,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"name",children:"Nom *"}),e.jsx(l,{id:"name",value:i.name,onChange:r=>s("name",r.target.value),required:!0}),t.name&&e.jsx("p",{className:"text-sm text-red-600",children:t.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Code produit"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:a.product_code})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"description",children:"Description"}),e.jsx(G,{id:"description",value:i.description,onChange:r=>s("description",r.target.value),rows:3}),t.description&&e.jsx("p",{className:"text-sm text-red-600",children:t.description})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"image",children:"Image du produit"}),e.jsxs("div",{className:"flex items-center gap-4",children:[g?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:g,alt:"Preview",className:"w-32 h-32 object-cover rounded-lg border border-gray-300 dark:border-gray-600"}),e.jsx("button",{type:"button",onClick:P,className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:e.jsx(M,{className:"h-4 w-4"})})]}):e.jsxs("label",{htmlFor:"image",className:"flex flex-col items-center justify-center w-32 h-32 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer hover:border-amber-500 transition-colors",children:[e.jsx(T,{className:"h-8 w-8 text-gray-400 mb-2"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Cliquer pour uploader"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{type:"file",id:"image",accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:C,className:"hidden"}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Formats acceptés : JPG, PNG, WebP (max 2 Mo)"})]})]}),t.image&&e.jsx("p",{className:"text-sm text-red-600",children:t.image})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"category_id",children:"Catégorie *"}),e.jsxs("select",{id:"category_id",value:i.category_id,onChange:r=>s("category_id",r.target.value),className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:border-amber-500 focus:ring-amber-500",required:!0,children:[e.jsx("option",{value:"",children:"— Choisir —"}),N.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]}),t.category_id&&e.jsx("p",{className:"text-sm text-red-600",children:t.category_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"type_unite",children:"Unité *"}),e.jsx("select",{id:"type_unite",value:i.type_unite,onChange:r=>s("type_unite",r.target.value),className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:border-amber-500 focus:ring-amber-500",children:H.map(r=>e.jsx("option",{value:r,children:r},r))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"price",children:"Prix principal *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{id:"price",type:"number",step:"0.01",min:0,value:i.price,onChange:r=>{s("price",r.target.value),i.price_normal||s("price_normal",r.target.value)},required:!0}),e.jsx("select",{value:i.currency,onChange:r=>s("currency",r.target.value),className:"rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white w-24",children:o.length>0?o.map(r=>e.jsx("option",{value:r.code,children:r.code},r.code)):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"CDF",children:"CDF"}),e.jsx("option",{value:"EUR",children:"EUR"})]})})]}),t.price&&e.jsx("p",{className:"text-sm text-red-600",children:t.price})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"quantite_par_unite",children:"Quantité par unité *"}),e.jsx(l,{id:"quantite_par_unite",type:"number",min:1,value:i.quantite_par_unite,onChange:r=>s("quantite_par_unite",parseInt(r.target.value,10)||1)}),t.quantite_par_unite&&e.jsx("p",{className:"text-sm text-red-600",children:t.quantite_par_unite})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"minimum_stock",children:"Stock minimum"}),e.jsx(l,{id:"minimum_stock",type:"number",min:0,value:i.minimum_stock,onChange:r=>s("minimum_stock",parseInt(r.target.value,10)||0)}),t.minimum_stock&&e.jsx("p",{className:"text-sm text-red-600",children:t.minimum_stock})]})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:"Gestion des prix"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"price_normal",children:"Prix normal"}),e.jsx(l,{id:"price_normal",type:"number",step:"0.01",min:0,value:i.price_normal,onChange:r=>s("price_normal",r.target.value),placeholder:"Prix normal"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"price_reduction_percent",children:"Pourcentage de réduction (%)"}),e.jsx(l,{id:"price_reduction_percent",type:"number",step:"0.01",min:0,max:100,value:i.price_reduction_percent,onChange:r=>{s("price_reduction_percent",r.target.value),j()},placeholder:"0.00"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"price_reduced",children:"Prix réduit (calculé automatiquement)"}),e.jsx(l,{id:"price_reduced",type:"number",step:"0.01",min:0,value:i.price_reduced,onChange:r=>s("price_reduced",r.target.value),placeholder:"Prix réduit",readOnly:!!i.price_reduction_percent})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"price_non_negotiable",children:"Prix non discutable"}),e.jsx(l,{id:"price_non_negotiable",type:"number",step:"0.01",min:0,value:i.price_non_negotiable,onChange:r=>s("price_non_negotiable",r.target.value),placeholder:"Prix non discutable"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"price_wholesale_normal",children:"Prix gros normal"}),e.jsx(l,{id:"price_wholesale_normal",type:"number",step:"0.01",min:0,value:i.price_wholesale_normal,onChange:r=>s("price_wholesale_normal",r.target.value),placeholder:"Prix gros normal"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"price_wholesale_reduced",children:"Prix gros réduit"}),e.jsx(l,{id:"price_wholesale_reduced",type:"number",step:"0.01",min:0,value:i.price_wholesale_reduced,onChange:r=>s("price_wholesale_reduced",r.target.value),placeholder:"Prix gros réduit"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"price_non_negotiable_1",children:"Prix non discutable 1"}),e.jsx(l,{id:"price_non_negotiable_1",type:"number",step:"0.01",min:0,value:i.price_non_negotiable_1,onChange:r=>s("price_non_negotiable_1",r.target.value),placeholder:"Prix non discutable 1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"price_non_negotiable_2",children:"Prix non discutable 2"}),e.jsx(l,{id:"price_non_negotiable_2",type:"number",step:"0.01",min:0,value:i.price_non_negotiable_2,onChange:r=>s("price_non_negotiable_2",r.target.value),placeholder:"Prix non discutable 2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"price_non_negotiable_3",children:"Prix non discutable 3"}),e.jsx(l,{id:"price_non_negotiable_3",type:"number",step:"0.01",min:0,value:i.price_non_negotiable_3,onChange:r=>s("price_non_negotiable_3",r.target.value),placeholder:"Prix non discutable 3"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"est_divisible",checked:i.est_divisible,onChange:r=>s("est_divisible",r.target.checked),className:"rounded border-gray-300 text-amber-600 focus:ring-amber-500"}),e.jsx(n,{htmlFor:"est_divisible",children:"Vente en fraction autorisée"})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(p,{type:"button",variant:"outline",asChild:!0,children:e.jsx(h,{href:route("hardware.products.show",a.id),children:"Annuler"})}),e.jsxs(p,{type:"submit",disabled:_,className:"bg-amber-500 hover:bg-amber-600 text-white",children:[e.jsx(U,{className:"h-4 w-4 mr-2"})," ",_?"Enregistrement...":"Enregistrer"]})]})]})]})})})})]}):e.jsxs(y,{children:[e.jsx(v,{title:"Produit - Quincaillerie"}),e.jsxs("div",{className:"py-6 text-center",children:[e.jsx("p",{className:"text-gray-500",children:"Produit introuvable."}),e.jsx(p,{asChild:!0,className:"mt-4",children:e.jsx(h,{href:route("hardware.products"),children:"Retour"})})]})]})}export{te as default};
