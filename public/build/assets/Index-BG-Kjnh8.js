import{u as q,r as d,j as e,H as P,L as h,a as V,c as G,z as C}from"./app-DtqU_Gmt.js";import{A as I,d as p,Y as E,W as U,P as T,t as S,i as H,l as W,m as X,M as Y,E as J,C as K}from"./AppLayout-C4K4I5xd.js";import{B as l}from"./Button-4k-pObky.js";import{I as _}from"./Input-BpgKxISb.js";import{B as i}from"./badge-BBdevRdg.js";import{f as Q}from"./currency-CAle3Gff.js";import{E as Z}from"./ExportButtons-BX5RtZeP.js";import{C as D}from"./x-Cw-ZD_Fb.js";import"./createLucideIcon-BH-qXF_i.js";import"./shield-x-Cz4kXV9c.js";import"./user-cog-BQwjoD4w.js";import"./Dropdown--z3bvfF1.js";import"./transition-DbHxI3Hw.js";import"./arrow-left-BGTcItEv.js";import"./loader-circle-DtoZnQ6b.js";import"./refresh-cw-CcjnuCLI.js";import"./FlashMessages-D-g4FpAa.js";import"./utils-CDN07tui.js";function be({sales:a=[],filters:r={},canViewAllSales:u=!0,routePrefix:s="pharmacy"}){const{shop:L}=q().props,B=L?.currency||"CDF",[x,y]=d.useState(r.from||""),[c,b]=d.useState(r.to||""),[m,j]=d.useState(r.status||""),[N,k]=d.useState(r.sale_type||""),[f,v]=d.useState(null);d.useEffect(()=>{y(r.from??""),b(r.to??""),j(r.status??""),k(r.sale_type??"")},[r.from,r.to,r.status,r.sale_type]);const A=t=>{t.preventDefault(),V.get(route(`${s}.sales.index`),{from:x||void 0,to:c||void 0,status:m||void 0,sale_type:N||void 0},{preserveState:!0})},F=t=>t==="COMPLETED"?e.jsxs(i,{className:"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300",children:[e.jsx(D,{className:"h-3 w-3 mr-1"}),"Terminée"]}):t==="CANCELLED"?e.jsxs(i,{className:"bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300",children:[e.jsx(K,{className:"h-3 w-3 mr-1"}),"Annulée"]}):e.jsxs(i,{className:"bg-amber-100 text-amber-800 dark:bg-amber-900/50 dark:text-amber-300",children:[e.jsx(S,{className:"h-3 w-3 mr-1"}),"Brouillon"]}),$=a.filter(t=>t.status==="COMPLETED").length,z=a.filter(t=>t.status==="DRAFT").length,M=a.filter(t=>t.status==="COMPLETED").reduce((t,n)=>t+Number(n.total_amount),0),o=a.find(t=>t.status==="COMPLETED")??null,g=t=>Q(t,B),w=t=>{window.open(route(`${s}.sales.receipt`,t),"_blank","noopener,noreferrer")},R=async t=>{if(!(!t||f)){v(t);try{const{data:n}=await G.post(route(`${s}.sales.email-receipt`,t));C.success(n.message||"Facture envoyée par email.")}catch(n){const O=n.response?.data?.message||"Erreur lors de l'envoi de la facture.";C.error(O)}finally{v(null)}}};return e.jsxs(I,{children:[e.jsx(P,{title:"Ventes"}),e.jsxs("div",{className:"py-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2 text-gray-900 dark:text-gray-100",children:[e.jsx(p,{className:"h-6 w-6"}),"Gestion des Ventes"]}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 mt-1 flex items-center gap-3 flex-wrap",children:[e.jsxs("span",{children:[a.length," vente(s) au total"]}),!u&&e.jsx("span",{className:"text-amber-600 dark:text-amber-400 text-sm font-medium",children:"Vous consultez uniquement vos ventes."}),e.jsxs("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:["Raccourci: ",e.jsx("kbd",{className:"px-1.5 py-0.5 rounded bg-gray-200 dark:bg-gray-700 font-mono",children:"1"})," cette page · ",e.jsx("kbd",{className:"px-1.5 py-0.5 rounded bg-gray-200 dark:bg-gray-700 font-mono",children:"2"})," nouvelle vente"]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(l,{variant:"outline",size:"sm",type:"button",disabled:!o,onClick:()=>o&&w(o.id),className:"inline-flex items-center gap-2 shrink-0",title:o?"Ouvrir le reçu de la dernière vente terminée pour impression thermique":"Aucune vente terminée à imprimer",children:[e.jsx(E,{className:"h-4 w-4 shrink-0"}),e.jsx("span",{className:"whitespace-nowrap",children:"Print thermique"})]}),e.jsx(Z,{pdfUrl:route(`${s}.exports.sales.pdf`,{from:x,to:c,status:m}),excelUrl:route(`${s}.exports.sales.excel`,{from:x,to:c,status:m}),disabled:!a.length}),e.jsx(l,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(h,{href:route(`${s}.cash-registers.index`),className:"inline-flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Caisses"]})}),e.jsx(l,{asChild:!0,children:e.jsxs(h,{href:route(`${s}.sales.create`),className:"inline-flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),"Nouvelle vente"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Total Ventes"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1",children:a.length}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"toutes périodes"})]}),e.jsx("div",{className:"h-12 w-12 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center",children:e.jsx(p,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Terminées"}),e.jsx("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400 mt-1",children:$}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"complétées"})]}),e.jsx("div",{className:"h-12 w-12 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center",children:e.jsx(D,{className:"h-6 w-6 text-green-600 dark:text-green-400"})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Brouillons"}),e.jsx("p",{className:"text-2xl font-bold text-amber-600 dark:text-amber-400 mt-1",children:z}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"en attente"})]}),e.jsx("div",{className:"h-12 w-12 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center",children:e.jsx(S,{className:"h-6 w-6 text-amber-600 dark:text-amber-400"})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Chiffre d'affaires"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1",children:g(M)}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"ventes terminées"})]}),e.jsx("div",{className:"h-12 w-12 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center",children:e.jsx(H,{className:"h-6 w-6 text-purple-600 dark:text-purple-400"})})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 mb-6",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5 text-gray-500"}),"Filtres"]})}),e.jsx("div",{className:"p-6",children:e.jsxs("form",{onSubmit:A,className:"flex flex-wrap gap-4 items-end",children:[e.jsxs("div",{className:"flex-1 min-w-[150px]",children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:"Du"}),e.jsx(_,{type:"date",value:x,onChange:t=>y(t.target.value),className:"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100"})]}),e.jsxs("div",{className:"flex-1 min-w-[150px]",children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:"Au"}),e.jsx(_,{type:"date",value:c,onChange:t=>b(t.target.value),className:"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100"})]}),e.jsxs("div",{className:"flex-1 min-w-[150px]",children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:"Statut"}),e.jsxs("select",{className:"w-full h-10 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 px-3 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",value:m,onChange:t=>j(t.target.value),children:[e.jsx("option",{value:"",children:"Tous les statuts"}),e.jsx("option",{value:"DRAFT",children:"Brouillon"}),e.jsx("option",{value:"COMPLETED",children:"Terminée"}),e.jsx("option",{value:"CANCELLED",children:"Annulée"})]})]}),e.jsxs("div",{className:"flex-1 min-w-[150px]",children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:"Type de vente"}),e.jsxs("select",{className:"w-full h-10 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 px-3 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",value:N,onChange:t=>k(t.target.value),children:[e.jsx("option",{value:"",children:"Tous"}),e.jsx("option",{value:"retail",children:"Détail"}),e.jsx("option",{value:"wholesale",children:"Gros"})]})]}),e.jsxs(l,{type:"submit",className:"inline-flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),"Filtrer"]})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[e.jsx(p,{className:"h-5 w-5 text-gray-500"}),"Liste des ventes (",a.length,")"]})}),a.length===0?e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(p,{className:"h-12 w-12 mx-auto text-gray-300 dark:text-gray-600 mb-4"}),e.jsx("p",{className:"text-lg font-medium text-gray-600 dark:text-gray-300 mb-2",children:"Aucune vente trouvée"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Créez une nouvelle vente pour commencer"}),e.jsx(l,{asChild:!0,children:e.jsxs(h,{href:route(`${s}.sales.create`),className:"inline-flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),"Nouvelle vente"]})})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Statut"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Type"}),u&&e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Vendeur"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Payé"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Solde"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:a.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:t.created_at}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:F(t.status)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.sale_type==="wholesale"?e.jsx(i,{className:"bg-amber-100 text-amber-800 dark:bg-amber-900/50 dark:text-amber-300",children:"Gros"}):e.jsx(i,{className:"bg-slate-100 text-slate-700 dark:bg-slate-700 dark:text-slate-300",children:"Détail"})}),u&&e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsxs("div",{className:"flex flex-col",children:[t.customer_short_name&&e.jsx("span",{className:"text-blue-600 dark:text-blue-400 font-medium mb-0.5",children:t.customer_short_name}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:t.seller_name??"—"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-medium text-gray-900 dark:text-gray-100",children:g(Number(t.total_amount))}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-green-600 dark:text-green-400 font-medium",children:g(Number(t.paid_amount))}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right",children:e.jsx("span",{className:Number(t.balance_amount)>0?"text-amber-600 dark:text-amber-400 font-medium":"text-gray-500 dark:text-gray-400",children:g(Number(t.balance_amount))})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>w(t.id),className:"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",title:"Print thermique",children:e.jsx(E,{className:"h-4 w-4"})}),e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>R(t.id),disabled:!!f,className:"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",title:"Envoyer par email au client",children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx(l,{variant:"ghost",size:"sm",asChild:!0,className:"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:e.jsx(h,{href:route(`${s}.sales.show`,t.id),title:"Voir",children:e.jsx(J,{className:"h-4 w-4"})})})]})})]},t.id))})]})})]})]})]})}export{be as default};
