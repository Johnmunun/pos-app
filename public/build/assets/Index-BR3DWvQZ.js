import{u as P,r as d,j as e,H as B,L as T,a as l,c as R,z as b}from"./app-3PKVeuQh.js";import{A as I,n as G,e as k,b as x,F as H,h as N}from"./AppLayout-DSrKCpOy.js";import{B as i}from"./Button-RC9FN5z3.js";import{I as c}from"./Input-5gvkn2nv.js";import{B as o}from"./badge-Ca6uIRAr.js";import{E as K}from"./ExportButtons-Bm2TEI_V.js";import{A as M}from"./arrow-left-CvJq81LS.js";import{R as O}from"./refresh-cw-L3GUbwVE.js";import{C as f,T as q}from"./user-cog-nVqfHm0b.js";import{C as Q}from"./loader-circle-D2tkCN5O.js";import{C as $}from"./x-YL0zAneP.js";import"./createLucideIcon-CyiEew_u.js";import"./shield-x-gOy17OJ-.js";import"./Dropdown-B_QkibTR.js";import"./transition-CufTvwOt.js";import"./FlashMessages-bPB7K-Ql.js";function ce({batches:a={data:[],current_page:1,last_page:1,total:0},summary:n={expired_count:0,expiring_soon_count:0,total_batches:0},products:v=[],filters:t={}}){const{shop:J}=P().props,[m,w]=d.useState(t.search||""),[g,_]=d.useState(t.product_id||""),[p,C]=d.useState(t.status||""),[h,S]=d.useState(t.from_date||""),[u,E]=d.useState(t.to_date||""),[D,y]=d.useState(null),A=r=>{r.preventDefault(),l.get(route("pharmacy.expirations.index"),{search:m||void 0,product_id:g||void 0,status:p||void 0,from_date:h||void 0,to_date:u||void 0},{preserveState:!0})},j=r=>{l.get(route("pharmacy.expirations.index"),{...t,page:r},{preserveState:!0})},L=async r=>{if(confirm("Êtes-vous sûr de vouloir supprimer ce lot ?")){y(r);try{await R.delete(route("pharmacy.batches.destroy",r)),b.success("Lot supprimé avec succès"),l.reload({only:["batches","summary"]})}catch(s){b.error(s.response?.data?.message||"Erreur lors de la suppression")}finally{y(null)}}},z=(r,s)=>{switch(r){case"expired":return e.jsxs(o,{className:"bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300",children:[e.jsx(f,{className:"h-3 w-3 mr-1"}),"Expiré (",Math.abs(s)," j)"]});case"expiring_soon":return e.jsxs(o,{className:"bg-amber-100 text-amber-800 dark:bg-amber-900/50 dark:text-amber-300",children:[e.jsx(k,{className:"h-3 w-3 mr-1"}),"Expire dans ",s," j"]});default:return e.jsxs(o,{className:"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300",children:[e.jsx($,{className:"h-3 w-3 mr-1"}),"OK (",s," j)"]})}},F=r=>r?new Date(r).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}):"—";return e.jsxs(I,{children:[e.jsx(B,{title:"Gestion des Expirations"}),e.jsxs("div",{className:"container mx-auto py-6 px-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(i,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(T,{href:route("pharmacy.stock.index"),children:[e.jsx(M,{className:"h-4 w-4 mr-1"}),"Retour Stock"]})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2 text-gray-900 dark:text-gray-100",children:[e.jsx(G,{className:"h-6 w-6"}),"Gestion des Expirations"]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Suivi des lots et dates de péremption"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{pdfUrl:route("pharmacy.exports.expirations.pdf"),excelUrl:route("pharmacy.exports.expirations.excel"),disabled:!a.data?.length}),e.jsxs(i,{variant:"outline",onClick:()=>l.reload(),children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Actualiser"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Lots expirés"}),e.jsx("p",{className:"text-2xl font-bold text-red-600 dark:text-red-400 mt-1",children:n.expired_count}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"nécessitent attention"})]}),e.jsx("div",{className:"h-12 w-12 bg-red-100 dark:bg-red-900/30 rounded-lg flex items-center justify-center",children:e.jsx(f,{className:"h-6 w-6 text-red-600 dark:text-red-400"})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Expire bientôt"}),e.jsx("p",{className:"text-2xl font-bold text-amber-600 dark:text-amber-400 mt-1",children:n.expiring_soon_count}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"dans les 30 prochains jours"})]}),e.jsx("div",{className:"h-12 w-12 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center",children:e.jsx(k,{className:"h-6 w-6 text-amber-600 dark:text-amber-400"})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Total lots"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1",children:n.total_batches}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"lots en stock"})]}),e.jsx("div",{className:"h-12 w-12 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center",children:e.jsx(x,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"})})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 mb-6",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5 text-gray-500"}),"Filtres"]})}),e.jsx("div",{className:"p-6",children:e.jsxs("form",{onSubmit:A,className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:"Recherche"}),e.jsxs("div",{className:"relative",children:[e.jsx(N,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(c,{type:"text",placeholder:"Lot ou produit...",value:m,onChange:r=>w(r.target.value),className:"pl-10 bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:"Produit"}),e.jsxs("select",{className:"w-full h-10 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 px-3 focus:ring-2 focus:ring-primary",value:g,onChange:r=>_(r.target.value),children:[e.jsx("option",{value:"",children:"Tous les produits"}),v.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:"Statut"}),e.jsxs("select",{className:"w-full h-10 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 px-3 focus:ring-2 focus:ring-primary",value:p,onChange:r=>C(r.target.value),children:[e.jsx("option",{value:"",children:"Tous"}),e.jsx("option",{value:"expired",children:"Expirés"}),e.jsx("option",{value:"expiring_soon",children:"Expire bientôt"}),e.jsx("option",{value:"ok",children:"OK"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:"Du"}),e.jsx(c,{type:"date",value:h,onChange:r=>S(r.target.value),className:"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:"Au"}),e.jsx(c,{type:"date",value:u,onChange:r=>E(r.target.value),className:"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(i,{type:"submit",className:"w-full",children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"Filtrer"]})})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[e.jsx(x,{className:"h-5 w-5 text-gray-500"}),"Lots (",a.total,")"]})}),a.data.length===0?e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(x,{className:"h-12 w-12 mx-auto text-gray-300 dark:text-gray-600 mb-4"}),e.jsx("p",{className:"text-lg font-medium text-gray-600 dark:text-gray-300 mb-2",children:"Aucun lot trouvé"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Modifiez vos filtres ou créez des lots via les achats"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Produit"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"N° Lot"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Quantité"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Date d'expiration"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Statut"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:a.data.map(r=>e.jsxs("tr",{className:`hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors ${r.status==="expired"?"bg-red-50/50 dark:bg-red-900/10":r.status==="expiring_soon"?"bg-amber-50/50 dark:bg-amber-900/10":""}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center",children:e.jsx(x,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:r.product_name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r.product_code})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"font-mono text-sm text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded",children:r.batch_number})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:r.quantity})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:F(r.expiration_date)})]})}),e.jsx("td",{className:"px-6 py-4",children:z(r.status,r.days_until_expiration)}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>L(r.id),disabled:D===r.id,className:"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 hover:bg-red-50 dark:hover:bg-red-900/20",children:e.jsx(q,{className:"h-4 w-4"})})})]},r.id))})]})}),a.last_page>1&&e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 dark:border-gray-700 flex items-center justify-between bg-gray-50 dark:bg-gray-700/30",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Page ",a.current_page," sur ",a.last_page," (",a.total," lots)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{variant:"outline",size:"sm",disabled:a.current_page<=1,onClick:()=>j(a.current_page-1),children:"Précédent"}),e.jsx(i,{variant:"outline",size:"sm",disabled:a.current_page>=a.last_page,onClick:()=>j(a.current_page+1),children:"Suivant"})]})]})]})]})]})]})}export{ce as default};
