import{u as S,r as x,j as e,n as m,c as _}from"./app-DtqU_Gmt.js";import{D as E}from"./Drawer-Dy6JDRVK.js";import{I as o}from"./Input-BpgKxISb.js";import{L as d}from"./Label-QVyen-Zj.js";import{T as M}from"./textarea-DdvYib4T.js";import{B as w}from"./Button-4k-pObky.js";import{f as D,B as L,p as T,M as B,s as P,t as z,u as A}from"./AppLayout-C4K4I5xd.js";import{b as R}from"./x-Cw-ZD_Fb.js";import{L as U}from"./loader-circle-DtoZnQ6b.js";function W({isOpen:j,onClose:u,customer:r=null,onSuccess:N=null,canCreate:g=!1,canUpdate:v=!1,routePrefix:b="pharmacy"}){const{shop:C}=S().props,F=C?.currency||"USD",c=!!r,[t,h]=x.useState({name:"",phone:"",email:"",address:"",customer_type:"individual",tax_number:"",credit_limit:""}),[s,p]=x.useState({}),[f,y]=x.useState(!1);x.useEffect(()=>{h(r?{name:r.name||"",phone:r.phone||"",email:r.email||"",address:r.address||"",customer_type:r.customer_type||"individual",tax_number:r.tax_number||"",credit_limit:r.credit_limit?.toString()||""}:{name:"",phone:"",email:"",address:"",customer_type:"individual",tax_number:"",credit_limit:""}),p({})},[r,j]);const n=(a,i)=>{h(l=>({...l,[a]:i})),s[a]&&p(l=>({...l,[a]:null}))},k=async a=>{if(a.preventDefault(),c&&!v){m.error("Vous n'avez pas la permission de modifier ce client.");return}if(!c&&!g){m.error("Vous n'avez pas la permission de créer un client.");return}y(!0),p({});try{const i={...t,credit_limit:t.credit_limit?parseFloat(t.credit_limit):null};let l;c?l=await _.put(route(`${b}.customers.update`,r.id),i):l=await _.post(route(`${b}.customers.store`),i),l.data.success?(m.success(l.data.message),u(),N&&N()):m.error(l.data.message||"Une erreur est survenue")}catch(i){i.response?.status===422&&i.response?.data?.errors?p(i.response.data.errors):m.error(i.response?.data?.message||"Une erreur est survenue")}finally{y(!1)}},X=c?v:g;return e.jsx(E,{isOpen:j,onClose:u,title:c?"Modifier le client":"Nouveau client",children:e.jsxs("form",{onSubmit:k,className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex-1 space-y-4 p-4 overflow-y-auto",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"name",className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),"Nom ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{id:"name",value:t.name,onChange:a=>n("name",a.target.value),placeholder:"Nom du client",className:s.name?"border-red-500":""}),s.name&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:s.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"customer_type",className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-4 w-4"}),"Type de client"]}),e.jsxs("select",{id:"customer_type",value:t.customer_type,onChange:a=>n("customer_type",a.target.value),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx("option",{value:"individual",children:"Particulier"}),e.jsx("option",{value:"company",children:"Entreprise"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"phone",className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),"Téléphone"]}),e.jsx(o,{id:"phone",type:"tel",value:t.phone,onChange:a=>n("phone",a.target.value),placeholder:"+243 XXX XXX XXX",className:s.phone?"border-red-500":""}),s.phone&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:s.phone})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"email",className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4"}),"Email"]}),e.jsx(o,{id:"email",type:"email",value:t.email,onChange:a=>n("email",a.target.value),placeholder:"client@email.com",className:s.email?"border-red-500":""}),s.email&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:s.email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"address",className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4"}),"Adresse"]}),e.jsx(M,{id:"address",value:t.address,onChange:a=>n("address",a.target.value),placeholder:"Adresse complète",rows:2,className:s.address?"border-red-500":""}),s.address&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:s.address})]}),t.customer_type==="company"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"tax_number",className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),"Numéro fiscal / RCCM"]}),e.jsx(o,{id:"tax_number",value:t.tax_number,onChange:a=>n("tax_number",a.target.value),placeholder:"Numéro fiscal ou RCCM",className:s.tax_number?"border-red-500":""}),s.tax_number&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:s.tax_number})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"credit_limit",className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),"Limite de crédit (",F,")"]}),e.jsx(o,{id:"credit_limit",type:"number",min:"0",step:"0.01",value:t.credit_limit,onChange:a=>n("credit_limit",a.target.value),placeholder:"0.00",className:s.credit_limit?"border-red-500":""}),s.credit_limit&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:s.credit_limit}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Laissez vide pour aucune limite de crédit"})]})]}),e.jsxs("div",{className:"border-t p-4 flex gap-3",children:[e.jsx(w,{type:"button",variant:"outline",onClick:u,className:"flex-1",disabled:f,children:"Annuler"}),e.jsx(w,{type:"submit",className:"flex-1",disabled:f||!X,children:f?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-4 w-4 mr-2 animate-spin"}),"Traitement..."]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),c?"Mettre à jour":"Créer"]})})]})]})})}export{W as C};
