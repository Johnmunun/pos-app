import{b as P,r as b,j as e,H as S,L as k}from"./app-BGTsh8B3.js";import{A as R}from"./AppLayout-B9W2Qjn-.js";import{X as E}from"./x-Bqi0sytM.js";import"./createLucideIcon-B4miffV9.js";import"./shield-x-DRqpxde8.js";import"./user-cog-CgPvrrVM.js";import"./Dropdown-DbeWMHj2.js";import"./transition-JR3jNvu7.js";import"./arrow-left-BMPE_XAu.js";import"./loader-circle-CIdMfzjo.js";import"./refresh-cw-CA0aJ90x.js";import"./FlashMessages-o0prhkl9.js";function V(){const{role:l,allPermissions:u,isRootRole:p}=usePage().props,m=!!l,{data:i,setData:x,post:N,put:w,processing:h,errors:o}=P({name:l?.name||"",description:l?.description||"",permissions:l?.permissions?.map(r=>r.id)||[]}),[$,A]=b.useState(null),[c,v]=b.useState(""),y=b.useMemo(()=>Object.values(u||{}).flat().filter(t=>i.permissions.includes(t.id)),[i.permissions,u]),C=r=>{if(r.preventDefault(),!i.name.trim()){alert("Le nom du rôle est obligatoire");return}i.permissions.length===0&&!confirm("Aucune permission n'est sélectionnée. Voulez-vous vraiment créer un rôle sans permission ?")||(m?w(`/admin/access/roles/${l.id}`):N("/admin/access/roles"))},f=r=>{x("permissions",t=>t.includes(r)?t.filter(a=>a!==r):[...t,r])},L=r=>{const t=r.map(d=>d.id),a=t.every(d=>i.permissions.includes(d));x("permissions",d=>{if(a)return d.filter(n=>!t.includes(n));{const n=[...d];return t.forEach(g=>{n.includes(g)||n.push(g)}),n}})};return e.jsxs(R,{header:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold leading-tight text-gray-900 dark:text-white",children:m?"Éditer le rôle":"Créer un rôle"}),e.jsx(k,{href:"/admin/access/roles",className:"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Retour"})]}),children:[e.jsx(S,{title:m?"Éditer le rôle":"Créer un rôle"}),e.jsx("div",{className:"py-6",children:e.jsx("div",{className:"mx-auto max-w-4xl px-4 sm:px-6 lg:px-8",children:e.jsxs("form",{onSubmit:C,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Informations du rôle"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Nom du rôle *"}),e.jsx("input",{type:"text",value:i.name,onChange:r=>x("name",r.target.value),disabled:p,className:`w-full px-4 py-2 border rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent ${o.name?"border-red-500":"border-gray-300 dark:border-gray-600"} ${p?"opacity-50 cursor-not-allowed":""}`,required:!0}),o.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:o.name}),p&&e.jsx("p",{className:"mt-1 text-sm text-amber-600 dark:text-amber-400",children:"Le nom du rôle ROOT ne peut pas être modifié"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Description"}),e.jsx("textarea",{value:i.description,onChange:r=>x("description",r.target.value),rows:3,className:`w-full px-4 py-2 border rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent ${o.description?"border-red-500":"border-gray-300 dark:border-gray-600"}`}),o.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:o.description})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Permissions"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[i.permissions.length," permission",i.permissions.length>1?"s":""," sélectionnée",i.permissions.length>1?"s":""]})]}),y.length>0&&e.jsxs("div",{className:"mb-4 p-4 bg-gray-50 dark:bg-gray-900/50 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Permissions sélectionnées :"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:y.map(r=>e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-300 rounded-lg text-sm font-medium border border-amber-200 dark:border-amber-800",children:[e.jsx("span",{children:r.code}),e.jsx("button",{type:"button",onClick:()=>f(r.id),className:"hover:bg-amber-200 dark:hover:bg-amber-800 rounded-full p-0.5 transition-colors","aria-label":`Retirer ${r.code}`,children:e.jsx(E,{className:"w-3.5 h-3.5"})})]},r.id))})]}),e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",value:c,onChange:r=>v(r.target.value),placeholder:"Rechercher une permission...",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})}),e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:Object.entries(u).filter(([r,t])=>{if(!c.trim())return!0;const a=c.toLowerCase();return r.toLowerCase().includes(a)||t.some(d=>d.code.toLowerCase().includes(a)||d.description&&d.description.toLowerCase().includes(a))}).map(([r,t])=>{const a=t.filter(s=>{if(!c.trim())return!0;const j=c.toLowerCase();return s.code.toLowerCase().includes(j)||s.description&&s.description.toLowerCase().includes(j)});if(a.length===0)return null;const d=a.map(s=>s.id),n=d.every(s=>i.permissions.includes(s)),g=d.some(s=>i.permissions.includes(s));return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:n,ref:s=>{s&&(s.indeterminate=g&&!n)},onChange:()=>L(a),className:"w-4 h-4 text-amber-600 rounded focus:ring-amber-500"}),e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:r||"Sans groupe"})]}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.length," permission",a.length>1?"s":""]})]}),e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:a.map(s=>e.jsxs("label",{className:"flex items-center gap-3 px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700/50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i.permissions.includes(s.id),onChange:()=>f(s.id),className:"w-4 h-4 text-amber-600 rounded focus:ring-amber-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:s.code}),s.description&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:s.description})]})]},s.id))})]},r)}).filter(Boolean)})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsx(k,{href:"/admin/access/roles",className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:"Annuler"}),e.jsx("button",{type:"submit",disabled:h,className:"px-4 py-2 text-sm font-medium text-white bg-amber-600 rounded-lg hover:bg-amber-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:h?"Enregistrement...":m?"Mettre à jour":"Créer"})]})]})})})]})}export{V as default};
