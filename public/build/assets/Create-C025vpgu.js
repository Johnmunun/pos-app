import{u as w,r as P,b as F,R as k,j as e,H as I,L as _,n as l,c as E,a as T}from"./app-BGTsh8B3.js";import{A as q,b as R,H as S,I as U,u as D}from"./AppLayout-B9W2Qjn-.js";import{C as L,a as G,b as A,c as H}from"./card-DzyZZsrB.js";import{B as m}from"./Button-Cm51LcKk.js";import{I as n}from"./Input-LVtkliO7.js";import{L as s}from"./Label-CEns7YJb.js";import{T as O}from"./textarea-Dc6vmaOE.js";import{X as z}from"./x-Bqi0sytM.js";import{A as B}from"./arrow-left-BMPE_XAu.js";import"./createLucideIcon-B4miffV9.js";import"./shield-x-DRqpxde8.js";import"./user-cog-CgPvrrVM.js";import"./Dropdown-DbeWMHj2.js";import"./transition-JR3jNvu7.js";import"./loader-circle-CIdMfzjo.js";import"./refresh-cw-CA0aJ90x.js";import"./FlashMessages-o0prhkl9.js";const M=["PIECE","LOT","METRE","KG","LITRE","BOITE","CARTON","UNITE"];function le({categories:j=[]}){const{props:p}=w(),o=p.shop?.currencies||[],b=p.shop?.currency||o.find(r=>r.is_default)?.code||o[0]?.code||"USD",[u,h]=P.useState(null),{data:a,setData:i,post:v,processing:x,errors:t}=F({name:"",product_code:"",description:"",category_id:"",price:"",currency:b,minimum_stock:0,unit:"UNITE",type_unite:"UNITE",quantite_par_unite:1,est_divisible:!0,image:null,price_normal:"",price_reduced:"",price_reduction_percent:"",price_non_negotiable:"",price_wholesale_normal:"",price_wholesale_reduced:"",price_non_negotiable_1:"",price_non_negotiable_2:"",price_non_negotiable_3:""}),y=async()=>{if(!a.name){l.error("Saisissez d'abord le nom du produit.");return}try{const r=await E.get(route("hardware.products.generate-code"),{params:{name:a.name}});r.data?.code&&i("product_code",r.data.code)}catch(r){l.error(r.response?.data?.message||"Erreur")}},N=r=>{const c=r.target.files?.[0];if(!c)return;if(c.size>2*1024*1024){l.error("L'image ne doit pas dépasser 2 Mo");return}if(!c.type.match(/^image\/(jpeg|jpg|png|webp)$/)){l.error("Format d'image non supporté. Utilisez JPG, PNG ou WebP.");return}i("image",c);const d=new FileReader;d.onloadend=()=>{h(d.result)},d.readAsDataURL(c)},f=()=>{i("image",null),h(null)},g=()=>{const r=parseFloat(a.price_normal||a.price)||0,c=parseFloat(a.price_reduction_percent)||0;if(r>0&&c>0){const d=r*(1-c/100);i("price_reduced",d.toFixed(2))}else i("price_reduced","")};k.useEffect(()=>{a.price_reduction_percent&&(a.price_normal||a.price)&&g()},[a.price_normal,a.price,a.price_reduction_percent]);const C=r=>{r.preventDefault(),i("unit",a.type_unite),!a.price_normal&&a.price&&i("price_normal",a.price),v(route("hardware.products.store"),{forceFormData:!0,onSuccess:()=>{l.success("Produit créé"),T.visit(route("hardware.products"))},onError:c=>l.error(c?.message||"Erreur")})};return e.jsxs(q,{header:e.jsxs("div",{className:"flex items-center",children:[e.jsx(m,{variant:"ghost",asChild:!0,className:"mr-4",children:e.jsxs(_,{href:route("hardware.products"),children:[e.jsx(B,{className:"h-4 w-4 mr-2"})," Retour"]})}),e.jsx("h2",{className:"font-semibold text-xl text-gray-800 dark:text-gray-100 leading-tight",children:"Nouveau produit — Quincaillerie"})]}),children:[e.jsx(I,{title:"Créer un produit - Quincaillerie"}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"max-w-4xl mx-auto sm:px-6 lg:px-8",children:e.jsx("form",{onSubmit:C,children:e.jsxs(L,{children:[e.jsx(G,{children:e.jsxs(A,{className:"flex items-center",children:[e.jsx(R,{className:"h-5 w-5 mr-2"})," Informations produit"]})}),e.jsxs(H,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(s,{htmlFor:"name",children:"Nom *"}),e.jsx(n,{id:"name",value:a.name,onChange:r=>i("name",r.target.value),placeholder:"Nom du produit",required:!0}),t.name&&e.jsx("p",{className:"text-sm text-red-600",children:t.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(s,{htmlFor:"product_code",children:"Code *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(S,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(n,{id:"product_code",value:a.product_code,onChange:r=>i("product_code",r.target.value),className:"pl-10",placeholder:"ex: VIS-001",required:!0})]}),e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:y,children:"Générer"})]}),t.product_code&&e.jsx("p",{className:"text-sm text-red-600",children:t.product_code})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(s,{htmlFor:"description",children:"Description"}),e.jsx(O,{id:"description",value:a.description,onChange:r=>i("description",r.target.value),rows:3,placeholder:"Description..."}),t.description&&e.jsx("p",{className:"text-sm text-red-600",children:t.description})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(s,{htmlFor:"image",children:"Image du produit"}),e.jsxs("div",{className:"flex items-center gap-4",children:[u?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:u,alt:"Preview",className:"w-32 h-32 object-cover rounded-lg border border-gray-300 dark:border-gray-600"}),e.jsx("button",{type:"button",onClick:f,className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:e.jsx(z,{className:"h-4 w-4"})})]}):e.jsxs("label",{htmlFor:"image",className:"flex flex-col items-center justify-center w-32 h-32 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer hover:border-amber-500 transition-colors",children:[e.jsx(U,{className:"h-8 w-8 text-gray-400 mb-2"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Cliquer pour uploader"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{type:"file",id:"image",accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:N,className:"hidden"}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Formats acceptés : JPG, PNG, WebP (max 2 Mo)"})]})]}),t.image&&e.jsx("p",{className:"text-sm text-red-600",children:t.image})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(s,{htmlFor:"category_id",children:"Catégorie *"}),e.jsxs("select",{id:"category_id",value:a.category_id,onChange:r=>i("category_id",r.target.value),className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:border-amber-500 focus:ring-amber-500",required:!0,children:[e.jsx("option",{value:"",children:"— Choisir —"}),j.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]}),t.category_id&&e.jsx("p",{className:"text-sm text-red-600",children:t.category_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(s,{htmlFor:"type_unite",children:"Unité *"}),e.jsx("select",{id:"type_unite",value:a.type_unite,onChange:r=>{const c=r.target.value;i("type_unite",c),i("unit",c)},className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:border-amber-500 focus:ring-amber-500",children:M.map(r=>e.jsx("option",{value:r,children:r},r))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(s,{htmlFor:"price",children:"Prix principal *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{id:"price",type:"number",step:"0.01",min:0,value:a.price,onChange:r=>{i("price",r.target.value),a.price_normal||i("price_normal",r.target.value)},placeholder:"0.00",required:!0}),e.jsx("select",{value:a.currency,onChange:r=>i("currency",r.target.value),className:"rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white w-24",children:o.length>0?o.map(r=>e.jsx("option",{value:r.code,children:r.code},r.code)):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"CDF",children:"CDF"}),e.jsx("option",{value:"EUR",children:"EUR"})]})})]}),t.price&&e.jsx("p",{className:"text-sm text-red-600",children:t.price})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(s,{htmlFor:"quantite_par_unite",children:"Quantité par unité *"}),e.jsx(n,{id:"quantite_par_unite",type:"number",min:1,value:a.quantite_par_unite,onChange:r=>i("quantite_par_unite",parseInt(r.target.value,10)||1)}),t.quantite_par_unite&&e.jsx("p",{className:"text-sm text-red-600",children:t.quantite_par_unite})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(s,{htmlFor:"minimum_stock",children:"Stock minimum *"}),e.jsx(n,{id:"minimum_stock",type:"number",min:0,value:a.minimum_stock,onChange:r=>i("minimum_stock",parseInt(r.target.value,10)||0)}),t.minimum_stock&&e.jsx("p",{className:"text-sm text-red-600",children:t.minimum_stock})]})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:"Gestion des prix"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(s,{htmlFor:"price_normal",children:"Prix normal"}),e.jsx(n,{id:"price_normal",type:"number",step:"0.01",min:0,value:a.price_normal,onChange:r=>i("price_normal",r.target.value),placeholder:"Prix normal"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(s,{htmlFor:"price_reduction_percent",children:"Pourcentage de réduction (%)"}),e.jsx(n,{id:"price_reduction_percent",type:"number",step:"0.01",min:0,max:100,value:a.price_reduction_percent,onChange:r=>{i("price_reduction_percent",r.target.value),g()},placeholder:"0.00"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(s,{htmlFor:"price_reduced",children:"Prix réduit (calculé automatiquement)"}),e.jsx(n,{id:"price_reduced",type:"number",step:"0.01",min:0,value:a.price_reduced,onChange:r=>i("price_reduced",r.target.value),placeholder:"Prix réduit",readOnly:!!a.price_reduction_percent})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(s,{htmlFor:"price_non_negotiable",children:"Prix non discutable"}),e.jsx(n,{id:"price_non_negotiable",type:"number",step:"0.01",min:0,value:a.price_non_negotiable,onChange:r=>i("price_non_negotiable",r.target.value),placeholder:"Prix non discutable"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(s,{htmlFor:"price_wholesale_normal",children:"Prix gros normal"}),e.jsx(n,{id:"price_wholesale_normal",type:"number",step:"0.01",min:0,value:a.price_wholesale_normal,onChange:r=>i("price_wholesale_normal",r.target.value),placeholder:"Prix gros normal"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(s,{htmlFor:"price_wholesale_reduced",children:"Prix gros réduit"}),e.jsx(n,{id:"price_wholesale_reduced",type:"number",step:"0.01",min:0,value:a.price_wholesale_reduced,onChange:r=>i("price_wholesale_reduced",r.target.value),placeholder:"Prix gros réduit"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(s,{htmlFor:"price_non_negotiable_1",children:"Prix non discutable 1"}),e.jsx(n,{id:"price_non_negotiable_1",type:"number",step:"0.01",min:0,value:a.price_non_negotiable_1,onChange:r=>i("price_non_negotiable_1",r.target.value),placeholder:"Prix non discutable 1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(s,{htmlFor:"price_non_negotiable_2",children:"Prix non discutable 2"}),e.jsx(n,{id:"price_non_negotiable_2",type:"number",step:"0.01",min:0,value:a.price_non_negotiable_2,onChange:r=>i("price_non_negotiable_2",r.target.value),placeholder:"Prix non discutable 2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(s,{htmlFor:"price_non_negotiable_3",children:"Prix non discutable 3"}),e.jsx(n,{id:"price_non_negotiable_3",type:"number",step:"0.01",min:0,value:a.price_non_negotiable_3,onChange:r=>i("price_non_negotiable_3",r.target.value),placeholder:"Prix non discutable 3"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"est_divisible",checked:a.est_divisible,onChange:r=>i("est_divisible",r.target.checked),className:"rounded border-gray-300 text-amber-600 focus:ring-amber-500"}),e.jsx(s,{htmlFor:"est_divisible",children:"Vente en fraction autorisée"})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(m,{type:"button",variant:"outline",asChild:!0,children:e.jsx(_,{href:route("hardware.products"),children:"Annuler"})}),e.jsxs(m,{type:"submit",disabled:x,className:"bg-amber-500 hover:bg-amber-600 text-white",children:[e.jsx(D,{className:"h-4 w-4 mr-2"})," ",x?"Création...":"Créer le produit"]})]})]})]})})})})]})}export{le as default};
