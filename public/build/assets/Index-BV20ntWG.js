import{u as G,r as p,j as e,H as U,a as V}from"./app-Bu58nmqp.js";import{A as O,G as R,n as Q,s as J,I as K,p as Y,D as W,d as T,z as E,J as X,b as Z,e as ee,v as te,K as re,N as ae,O as se,Q as N}from"./AppLayout-PYzm33Di.js";import{C as a,a as s,b as d,c as l}from"./card-DoR82Obt.js";import{B as C}from"./Button-CJzVzbMf.js";import{I as q}from"./Input-B1xyFs7T.js";import{L as M}from"./Label-BUXOAy6-.js";import{f as de}from"./currency-CAle3Gff.js";import{R as le}from"./refresh-cw-DMClxRp8.js";import"./createLucideIcon-D31lZ7X_.js";import"./shield-x-Be2eaKBY.js";import"./x-BNg5u3GU.js";import"./user-cog-DOLB-E56.js";import"./Dropdown-BckUvWPZ.js";import"./transition-Dwpb1-fu.js";import"./arrow-left-DSvgm0i3.js";import"./loader-circle-BgO0_QPs.js";import"./FlashMessages-Ce1oH_d3.js";function xe(){const r=new Date,c=x=>String(x).padStart(2,"0"),k=`${r.getFullYear()}-${c(r.getMonth()+1)}-01`,w=r.toISOString().slice(0,10);return{from:k,to:w}}function _e({report:r,filters:c}){const{shop:k}=G().props,w=k?.currency||"CDF",x=t=>de(t,w),S=xe(),D=r?.period||{},[y,z]=p.useState(D.from||c?.from||S.from),[b,I]=p.useState(D.to||c?.to||S.to),L=t=>{t.preventDefault(),V.get(route("pharmacy.reports.index"),{from:y,to:b},{preserveState:!0})},i=r?.sales||{},o=r?.purchases||{},j=r?.movements||{},v=r?.stock||{},A=r?.products_analysis||[],n=r?.period||{from:c?.from,to:c?.to},[_,B]=p.useState({key:"revenue",dir:"desc"}),F=p.useMemo(()=>{const t=[...A],m=_.key,f=_.dir==="asc"?1:-1;return t.sort((H,$)=>{const h=H[m],g=$[m];return typeof h=="number"&&typeof g=="number"?f*(h-g):h==null&&g==null?0:h==null?f:g==null?-f:f*String(h).localeCompare(String(g))}),t},[A,_]),u=t=>{B(m=>m.key===t?{key:t,dir:m.dir==="asc"?"desc":"asc"}:{key:t,dir:"desc"})},P=p.useMemo(()=>!n?.from||!n?.to?"Période":n.from===n.to?n.from:`${n.from} → ${n.to}`,[n]);return e.jsxs(O,{header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 dark:text-gray-100 leading-tight",children:"Rapport d'activité"}),children:[e.jsx(U,{title:"Rapport d'activité - Pharmacy"}),e.jsx("div",{className:"py-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6",children:[e.jsxs(a,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700 shadow-sm",children:[e.jsx(s,{className:"pb-4",children:e.jsxs(d,{className:"text-base flex items-center gap-2 text-gray-900 dark:text-white",children:[e.jsx(R,{className:"h-4 w-4 text-amber-500"}),"Période du rapport"]})}),e.jsxs(l,{children:[e.jsxs("form",{onSubmit:L,className:"flex flex-wrap items-end gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"date_from",className:"text-gray-700 dark:text-gray-300",children:"Date début"}),e.jsx(q,{id:"date_from",type:"date",value:y,onChange:t=>z(t.target.value),className:"h-10 w-full min-w-[160px]"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"date_to",className:"text-gray-700 dark:text-gray-300",children:"Date fin"}),e.jsx(q,{id:"date_to",type:"date",value:b,onChange:t=>I(t.target.value),className:"h-10 w-full min-w-[160px]"})]}),e.jsxs(C,{type:"submit",size:"sm",className:"bg-amber-500 hover:bg-amber-600 text-white h-10 px-4",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Générer le rapport"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-3",children:["Période : ",e.jsx("strong",{className:"text-gray-700 dark:text-gray-300",children:P})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 pb-2 border-b border-gray-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-100 dark:bg-amber-900/30",children:e.jsx(Q,{className:"h-6 w-6 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Rapport d'activité"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:P})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4"}),"Généré le ",new Date().toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{type:"button",variant:"outline",size:"sm",className:"h-9",asChild:!0,children:e.jsxs("a",{href:route("pharmacy.exports.reports.pdf",{from:y,to:b}),target:"_blank",rel:"noopener noreferrer",children:[e.jsx(K,{className:"h-4 w-4 mr-1.5"}),"Exporter PDF"]})}),e.jsx(C,{type:"button",variant:"outline",size:"sm",className:"h-9",asChild:!0,children:e.jsxs("a",{href:route("pharmacy.exports.reports.excel",{from:y,to:b}),target:"_blank",rel:"noopener noreferrer",children:[e.jsx(Y,{className:"h-4 w-4 mr-1.5"}),"Exporter Excel"]})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4",children:[e.jsxs(a,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(s,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Chiffre d'affaires"}),e.jsx(W,{className:"h-4 w-4 text-green-500 dark:text-green-400"})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-xl font-bold text-gray-900 dark:text-white",children:x(i.total||0)}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[i.count??0," ventes"]})]})]}),e.jsxs(a,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(s,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Ventes"}),e.jsx(T,{className:"h-4 w-4 text-blue-500 dark:text-blue-400"})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-xl font-bold text-gray-900 dark:text-white",children:i.count??0}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Transactions complétées"})]})]}),e.jsxs(a,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(s,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Achats reçus"}),e.jsx(E,{className:"h-4 w-4 text-indigo-500 dark:text-indigo-400"})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-xl font-bold text-gray-900 dark:text-white",children:o.count??0}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:x(o.total||0)})]})]}),e.jsxs(a,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(s,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Mouvements stock"}),e.jsx(X,{className:"h-4 w-4 text-slate-500 dark:text-slate-400"})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-xl font-bold text-gray-900 dark:text-white",children:j.total_ops??0}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Entrées / Sorties / Réglages"})]})]}),e.jsxs(a,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(s,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Valeur stock"}),e.jsx(Z,{className:"h-4 w-4 text-amber-500 dark:text-amber-400"})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-xl font-bold text-gray-900 dark:text-white",children:x(v.total_value||0)}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[v.product_count??0," produits actifs"]})]})]}),e.jsxs(a,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(s,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Stock bas"}),e.jsx(ee,{className:"h-4 w-4 text-orange-500 dark:text-orange-400"})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-xl font-bold text-orange-600 dark:text-orange-400",children:v.low_stock_count??0}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"À réapprovisionner"})]})]})]}),e.jsxs(a,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsx(s,{children:e.jsxs(d,{className:"text-base flex items-center gap-2 text-gray-900 dark:text-white",children:[e.jsx(te,{className:"h-5 w-5 text-amber-500"}),"Synthèse des mouvements de stock"]})}),e.jsx(l,{children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 rounded-lg bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800",children:[e.jsx(re,{className:"h-8 w-8 text-green-600 dark:text-green-400 shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-800 dark:text-green-200",children:"Entrées"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:["+",j.qty_in??0]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 rounded-lg bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800",children:[e.jsx(ae,{className:"h-8 w-8 text-red-600 dark:text-red-400 shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:"Sorties"}),e.jsxs("p",{className:"text-2xl font-bold text-red-700 dark:text-red-300",children:["-",j.qty_out??0]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 rounded-lg bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700",children:[e.jsx(R,{className:"h-8 w-8 text-slate-600 dark:text-slate-400 shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Réglages"}),e.jsx("p",{className:"text-2xl font-bold text-slate-700 dark:text-slate-300",children:j.qty_adjustment??0})]})]})]})})]}),e.jsxs(a,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(s,{children:[e.jsxs(d,{className:"text-base flex items-center gap-2 text-gray-900 dark:text-white",children:[e.jsx(se,{className:"h-5 w-5 text-amber-500"}),"Analyse par produit"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Par période : qui rapporte le plus, produits les plus vendus, bénéfice et marge (si coût renseigné)."})]}),e.jsx(l,{children:F.length>0?e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200 dark:border-slate-700",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 dark:bg-slate-800 border-b border-gray-200 dark:border-slate-700",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:"Produit"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:"Code"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:e.jsxs("button",{type:"button",onClick:()=>u("qty_sold"),className:"inline-flex items-center gap-1 hover:text-gray-900 dark:hover:text-white",children:["Qté vendue ",e.jsx(N,{className:"h-3.5 w-3.5"})]})}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:e.jsxs("button",{type:"button",onClick:()=>u("revenue"),className:"inline-flex items-center gap-1 hover:text-gray-900 dark:hover:text-white",children:["Chiffre d'affaires ",e.jsx(N,{className:"h-3.5 w-3.5"})]})}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:"Coût"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:e.jsxs("button",{type:"button",onClick:()=>u("benefit"),className:"inline-flex items-center gap-1 hover:text-gray-900 dark:hover:text-white",children:["Bénéfice ",e.jsx(N,{className:"h-3.5 w-3.5"})]})}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:e.jsxs("button",{type:"button",onClick:()=>u("margin_percent"),className:"inline-flex items-center gap-1 hover:text-gray-900 dark:hover:text-white",children:["Marge % ",e.jsx(N,{className:"h-3.5 w-3.5"})]})})]})}),e.jsx("tbody",{children:F.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-slate-800 hover:bg-gray-50 dark:hover:bg-slate-800/50",children:[e.jsx("td",{className:"py-3 px-4 text-gray-900 dark:text-white font-medium",children:t.product_name}),e.jsx("td",{className:"py-3 px-4 text-gray-600 dark:text-gray-400",children:t.product_code||"—"}),e.jsx("td",{className:"py-3 px-4 text-right text-gray-700 dark:text-gray-300",children:t.qty_sold}),e.jsx("td",{className:"py-3 px-4 text-right font-semibold text-gray-900 dark:text-white",children:x(t.revenue)}),e.jsx("td",{className:"py-3 px-4 text-right text-gray-600 dark:text-gray-400",children:t.cost!=null?x(t.cost):"—"}),e.jsx("td",{className:"py-3 px-4 text-right",children:t.benefit!=null?e.jsx("span",{className:t.benefit>=0?"text-green-600 dark:text-green-400 font-medium":"text-red-600 dark:text-red-400 font-medium",children:x(t.benefit)}):e.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:"—"})}),e.jsx("td",{className:"py-3 px-4 text-right",children:t.margin_percent!=null?e.jsxs("span",{className:t.margin_percent>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400",children:[t.margin_percent," %"]}):e.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:"—"})})]},t.product_id))})]})}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400 py-6 text-center",children:"Aucune vente par produit sur la période."})})]}),e.jsxs(a,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsx(s,{children:e.jsxs(d,{className:"text-base flex items-center gap-2 text-gray-900 dark:text-white",children:[e.jsx(T,{className:"h-5 w-5 text-blue-500"}),"Ventes par jour"]})}),e.jsx(l,{children:i.by_day&&i.by_day.length>0?e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200 dark:border-slate-700",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 dark:bg-slate-800 border-b border-gray-200 dark:border-slate-700",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:"Date"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:"Nombre de ventes"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:"Chiffre d'affaires"})]})}),e.jsx("tbody",{children:i.by_day.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-slate-800 hover:bg-gray-50 dark:hover:bg-slate-800/50",children:[e.jsx("td",{className:"py-3 px-4 text-gray-900 dark:text-white font-medium",children:t.date}),e.jsx("td",{className:"py-3 px-4 text-right text-gray-700 dark:text-gray-300",children:t.count}),e.jsx("td",{className:"py-3 px-4 text-right font-semibold text-gray-900 dark:text-white",children:x(t.total)})]},t.date))})]})}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400 py-6 text-center",children:"Aucune vente sur la période."})})]}),e.jsxs(a,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsx(s,{children:e.jsxs(d,{className:"text-base flex items-center gap-2 text-gray-900 dark:text-white",children:[e.jsx(E,{className:"h-5 w-5 text-indigo-500"}),"Achats reçus par jour"]})}),e.jsx(l,{children:o.by_day&&o.by_day.length>0?e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200 dark:border-slate-700",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 dark:bg-slate-800 border-b border-gray-200 dark:border-slate-700",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:"Date"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:"Nombre"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:"Montant total"})]})}),e.jsx("tbody",{children:o.by_day.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-slate-800 hover:bg-gray-50 dark:hover:bg-slate-800/50",children:[e.jsx("td",{className:"py-3 px-4 text-gray-900 dark:text-white font-medium",children:t.date}),e.jsx("td",{className:"py-3 px-4 text-right text-gray-700 dark:text-gray-300",children:t.count}),e.jsx("td",{className:"py-3 px-4 text-right font-semibold text-gray-900 dark:text-white",children:x(t.total)})]},t.date))})]})}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400 py-6 text-center",children:"Aucun achat reçu sur la période."})})]})]})})]})}export{_e as default};
