import{u as O,R as g,j as e,H as U,L as B,a as k}from"./app-BGTsh8B3.js";import{P as H,d as M,a as Y,b as D,n as q,h as P,K as S,o as z,g as X,p as Z,A as G,Z as Q,e as v,D as W,i as J}from"./AppLayout-B9W2Qjn-.js";import{C as o,a as l,b as d,c as i}from"./card-DzyZZsrB.js";import{B as N}from"./Button-Cm51LcKk.js";import{f as ee}from"./currency-CAle3Gff.js";import{U as re}from"./x-Bqi0sytM.js";import{R as w,L as ae,C as te,X as se,Y as oe,T as C,a as le,P as de,b as ie,c as ne,d as ce}from"./PieChart-BGEI3-Mj.js";import"./createLucideIcon-B4miffV9.js";import"./shield-x-DRqpxde8.js";import"./user-cog-CgPvrrVM.js";import"./Dropdown-DbeWMHj2.js";import"./transition-JR3jNvu7.js";import"./arrow-left-BMPE_XAu.js";import"./loader-circle-CIdMfzjo.js";import"./refresh-cw-CA0aJ90x.js";import"./FlashMessages-o0prhkl9.js";function me(t,n){return Array.isArray(t)?t.includes("*")?!0:(Array.isArray(n)?n:[n]).some(a=>t.some(m=>m===a||m===a.replace(".view",".manage")||m===a.replace(".manage",".view"))):!1}const xe=[{label:"Nouvelle vente",route:"pharmacy.sales.create",icon:H,permission:"pharmacy.sales.view",color:"emerald"},{label:"Voir les ventes",route:"pharmacy.sales.index",icon:M,permission:"pharmacy.sales.view",color:"blue"},{label:"Ajouter un produit",route:"pharmacy.products.create",icon:Y,permission:["pharmacy.product.manage","pharmacy.pharmacy.product.manage"],color:"amber"},{label:"Voir les produits",route:"pharmacy.products",icon:D,permission:["pharmacy.product.manage","pharmacy.pharmacy.product.manage"],color:"slate"},{label:"Stock",route:"pharmacy.stock.index",icon:q,permission:["stock.view","pharmacy.pharmacy.stock.manage"],color:"violet"},{label:"Mouvements",route:"pharmacy.stock.movements.index",icon:P,permission:["stock.movement.view","pharmacy.pharmacy.stock.manage"],color:"indigo"},{label:"Expirations",route:"pharmacy.expirations.index",icon:S,permission:"pharmacy.expiration.view",color:"red"},{label:"Rapports",route:"pharmacy.reports.index",icon:z,permission:"pharmacy.report.view",color:"cyan"},{label:"Inventaire",route:"pharmacy.inventories.index",icon:X,permission:"inventory.view",color:"orange"},{label:"Achats",route:"pharmacy.purchases.index",icon:Z,permission:"pharmacy.purchases.view",color:"teal"},{label:"Clients",route:"pharmacy.customers.index",icon:re,permission:"pharmacy.customer.view",color:"purple"}],ge={emerald:"bg-emerald-500 hover:bg-emerald-600",blue:"bg-blue-500 hover:bg-blue-600",amber:"bg-amber-500 hover:bg-amber-600",slate:"bg-slate-500 hover:bg-slate-600",violet:"bg-violet-500 hover:bg-violet-600",indigo:"bg-indigo-500 hover:bg-indigo-600",red:"bg-red-500 hover:bg-red-600",cyan:"bg-cyan-500 hover:bg-cyan-600",orange:"bg-orange-500 hover:bg-orange-600",teal:"bg-teal-500 hover:bg-teal-600",purple:"bg-purple-500 hover:bg-purple-600"},he=[{value:7,label:"7 derniers jours"},{value:14,label:"14 derniers jours"},{value:30,label:"30 derniers jours"}];function A(t){return t?(typeof t=="string"?new Date(t):t).toISOString().slice(0,10):""}function Te({stats:t,chartSalesLastDays:n=[],chartStockDistribution:c=[],filters:a={}}){const{auth:m,shop:R}=O().props,T=m?.permissions??[],L=R?.currency||"CDF",h=r=>ee(r,L),x=Number(a?.period)||14,$=!!(a?.from&&a?.to),F=A(new Date(Date.now()-336*60*60*1e3)),_=A(new Date),[p,b]=g.useState(a?.from||F),[u,y]=g.useState(a?.to||_),I=$?`Ventes du ${a.from} au ${a.to}`:`Ventes des ${x} derniers jours`;g.useEffect(()=>{a?.from&&b(a.from),a?.to&&y(a.to)},[a?.from,a?.to]);const j=xe.filter(r=>me(T,r.permission)),K=r=>{const s=Number(r.target.value)||14;k.get(route("pharmacy.dashboard"),{period:s,from:"",to:""},{preserveState:!0})},V=()=>{k.get(route("pharmacy.dashboard"),{period:x,from:p||void 0,to:u||void 0},{preserveState:!0})},f=(n||[]).map(r=>({...r,dateShort:r.date?new Date(r.date).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}):"",total:Number(r.total),count:Number(r.count)}));return e.jsxs(G,{header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 dark:text-gray-100 leading-tight",children:"Tableau de bord"}),children:[e.jsx(U,{title:"Tableau de bord Pharmacie"}),e.jsxs("div",{className:"py-6 space-y-6 sm:space-y-8",children:[e.jsxs(o,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsx(l,{className:"pb-2",children:e.jsx(d,{className:"text-base text-gray-900 dark:text-white",children:"Filtres du graphique ventes"})}),e.jsx(i,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:flex-wrap items-stretch sm:items-center gap-3 sm:gap-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Période rapide :"}),e.jsx("select",{value:x,onChange:K,className:"rounded-lg border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-gray-900 dark:text-gray-100 px-3 py-2 text-sm focus:ring-2 focus:ring-amber-500 focus:border-transparent",children:he.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 ml-2",children:"Date début"}),e.jsx("input",{type:"date",value:p,onChange:r=>b(r.target.value),className:"rounded-lg border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-gray-900 dark:text-gray-100 px-3 py-2 text-sm focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Date fin"}),e.jsx("input",{type:"date",value:u,onChange:r=>y(r.target.value),className:"rounded-lg border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-gray-900 dark:text-gray-100 px-3 py-2 text-sm focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsx(N,{type:"button",onClick:V,className:"w-full sm:w-auto bg-amber-600 hover:bg-amber-700 text-white",children:"Appliquer"})]})})]}),j.length>0&&e.jsxs(o,{className:"hidden md:block bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsx(l,{className:"pb-2",children:e.jsxs(d,{className:"text-base flex items-center gap-2 text-gray-900 dark:text-white",children:[e.jsx(Q,{className:"h-5 w-5 text-amber-500"}),"Actions rapides"]})}),e.jsx(i,{children:e.jsx("div",{className:"flex flex-wrap gap-2",children:j.map(r=>{const s=r.icon,E=ge[r.color]||"bg-gray-500 hover:bg-gray-600";return e.jsx(N,{className:`${E} text-white text-sm`,asChild:!0,children:e.jsxs(B,{href:route(r.route),className:"inline-flex items-center gap-2",children:[e.jsx(s,{className:"h-4 w-4"}),r.label]})},r.route)})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(o,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Produits"}),e.jsx(D,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:t?.products?.total??0}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[t?.products?.active??0," actifs"]})]})]}),e.jsxs(o,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Stock bas"}),e.jsx(v,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:t?.inventory?.low_stock_count??0}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"À réapprovisionner"})]})]}),e.jsxs(o,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Valeur du stock"}),e.jsx(W,{className:"h-4 w-4 text-green-500 dark:text-green-400"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:h(t?.inventory?.total_value??0)}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Valeur totale"})]})]}),e.jsxs(o,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Expire bientôt"}),e.jsx(S,{className:"h-4 w-4 text-red-500"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:t?.expiry?.expiring_soon_count??0}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Sous 30 jours"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(o,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700 p-4",children:[e.jsx(l,{className:"pb-2",children:e.jsxs(d,{className:"text-base flex items-center gap-2 text-gray-900 dark:text-white",children:[e.jsx(J,{className:"h-5 w-5 text-emerald-500"}),I]})}),e.jsx(i,{className:"h-72",children:f.length>0?e.jsx(w,{width:"100%",height:"100%",children:e.jsxs(ae,{data:f,margin:{top:5,right:10,left:0,bottom:5},children:[e.jsx(te,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-600"}),e.jsx(se,{dataKey:"dateShort",tick:{fontSize:11},className:"text-gray-600 dark:text-gray-400"}),e.jsx(oe,{yAxisId:"left",tickFormatter:r=>r>=1e3?`${(r/1e3).toFixed(0)}k`:r,tick:{fontSize:11}}),e.jsx(C,{formatter:r=>{const s=Array.isArray(r)?r[0]:r;return[h(Number(s)),"Chiffre d'affaires"]},labelFormatter:(r,s)=>s[0]?.payload?.date&&new Date(s[0].payload.date).toLocaleDateString("fr-FR"),contentStyle:{borderRadius:8}}),e.jsx(le,{yAxisId:"left",type:"monotone",dataKey:"total",stroke:"#10b981",strokeWidth:2,dot:{fill:"#10b981",r:3},name:"CA"})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-gray-500 dark:text-gray-400 text-sm",children:"Aucune vente sur la période"})})]}),e.jsxs(o,{className:"bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700 p-4",children:[e.jsx(l,{className:"pb-2",children:e.jsxs(d,{className:"text-base flex items-center gap-2 text-gray-900 dark:text-white",children:[e.jsx(P,{className:"h-5 w-5 text-violet-500"}),"Répartition du stock"]})}),e.jsx(i,{className:"h-72",children:c&&c.length>0?e.jsx(w,{width:"100%",height:"100%",children:e.jsxs(de,{children:[e.jsx(ie,{data:c,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:80,label:({name:r,value:s})=>`${r}: ${s}`,children:c.map((r,s)=>e.jsx(ne,{fill:r.fill},`cell-${s}`))}),e.jsx(C,{formatter:r=>[Array.isArray(r)?r[0]:r,"Produits"]}),e.jsx(ce,{})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-gray-500 dark:text-gray-400 text-sm",children:"Aucune donnée de stock"})})]})]}),t?.alerts?.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:"Alertes"}),e.jsx("div",{className:"space-y-3",children:t.alerts.map((r,s)=>e.jsx("div",{className:`p-4 rounded-lg border ${r.type==="danger"?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(v,{className:`h-5 w-5 mr-3 ${r.type==="danger"?"text-red-600 dark:text-red-400":"text-yellow-600 dark:text-yellow-400"}`}),e.jsxs("div",{children:[e.jsx("p",{className:`font-medium ${r.type==="danger"?"text-red-800 dark:text-red-300":"text-yellow-800 dark:text-yellow-300"}`,children:r.message}),e.jsxs("p",{className:`text-sm ${r.type==="danger"?"text-red-600 dark:text-red-400":"text-yellow-600 dark:text-yellow-400"}`,children:["Priorité : ",r.priority]})]})]})},s))})]})]})]})}export{Te as default};
