import{b as ce,r as o,j as e,c as T,n as d,H as de,a as U}from"./app-3PKVeuQh.js";import{b as q,H as oe,_ as me,O as ie,$ as xe,T as he,D as ue,s as ge,a as pe,o as fe,W as ye,A as je,h as W,P as X,E as be,c as J,C as ve,m as Y,q as Z,e as we}from"./AppLayout-DSrKCpOy.js";import{C as K,a as Q,b as ee,c as se}from"./card-FPNRX1p2.js";import{B as k}from"./Button-RC9FN5z3.js";import{I as v}from"./Input-5gvkn2nv.js";import{B as V}from"./badge-Ca6uIRAr.js";import{M as re}from"./Modal-DSnhLKcn.js";import{D as Ne}from"./Drawer-DXvnJU94.js";import{L as u}from"./Label-DCTvEg5s.js";import{T as ke}from"./textarea-g7yOinAB.js";import{o as _e}from"./syncService-CxsNbC8G.js";import{X as G,C as Ce}from"./x-YL0zAneP.js";import{T as Se}from"./user-cog-nVqfHm0b.js";import"./createLucideIcon-CyiEew_u.js";import"./shield-x-gOy17OJ-.js";import"./Dropdown-B_QkibTR.js";import"./transition-CufTvwOt.js";import"./arrow-left-CvJq81LS.js";import"./loader-circle-D2tkCN5O.js";import"./refresh-cw-L3GUbwVE.js";import"./FlashMessages-bPB7K-Ql.js";const Pe="pos-saas-images-v1",ae=50*1024*1024;class Ie{constructor(){this.cache=null,this.initPromise=null}async init(){return this.initPromise?this.initPromise:"caches"in window?(this.initPromise=caches.open(Pe).then(a=>(this.cache=a,a)),this.initPromise):Promise.resolve(null)}async isCached(a){if(this.cache||await this.init(),!this.cache)return!1;try{return!!await this.cache.match(a)}catch(s){return console.warn("Error checking image cache:",s),!1}}async getImage(a){if(this.cache||await this.init(),!this.cache)return a;try{const s=await this.cache.match(a);if(s)return URL.createObjectURL(await s.blob());if(navigator.onLine){const m=await fetch(a);if(m.ok){const g=m.headers.get("content-length");if(g&&parseInt(g)>ae)return a;const i=m.clone();return await this.cache.put(a,i),URL.createObjectURL(await m.blob())}}return a}catch(s){return console.warn("Error fetching image:",s),a}}async cacheImage(a){if(this.cache||await this.init(),!this.cache||!navigator.onLine)return!1;try{if(await this.isCached(a))return!0;const s=await fetch(a);if(s.ok){const m=s.headers.get("content-length");return m&&parseInt(m)>ae?!1:(await this.cache.put(a,s.clone()),!0)}}catch(s){console.warn("Error caching image:",s)}return!1}async removeImage(a){if(this.cache||await this.init(),!this.cache)return!1;try{return await this.cache.delete(a)}catch(s){return console.warn("Error removing image from cache:",s),!1}}async cleanCache(){if(this.cache||await this.init(),!!this.cache)try{const a=await this.cache.keys();if(a.length>100){const s=a.slice(0,a.length-100);await Promise.all(s.map(m=>this.cache.delete(m)))}}catch(a){console.warn("Error cleaning cache:",a)}}async getCacheSize(){if(this.cache||await this.init(),!this.cache)return 0;try{const a=await this.cache.keys();let s=0;for(const m of a){const g=await this.cache.match(m);if(g){const i=await g.blob();s+=i.size}}return s}catch(a){return console.warn("Error calculating cache size:",a),0}}}const te=new Ie;function Ee({isOpen:z,onClose:a,product:s=null,categories:m=[]}){const g=!!s,{data:i,setData:l,post:H,put:B,processing:_,errors:n,reset:I}=ce({name:s?.name||"",product_code:s?.product_code||"",description:s?.description||"",category_id:s?.category_id||"",price:s?.price_amount||"",currency:s?.price_currency||"USD",cost:s?.cost||"",minimum_stock:s?.minimum_stock||"",unit:s?.unit||"",medicine_type:s?.medicine_type||"",dosage:s?.dosage||"",prescription_required:s?.prescription_required||!1,manufacturer:s?.manufacturer||"",supplier_id:s?.supplier_id||"",image:null,image_url:s?.image_url||"",remove_image:!1}),[E,R]=o.useState(!!s?.medicine_type),[j,b]=o.useState(s?.image_url||null),[C,c]=o.useState(!1),[L,$]=o.useState([]),[S,D]=o.useState(!1);o.useEffect(()=>{z&&(async()=>{D(!0);try{const p=await T.get(route("pharmacy.suppliers.active"));p.data.success&&$(p.data.suppliers||[])}catch(p){console.error("Error loading suppliers:",p)}finally{D(!1)}})()},[z]),o.useEffect(()=>{s?(l({name:s.name||"",product_code:s.product_code||"",description:s.description||"",category_id:s.category_id||"",price:s.price_amount||"",currency:s.price_currency||"USD",cost:s.cost||"",minimum_stock:s.minimum_stock||"",unit:s.unit||"",medicine_type:s.medicine_type||"",dosage:s.dosage||"",prescription_required:s.prescription_required||!1,manufacturer:s.manufacturer||"",supplier_id:s.supplier_id||"",image:null,image_url:s.image_url||"",remove_image:!1}),R(!!s.medicine_type),s.image_url?te.getImage(s.image_url).then(r=>{b(r)}).catch(()=>{b(s.image_url)}):b(null)):(I(),R(!1),b(null))},[s]);const F=r=>{const p=r.target.files[0];if(p){const h=["image/jpeg","image/jpg","image/png","image/webp"];if(p.size>2097152){d.error("L'image ne doit pas dépasser 2 Mo");return}if(!h.includes(p.type)){d.error("Format d'image non supporté. Utilisez JPG, PNG ou WebP");return}l("image",p),l("remove_image",!1);const f=new FileReader;f.onloadend=()=>{b(f.result)},f.readAsDataURL(p)}},M=()=>{l("image",null),l("image_url",""),l("remove_image",!0),b(null)},O=async()=>{if(!i.name){d.error("Veuillez d'abord saisir le nom du produit.");return}if(!navigator.onLine){d.error("La génération automatique du code nécessite une connexion internet.");return}try{c(!0);const r=await T.get(route("pharmacy.products.generate-code"),{params:{name:i.name}});r.data?.code?(l("product_code",r.data.code),d.success("Code produit généré automatiquement.")):d.error("Impossible de générer un code produit. Réessayez.")}catch(r){console.error(r),d.error(r.response?.data?.message||"Erreur lors de la génération du code produit.")}finally{c(!1)}},w=async r=>{r.preventDefault();const p=navigator.onLine,A={name:i.name,product_code:i.product_code,description:i.description,category_id:i.category_id,price:i.price,currency:i.currency,cost:i.cost,minimum_stock:i.minimum_stock,unit:i.unit,medicine_type:i.medicine_type,dosage:i.dosage,prescription_required:i.prescription_required,manufacturer:i.manufacturer,supplier_id:i.supplier_id};if(p){const h=new FormData;Object.keys(A).forEach(f=>{const P=A[f];P!=null&&(typeof P=="boolean"?h.append(f,P?"1":"0"):h.append(f,P))}),i.image&&h.append("image",i.image),i.remove_image&&h.append("remove_image","1");try{g?(await T.put(route("pharmacy.products.update",s.id),h,{headers:{"Content-Type":"multipart/form-data"}}),d.success("Produit mis à jour avec succès")):(await T.post(route("pharmacy.products.store"),h,{headers:{"Content-Type":"multipart/form-data"}}),d.success("Produit créé avec succès")),i.image&&j&&await te.cacheImage(j),a(),I(),b(null),window.location.reload()}catch(f){d.error(f.response?.data?.message||"Erreur lors de l'enregistrement"),console.error(f)}}else try{const h=g?s.id:null,f=await _e.savePendingProduct({...A,id:h},i.image);d.success("Produit enregistré localement. Synchronisation automatique à la reconnexion.",{icon:e.jsx(ye,{className:"h-5 w-5"}),duration:5e3}),a(),I(),b(null),window.location.reload()}catch(h){d.error("Erreur lors de l'enregistrement local"),console.error(h)}},N=()=>{I(),a()};return e.jsx(Ne,{isOpen:z,onClose:N,title:g?"Modifier le produit":"Nouveau produit",size:"xl",children:e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(q,{className:"h-5 w-5 mr-2"}),"Informations de base"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"name",children:"Nom du produit *"}),e.jsx(v,{id:"name",value:i.name,onChange:r=>l("name",r.target.value),placeholder:"Nom du produit",className:"w-full"}),n.name&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:n.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"product_code",children:"Code produit *"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(oe,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400 dark:text-gray-500"}),e.jsx(v,{id:"product_code",value:i.product_code,onChange:r=>l("product_code",r.target.value),placeholder:"PROD-001",className:"pl-10 w-full"})]}),e.jsxs(k,{type:"button",variant:"outline",size:"sm",onClick:O,disabled:C,className:"whitespace-nowrap",children:[e.jsx(me,{className:"h-4 w-4 mr-1"}),C?"Génération...":"Auto"]})]}),n.product_code&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:n.product_code})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"description",children:"Description"}),e.jsx(ke,{id:"description",value:i.description,onChange:r=>l("description",r.target.value),placeholder:"Description du produit...",rows:3,className:"w-full"}),n.description&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:n.description})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"image",children:"Image du produit"}),e.jsxs("div",{className:"space-y-3",children:[j&&e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:j,alt:"Preview",className:"h-32 w-32 object-cover rounded-lg border-2 border-gray-300 dark:border-gray-600"}),e.jsx("button",{type:"button",onClick:M,className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors","aria-label":"Supprimer l'image",children:e.jsx(G,{className:"h-4 w-4"})})]}),!j&&e.jsxs("label",{htmlFor:"image",className:"flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 dark:border-gray-600 border-dashed rounded-lg cursor-pointer bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx(ie,{className:"w-8 h-8 mb-2 text-gray-400 dark:text-gray-500"}),e.jsxs("p",{className:"mb-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-semibold",children:"Cliquez pour uploader"})," ou glissez-déposez"]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"JPG, PNG ou WebP (MAX. 2 Mo)"})]}),e.jsx("input",{id:"image",type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",className:"hidden",onChange:F})]}),j&&e.jsxs("label",{htmlFor:"image",className:"inline-flex items-center justify-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 cursor-pointer transition-colors",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Remplacer l'image",e.jsx("input",{id:"image",type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",className:"hidden",onChange:F})]})]}),n.image&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:n.image})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"category_id",children:"Catégorie *"}),e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400 dark:text-gray-500"}),e.jsxs("select",{id:"category_id",value:i.category_id,onChange:r=>l("category_id",r.target.value),className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white pl-10 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Sélectionner une catégorie"}),m.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),n.category_id&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:n.category_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"unit",children:"Unité *"}),e.jsx(v,{id:"unit",value:i.unit,onChange:r=>l("unit",r.target.value),placeholder:"ex: bouteille, boîte, comprimé",className:"w-full"}),n.unit&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:n.unit})]})]})]}),e.jsxs("div",{className:"space-y-4 border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(ue,{className:"h-5 w-5 mr-2"}),"Informations de prix"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"price",children:"Prix de vente *"}),e.jsx(v,{id:"price",type:"number",step:"0.01",value:i.price,onChange:r=>l("price",r.target.value),placeholder:"0.00",className:"w-full"}),n.price&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:n.price})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"cost",children:"Prix de revient"}),e.jsx(v,{id:"cost",type:"number",step:"0.01",value:i.cost,onChange:r=>l("cost",r.target.value),placeholder:"0.00",className:"w-full"}),n.cost&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:n.cost})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"currency",children:"Devise *"}),e.jsxs("select",{id:"currency",value:i.currency,onChange:r=>l("currency",r.target.value),className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"EUR",children:"EUR"}),e.jsx("option",{value:"CDF",children:"CDF"})]}),n.currency&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:n.currency})]})]})]}),e.jsxs("div",{className:"space-y-4 border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(ge,{className:"h-5 w-5 mr-2"}),"Paramètres de stock"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"minimum_stock",children:"Stock minimum *"}),e.jsx(v,{id:"minimum_stock",type:"number",value:i.minimum_stock,onChange:r=>l("minimum_stock",r.target.value),placeholder:"10",className:"w-full"}),n.minimum_stock&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:n.minimum_stock})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"manufacturer",children:"Fabricant"}),e.jsx(v,{id:"manufacturer",value:i.manufacturer,onChange:r=>l("manufacturer",r.target.value),placeholder:"Nom du fabricant",className:"w-full"}),n.manufacturer&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:n.manufacturer})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"supplier_id",children:"Fournisseur"}),e.jsxs("select",{id:"supplier_id",value:i.supplier_id,onChange:r=>l("supplier_id",r.target.value),disabled:S,className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:S?"Chargement...":"Sélectionner un fournisseur"}),L.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]}),n.supplier_id&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:n.supplier_id})]})]}),e.jsxs("div",{className:"space-y-4 border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(pe,{className:"h-5 w-5 mr-2"}),"Informations médicament"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:E,onChange:r=>R(r.target.checked),className:"rounded border-gray-300 dark:border-gray-600 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600 dark:text-gray-400",children:"C'est un médicament"})]})]}),E&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"medicine_type",children:"Type de médicament"}),e.jsxs("select",{id:"medicine_type",value:i.medicine_type,onChange:r=>l("medicine_type",r.target.value),className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Sélectionner un type"}),e.jsx("option",{value:"MEDICINE",children:"Médicament"}),e.jsx("option",{value:"PARAPHARMACY",children:"Parapharmacie"}),e.jsx("option",{value:"DEVICE",children:"Dispositif médical"}),e.jsx("option",{value:"VACCINE",children:"Vaccin"}),e.jsx("option",{value:"NUTRITION",children:"Nutrition"})]}),n.medicine_type&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:n.medicine_type})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"dosage",children:"Dosage"}),e.jsx(v,{id:"dosage",value:i.dosage,onChange:r=>l("dosage",r.target.value),placeholder:"ex: 500mg, 10ml",className:"w-full"}),n.dosage&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:n.dosage})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"prescription_required",checked:i.prescription_required,onChange:r=>l("prescription_required",r.target.checked),className:"rounded border-gray-300 dark:border-gray-600 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"}),e.jsx(u,{htmlFor:"prescription_required",className:"ml-2",children:"Prescription requise"})]}),n.prescription_required&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:n.prescription_required})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-3 sm:gap-4 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("button",{type:"button",onClick:N,disabled:_,className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 px-4 py-2 h-10 w-full sm:w-auto",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Annuler"]}),e.jsxs("button",{type:"submit",disabled:_,className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-amber-500 text-white hover:bg-amber-600 dark:bg-amber-600 dark:text-white dark:hover:bg-amber-700 px-4 py-2 h-10 shadow-sm hover:shadow-md w-full sm:w-auto",children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:_?g?"Mise à jour...":"Création...":g?"Enregistrer":"Créer"}),e.jsx("span",{className:"sm:hidden",children:_?"...":g?"Enregistrer":"Créer"})]})]})]})})}function Ke({auth:z,products:a,categories:s,filters:m,canImport:g=!1}){const[i,l]=o.useState(m?.search||""),[H,B]=o.useState(m?.category_id||""),[_,n]=o.useState(m?.status||""),[I,E]=o.useState(!1),[R,j]=o.useState(null),[b,C]=o.useState(!1),[c,L]=o.useState(null),[$,S]=o.useState(!1),[D,F]=o.useState(null),[M,O]=o.useState(!1),[w,N]=o.useState(null),r=t=>{t.preventDefault(),U.get(route("pharmacy.products"),{search:i,category_id:H,status:_||void 0})},p=()=>{S(!0),F(null),N(null)},A=async t=>{if(t.preventDefault(),!D){d.error("Veuillez sélectionner un fichier.");return}O(!0),N(null);try{const x=new FormData;x.append("file",D);const y=await T.post(route("pharmacy.products.import"),x,{headers:{"Content-Type":"multipart/form-data"}});N(y.data),y.data.success>0&&(d.success(`${y.data.success} produit(s) importé(s) avec succès.`),U.reload()),y.data.failed>0&&y.data.errors?.length&&d.error(`${y.data.failed} ligne(s) en erreur.`)}catch(x){const y=x.response?.data?.message||"Erreur lors de l'import.";d.error(y),N({success:0,failed:0,total:0,errors:[y]})}finally{O(!1)}},h=()=>{j(null),E(!0)},f=t=>{j(t),E(!0)},P=t=>{L(t),C(!0)},ne=t=>{d.custom(x=>e.jsx("div",{className:`${x.visible?"animate-enter":"animate-leave"} max-w-md w-full bg-white dark:bg-gray-800 shadow-lg rounded-lg pointer-events-auto flex ring-1 ring-black ring-opacity-5`,children:e.jsxs("div",{className:"flex-1 w-0 p-4",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(we,{className:"h-6 w-6 text-red-600 dark:text-red-400"})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Confirmer la suppression"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:['Êtes-vous sûr de vouloir supprimer "',t.name,'" ? Cette action est irréversible.']})]})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{onClick:()=>{d.dismiss(x.id),U.delete(route("pharmacy.products.destroy",t.id),{preserveScroll:!0,onSuccess:()=>{d.success("Produit supprimé avec succès")},onError:y=>{d.error(y.message||"Erreur lors de la suppression du produit")}})},className:"flex-1 bg-red-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-red-700 transition",children:"Supprimer"}),e.jsx("button",{onClick:()=>d.dismiss(x.id),className:"flex-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-md text-sm font-medium hover:bg-gray-200 dark:hover:bg-gray-600 transition",children:"Annuler"})]})]})}),{duration:1/0})},le=t=>{const x=t.current_stock??t.stock??0,y=t.minimum_stock??0;return x<=0?e.jsx(V,{variant:"destructive",children:"Out of Stock"}):x<=y?e.jsx(V,{variant:"warning",children:"Low Stock"}):e.jsx(V,{variant:"success",children:"In Stock"})};return e.jsxs(je,{header:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"font-semibold text-xl text-gray-800 dark:text-white leading-tight",children:"Gestion des Produits"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"hidden sm:flex items-center gap-2",children:[e.jsxs("a",{href:a.length?route("pharmacy.products.export.pdf"):"#",target:"_blank",rel:"noreferrer","aria-disabled":a.length===0,className:`inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 px-3 h-10 shadow-sm hover:shadow-md ${a.length===0?"opacity-50 cursor-not-allowed pointer-events-none bg-rose-400 text-white/80":"bg-rose-500 text-white hover:bg-rose-600 dark:bg-rose-600 dark:hover:bg-rose-700"}`,children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Exporter PDF"]}),e.jsxs("a",{href:a.length?route("pharmacy.products.export.excel"):"#","aria-disabled":a.length===0,className:`inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 px-3 h-10 shadow-sm hover:shadow-md ${a.length===0?"opacity-50 cursor-not-allowed pointer-events-none bg-emerald-400 text-white/80":"bg-emerald-500 text-white hover:bg-emerald-600 dark:bg-emerald-600 dark:hover:bg-emerald-700"}`,children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Exporter Excel"]})]}),e.jsxs("div",{className:"flex sm:hidden items-center gap-2",children:[e.jsxs("a",{href:a.length?route("pharmacy.products.export.pdf"):"#",target:"_blank",rel:"noreferrer","aria-disabled":a.length===0,className:`inline-flex items-center justify-center rounded-md text-xs font-medium px-2 h-8 shadow-sm ${a.length===0?"opacity-50 cursor-not-allowed pointer-events-none bg-rose-400 text-white/80":"bg-rose-500 text-white hover:bg-rose-600"}`,children:[e.jsx(Y,{className:"h-3 w-3 mr-1"}),"PDF"]}),e.jsxs("a",{href:a.length?route("pharmacy.products.export.excel"):"#","aria-disabled":a.length===0,className:`inline-flex items-center justify-center rounded-md text-xs font-medium px-2 h-8 shadow-sm ${a.length===0?"opacity-50 cursor-not-allowed pointer-events-none bg-emerald-400 text-white/80":"bg-emerald-500 text-white hover:bg-emerald-600"}`,children:[e.jsx(Z,{className:"h-3 w-3 mr-1"}),"Excel"]})]}),g&&e.jsxs("button",{type:"button",onClick:p,className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 px-3 h-10 shadow-sm hover:shadow-md bg-blue-500 text-white hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Importer"})]}),e.jsxs("button",{onClick:h,className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-amber-500 text-white hover:bg-amber-600 dark:bg-amber-600 dark:text-white dark:hover:bg-amber-700 px-4 py-2 h-10 shadow-sm hover:shadow-md",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Ajouter un produit"}),e.jsx("span",{className:"sm:hidden",children:"Ajouter"})]})]})]}),children:[e.jsx(de,{title:"Gestion des Produits"}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[e.jsxs(K,{className:"mb-6 bg-white dark:bg-gray-800",children:[e.jsx(Q,{children:e.jsxs(ee,{className:"flex items-center text-gray-900 dark:text-white",children:[e.jsx(W,{className:"h-5 w-5 mr-2"}),"Search Products"]})}),e.jsx(se,{children:e.jsx("form",{onSubmit:r,className:"flex flex-col gap-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(v,{placeholder:"Rechercher par nom ou code...",value:i,onChange:t=>l(t.target.value)})}),e.jsx("div",{className:"flex-1",children:e.jsxs("select",{className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500",value:H,onChange:t=>B(t.target.value),children:[e.jsx("option",{value:"",children:"Toutes les catégories"}),s.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})}),e.jsx("div",{className:"flex-1",children:e.jsxs("select",{className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500",value:_,onChange:t=>n(t.target.value),children:[e.jsx("option",{value:"",children:"Tous les statuts"}),e.jsx("option",{value:"active",children:"Actif"}),e.jsx("option",{value:"inactive",children:"Inactif"})]})}),e.jsxs(k,{type:"submit",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Rechercher"]})]})})})]}),e.jsxs(K,{className:"bg-white dark:bg-gray-800",children:[e.jsx(Q,{children:e.jsxs(ee,{className:"flex items-center text-gray-900 dark:text-white",children:[e.jsx(q,{className:"h-5 w-5 mr-2"}),"Products List (",a.length,")"]})}),e.jsx(se,{children:a.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(q,{className:"h-12 w-12 mx-auto text-gray-400 dark:text-gray-500 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No products found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Get started by creating your first product."}),e.jsxs("button",{onClick:h,className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-amber-500 text-white hover:bg-amber-600 dark:bg-amber-600 dark:text-white dark:hover:bg-amber-700 px-4 py-2 h-10 shadow-sm hover:shadow-md",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Ajouter un produit"]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Product"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Code"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Category"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Price"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Stock"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:a.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex-shrink-0 relative h-10 w-10 rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-700",children:[t.image_url&&e.jsx("img",{src:t.image_url,alt:t.name,className:"absolute inset-0 h-10 w-10 object-cover z-[1]",onError:x=>{x.target.onerror=null,x.target.style.display="none"}}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-0",children:e.jsx(q,{className:"h-6 w-6 text-gray-400 dark:text-gray-500"})})]}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.name}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[t.description?.substring(0,50),"..."]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:t.product_code}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:t.category?.name||"N/A"}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:[t.price_currency," ",t.price_amount?.toFixed(2)]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:[e.jsx("span",{className:"font-medium",children:t.current_stock}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[" / ",t.minimum_stock]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:le(t)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(k,{variant:"outline",size:"sm",onClick:()=>P(t),title:"Voir le détail",children:e.jsx(be,{className:"h-4 w-4"})}),e.jsx(k,{variant:"outline",size:"sm",onClick:()=>f(t),title:"Modifier",children:e.jsx(J,{className:"h-4 w-4"})}),e.jsx(k,{variant:"destructive",size:"sm",onClick:()=>ne(t),children:e.jsx(Se,{className:"h-4 w-4"})})]})})]},t.id))})]})})})]})]})}),e.jsx(re,{show:b,onClose:()=>{C(!1),L(null)},maxWidth:"xl",children:c&&e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Détail du produit"}),e.jsx("button",{type:"button",onClick:()=>C(!1),className:"rounded-md text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(G,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex gap-6",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"relative h-32 w-32 rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-700",children:[c.image_url?e.jsx("img",{src:c.image_url,alt:c.name,className:"absolute inset-0 h-full w-full object-cover",onError:t=>{t.target.onerror=null,t.target.style.display="none"}}):null,e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(q,{className:"h-16 w-16 text-gray-400 dark:text-gray-500"})})]})}),e.jsxs("div",{className:"flex-1 space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Nom"}),e.jsx("p",{className:"text-gray-900 dark:text-white font-medium",children:c.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Code"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:c.product_code})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Catégorie"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:c.category?.name||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Prix"}),e.jsxs("p",{className:"text-gray-900 dark:text-white",children:[c.price_currency," ",c.price_amount?.toFixed(2),c.cost!=null&&e.jsxs("span",{className:"text-gray-500 dark:text-gray-400 ml-2",children:["(Revient: ",c.price_currency," ",c.cost?.toFixed(2),")"]})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Stock"}),e.jsxs("p",{className:"text-gray-900 dark:text-white",children:[c.current_stock??c.stock??0," / ",c.minimum_stock??0," min"]})]}),c.description&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Description"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:c.description})]}),e.jsx("div",{className:"pt-4",children:e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>{C(!1),f(c)},children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Modifier"]})})]})]})]})}),e.jsx(re,{show:$,onClose:()=>{S(!1),F(null),N(null)},maxWidth:"lg",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Importer des produits"}),e.jsx("button",{type:"button",onClick:()=>S(!1),className:"rounded-md text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(G,{className:"h-5 w-5"})})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:["Fichiers acceptés : .xlsx ou .csv. Colonnes obligatoires : ",e.jsx("strong",{children:"nom"}),", ",e.jsx("strong",{children:"code"}),", ",e.jsx("strong",{children:"categorie_id"})," (ou nom de catégorie), ",e.jsx("strong",{children:"prix"}),", ",e.jsx("strong",{children:"unite"}),"."]}),e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Fichier"}),e.jsx("input",{type:"file",accept:".xlsx,.csv,.txt",onChange:t=>F(t.target.files?.[0]||null),className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 dark:file:bg-blue-900/20 dark:file:text-blue-400"})]}),w&&e.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"flex items-center text-green-600 dark:text-green-400",children:[e.jsx(Ce,{className:"h-5 w-5 mr-1"}),w.success," importé(s)"]}),w.failed>0&&e.jsxs("span",{className:"flex items-center text-red-600 dark:text-red-400",children:[e.jsx(ve,{className:"h-5 w-5 mr-1"}),w.failed," échoué(s)"]})]}),w.errors?.length>0&&e.jsx("div",{className:"mt-2 max-h-32 overflow-y-auto text-xs text-red-600 dark:text-red-400",children:w.errors.map((t,x)=>e.jsx("div",{children:t},x))})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>S(!1),children:"Fermer"}),e.jsx(k,{type:"submit",disabled:!D||M,children:M?"Import en cours...":"Importer"})]})]})]})}),e.jsx(Ee,{isOpen:I,onClose:()=>{E(!1),j(null)},product:R,categories:s})]})}export{Ke as default};
